var VizUtil=function(){var res={};var Column={};Column.OperationType={NONE:"none",SUM:"sum",GROUPBY:"groupby",GROUPBY_SUM:"gbysum",GROUPBY_SORT:"gbysort",DISTINCT:"distinct",COUNT:"count",COUNT_DISTINCT:"countd",AVERAGE:"ave",MEDIAN:"median",MIN:"min",MAX:"max",FIRST:"first",FIRST_EXCLUDE_NA:"first_narm",LAST:"last",LAST_EXCLUDE_NA:"last_narm",DATE_AVERAGE:"dateave",DATE_MEDIAN:"datemedian",DATE_MIN:"datemin",DATE_MAX:"datemax",DATE_FIRST:"datefirst",DATE_FIRST_EXCLUDE_NA:"datefirst_narm",DATE_LAST:"datelast",DATE_LAST_EXCLUDE_NA:"datelast_narm",DATE_MODE:"datemode",VAR:"var",SD1:"sd",SD2:"sd2",SD3:"sd3",IQR:"iqr",MAD:"mad",LOG10:"log10",LOG2:"log2",LOG:"log",MODE:"mode",ABS:"abs",NORMALIZE:"normalize",UPPERCASE:"uppercase",LOWERCASE:"lowercase",TITLECASE:"titlecase",EXTRACT_ALPHABETS:"extract_alphabets",EXTRACT_NUMBERS:"extract_numbers",EXTRACT_FIRST_WORD:"extract_first_word",EXTRACT_RANGE:"extract_range",REMOVE_SPACES:"remove_spaces",REMOVE_REPEAETD_SPACES:"remove_repeated_spaces",REMOVE_ALPHABETS:"remove_alphabets",REMOVE_NUMBERS:"remove_numbers",CONSTANT:"constant",CUSTOM_GROUPBY_FUNCTION:"custom_gby",CUSTOM_SUMMARIZE_FUNCTION:"custom_sum",DATE_CONSTANT:"dateconstant",POSIXCT_CONSTANT:"posixctconstant",NA_COUNT:"nacount",NA_PCT:"napct",NON_NA_COUNT:"nnacount",NON_NA_PCT:"nnapct",ALL:"all",ANY:"any",ALL_PIVOT_TOTAL:"all_pivot_total",ANY_PIVOT_TOTAL:"any_pivot_total",TRUE_COUNT:"truecount",FALSE_COUNT:"falsecount",TRUE_PCT:"truepct",FALSE_PCT:"falsepct",LM_FIT:"lmfit",LOESS_FIT:"loessfit",GAM_FIT:"gamfit",BUCKET:"bucket",BOXPLOT:"boxplot",DENSITYPLOT:"densityplot",AS_CHAR:"aschar",AS_FACTOR:"asfactor",AS_LOGICAL_FACTOR:"aslfactor",NORMALIZE:"normalize",STDERR:"stderr",CONF_INTV_95:"confint",CONF_INTV_99:"confint99",STDERR_PCT:"stderrpct",CONF_INTV_PCT_95:"confintpct",CONF_INTV_PCT_99:"confintpct99",SD1_PCT:"sdpct",IN_PCT:"inpct",ROUND_TO_YEAR:"rtoyear",FLOOR_TO_YEAR:"fltoyear",ROUND_TO_HALF_YEAR:"rtohalfyear",FLOOR_TO_HALF_YEAR:"fltohalfyear",ROUND_TO_QUARTER:"rtoq",FLOOR_TO_QUARTER:"fltoquarter",ROUND_TO_BI_MONTH:"rtobimon",FLOOR_TO_BI_MONTH:"fltobimonth",ROUND_TO_MONTH:"rtomon",FLOOR_TO_MONTH:"fltomonth",ROUND_TO_WEEK:"rtoweek",FLOOR_TO_WEEK:"fltoweek",ROUND_TO_DAY:"rtoday",FLOOR_TO_DAY:"fltoday",ROUND_TO_HOUR:"rtohour",FLOOR_TO_HOUR:"fltohour",ROUND_TO_MINUTE:"rtomin",FLOOR_TO_MINUTE:"fltominute",ROUND_TO_SECOND:"rtosec",FLOOR_TO_SECOND:"fltosecond",YEAR:"year",HALF_YEAR:"halfyear",QUARTER:"quarter",BI_MONTH:"bimon",BI_MONTH_2:"bimonth",MONTH:"mon",MONTH_2:"month",MONTH_NAME:"monname",MONTH_NAME_2:"monthname",MONTH_NAME_LONG:"monnamelong",WEEK:"week",WEEK_OF_QUARTER:"week_of_quarter",WEEK_OF_MONTH:"week_of_month",DAY:"day",DAY_OF_YEAR:"dayofyear",DAY_OF_QUARTER:"dayofquarter",DAY_OF_WEEK:"dayofweek",WEEKDAY:"wday",WEEKEND:"weekend",WEEKDAY_LONG:"wdaylong",HOUR:"hour",MINUTE:"minute",SECOND:"second",AS_NUM:"asnum",AS_DISCRETE_VALUES:"asdisc",AS_INTEGER:"asint",AS_INTEGER_BY10:"asintby10",AS_CATEGORY:"ascategory",CONVERT_NA:"convertna",COMPLETE:"complete",COMPLETE_EACH:"complete_each",CONVERT_US_STATE_NAME:"convstate",CONVERT_COUNTRY_NAME:"convcountry",CONVERT_ISO2C:"conviso2c",CONVERT_ISO3N:"conviso3n",UNGROUP:"ungrp",QUANTILE:"qtile",CUT:"cut",BUCKET_OUTLIER:"bucket_outlier",BUCKET_OUTLIER_IQR:"bucket_outlier_iqr",BUCKET_OUTLIER_PERCENTILE:"bucket_outlier_pct",BUCKET_OUTLIER_SD:"bucket_outlier_sd",BUCKET_EQUAL_WIDTH:"bucket_equal_width",BUCKET_EQUAL_FREQ:"bucket_equal_freq",BUCKET_CUSTOM:"bucket_custom",BUCKET_KMEANS:"bucket_kmeans",BUCKET_LOGICAL:"bucket_logical",CUMSUM:"cumsum",PCT_CUMSUM:"pcumsum",PCT_CUMSUM_REV:"pcumsum_rev",CUMMEAN:"cummean",CUMMIN:"cummin",CUMMAX:"cummax",CUMPROD:"cumprod",DIFF_FROM_PREV:"dfprev",DIFF_FROM_NEXT:"dfnext",DIFF_FROM_FIRST:"dfirst",DIFF_FROM_LAST:"dflast",DIFF_FROM_MIN:"dfmin",DIFF_FROM_MAX:"dfmax",DIFF_FROM_MEAN:"dfmean",DIFF_FROM_MEDIAN:"dfmed",DIFF_FROM_MODE:"dfmode",PCT_DIFF_FROM_PREV:"pdfprev",PCT_DIFF_FROM_NEXT:"pdfnext",PCT_DIFF_FROM_FIRST:"pdfirst",PCT_DIFF_FROM_LAST:"pdflast",PCT_DIFF_FROM_MIN:"pdfmin",PCT_DIFF_FROM_MAX:"pdfmax",PCT_DIFF_FROM_MEAN:"pdfmean",PCT_DIFF_FROM_MEDIAN:"pdfmed",PCT_DIFF_FROM_MODE:"pdfmode",PCT_OF_TOTAL:"ptotal",PCT_OF_FIRST:"poffirst",PCT_OF_LAST:"poflast",PCT_OF_MIN:"pofmin",PCT_OF_MAX:"pofmax",PCT_OF_MEAN:"pofmean",PCT_OF_MEDIAN:"pofmedian",PCT_OF_MODE:"pofmode",MIN_RANK:"mrank",DENSE_RANK:"drank",PCT_RANK:"prank",MIN_RANK_DESC:"mrankdesc",DENSE_RANK_DESC:"drankdesc",PCT_RANK_DESC:"prankdesc",ROLL_MIN:"rollmin",ROLL_MAX:"rollmax",ROLL_MEAN:"rollmean",ROLL_MEDIAN:"rollmed",ROLL_SD:"rollsd",ROLL_VAR:"rollvar",ROLL_SUM:"rollsum",ROLL_PROD:"rollprod",SORT_ASC:"sortasc",SORT_DESC:"sortdesc",FCT_CREATE:"fctcreate",FCT_REORDER_ASC:"fctreorderasc",FCT_REORDER_DESC:"fctreorderdesc",FCT_REV:"fctrev",FCT_INFREQ:"infreq",FCT_INFREQ_ASC:"sortfreqasc",FCT_INFREQ_DESC:"sortfreqdesc",FCT_LUMP_INFREQ:"fctlump_infreq",FCT_LUMP:"fctlump",FCT_OTHER:"fctother",REF_LINE:"refline",REF_LINE_WITH_CONF_INT:"refline_confint",DIAGONAL:"diagonal",OUTLIERS_GROUPBY:"outliers_groupby",REMOVE_OUTLIERS_IQR:"remove_outliers_iqr",ROUND:"round",POST_FILTER:"postfilter"};Column.Attribute={REFLINE_RANGE_SCOPE:"reflineRangeScope",REFLINE_RANGE_TYPE:"reflineRangeType",BUCKET_GROUP_BY_COLUMN:"bucketGroupByColumn",BUCKET_GROUP_BY_COLUMN_ORIGINAL_NAMES:"bucketGroupByColumnOriginalNames",BUCKET_AFTER_SUMMARIZE:"bucketAfterSummarize",BUCKET_PRIORITY:"bucketPriority",BUCKET_CONVERT_NA:"bucketConvertNa",VALUE_PREFIX:"valuePrefix",VALUE_SUFFIX:"valueSuffix"};res.MAX_SAFE_INTEGER=9007199254740992;res.PIXEL_PER_CHAR=7;res.MIN_MARGIN=60;res.MAX_MARGIN=100;res.DEFAULT_MIN_CIRCLE_DIAMETER={scatter:6,bubble:10,map:5,scattermatrix:7};res.DEFAULT_MAX_CIRCLE_DIAMETER={scatter:30,bubble:40,map:15};res.DEFAULT_VIOLIN_POINT_OPACITY=.6;res.DEFAULT_DENSITYPLOT_NUM_DECIMAL_DIGITS=4;res.ZERO_LINE_COLOR="#cfcfcf";res.FREQ_COL_LABEL="(Number of Rows)";res.AGGREGATION_FUNCTION_OPTIONS_HASH={};res.AGGREGATION_FUNCTION_OPTIONS_HASH[Column.OperationType.SUM]="Sum";res.AGGREGATION_FUNCTION_OPTIONS_HASH[Column.OperationType.AVERAGE]="Avg.";res.AGGREGATION_FUNCTION_OPTIONS_HASH[Column.OperationType.MIN]="Min";res.AGGREGATION_FUNCTION_OPTIONS_HASH[Column.OperationType.MAX]="Max";res.AGGREGATION_FUNCTION_OPTIONS_HASH[Column.OperationType.DATE_MIN]="Min";res.AGGREGATION_FUNCTION_OPTIONS_HASH[Column.OperationType.DATE_MAX]="Max";res.AGGREGATION_FUNCTION_OPTIONS_HASH[Column.OperationType.FIRST]="First";res.AGGREGATION_FUNCTION_OPTIONS_HASH[Column.OperationType.LAST]="Last";res.AGGREGATION_FUNCTION_OPTIONS_HASH[Column.OperationType.COUNT]="Count";res.AGGREGATION_FUNCTION_OPTIONS_HASH[Column.OperationType.COUNT_DISTINCT]="Uniq.";res.AGGREGATION_FUNCTION_OPTIONS_HASH[Column.OperationType.MEDIAN]="Med.";res.AGGREGATION_FUNCTION_OPTIONS_HASH[Column.OperationType.SD1]="SD";res.AGGREGATION_FUNCTION_OPTIONS_HASH[Column.OperationType.SD2]="2SD";res.AGGREGATION_FUNCTION_OPTIONS_HASH[Column.OperationType.SD3]="3SD";res.AGGREGATION_FUNCTION_OPTIONS_HASH[Column.OperationType.VAR]="Var.";res.AGGREGATION_FUNCTION_OPTIONS_HASH[Column.OperationType.IQR]="IQR";res.AGGREGATION_FUNCTION_OPTIONS_HASH[Column.OperationType.MAD]="MAD";res.AGGREGATION_FUNCTION_OPTIONS_HASH[Column.OperationType.MODE]="Mode";res.AGGREGATION_FUNCTION_OPTIONS_HASH[Column.OperationType.NA_COUNT]="#NA";res.AGGREGATION_FUNCTION_OPTIONS_HASH[Column.OperationType.NA_PCT]="%NA";res.AGGREGATION_FUNCTION_OPTIONS_HASH[Column.OperationType.NON_NA_COUNT]="#NNA";res.AGGREGATION_FUNCTION_OPTIONS_HASH[Column.OperationType.NON_NA_PCT]="%NNA";res.AGGREGATION_FUNCTION_OPTIONS_HASH[Column.OperationType.TRUE_COUNT]="#True";res.AGGREGATION_FUNCTION_OPTIONS_HASH[Column.OperationType.FALSE_COUNT]="#False";res.AGGREGATION_FUNCTION_OPTIONS_HASH[Column.OperationType.TRUE_PCT]="%True";res.AGGREGATION_FUNCTION_OPTIONS_HASH[Column.OperationType.FALSE_PCT]="%False";res.DEFAULT_FACET_SIZE=3;res.MAX_FACET_WIDTH=300;res.MIN_FACET_HEIGHT=300;res.ORIGINAL_ORDER_COL_NAME=".oo";res.TYPE_NUMROWS="numrows";res.NUMROWS_COL_NAME=".dummy.column.name.for.count.column";res.NUMROWS_COL_LABEL="(Number of Rows)";res.NUMROWS_COL_TEMPLATE={name:res.NUMROWS_COL_NAME,validName:res.NUMROWS_COL_NAME,isNumeric:true,isDate:false,type:res.TYPE_NUMROWS,func:Column.OperationType.COUNT,label:null,validLabel:null};res.TYPE_CUSTOM="custom";res.CUSTOM_COL_NAME=".dummy.column.name.for.custom.column";res.CUSTOM_COL_LABEL="(Custom)";res.CUSTOM_COL_TEMPLATE={name:res.CUSTOM_COL_NAME,validName:res.CUSTOM_COL_NAME,isNumeric:true,isDate:false,type:res.TYPE_CUSTOM,func:Column.OperationType.COUNT,label:null,validLabel:null};res.TYPE_ROWID="rowid";res.ROWID_COL_NAME=".rowid.column";res.ROWID_COL_LABEL="(Row ID)";res.ROWID_COL_TEMPLATE={name:res.ROWID_COL_NAME,validName:res.ROWID_COL_NAME,isNumeric:true,isDate:false,type:res.TYPE_ROWID,func:Column.OperationType.NONE,label:null,validLabel:null};var _createHash=function(definitionArr,valueProp){var obj={};definitionArr.forEach(function(item){obj[item.value]=item[valueProp||"label"]});return obj};res.POST_FILTER_OPTIONS=[{label:"None",value:""},{label:"Condition",value:"condition"},{label:"Top N",value:"top"},{label:"Bottom N",value:"bottom"}];res.POST_FILTER_OPTIONS_HASH=_createHash(res.POST_FILTER_OPTIONS);res.BUCKET_OPTIONS=[{label:"Automatic",value:0},{label:"5",value:5},{label:"10",value:10},{label:"15",value:15},{label:"20",value:20},{label:"25",value:25},{label:"50",value:50},{label:"100",value:100},{label:"200",value:200},{label:"500",value:500},{label:"1,000",value:1e3}];res.BUCKET_OPTIONS_HASH=_createHash(res.BUCKET_OPTIONS);res.PCT_TOTAL_DIRECTION_OPTIONS=[{value:"all",label:"All"},{value:"x",label:"Color"},{value:"color",label:"X Axis"}];res.PCT_TOTAL_DIRECTION_OPTIONS_HASH=_createHash(res.PCT_TOTAL_DIRECTION_OPTIONS);res.ORDER_OPTIONS=[{value:"asc",label:"Ascending"},{value:"desc",label:"Descending"}];res.ORDER_OPTIONS_HASH=_createHash(res.ORDER_OPTIONS);res.MARKER_SHAPE_OPTIONS=[{value:"default",label:"(Default)"},{value:"circle",label:"Circle"},{value:"bar",label:"Bar"},{value:"line",label:"Line"},{value:"line+circle",label:"Line + Circle"}];res.MARKER_SHAPE_OPTIONS_HASH=_createHash(res.MARKER_SHAPE_OPTIONS);res.ERRBAR_MARKER_SHAPE_OPTIONS=[{value:"bar",label:"Bar"},{value:"circle",label:"Marker"}];res.ERRBAR_MARKER_SHAPE_OPTIONS_HASH=_createHash(res.ERRBAR_MARKER_SHAPE_OPTIONS);res.PIVOT_COLOR_OPTIONS=[{label:"(None)",value:"none"},{label:"All (Down then Across)",value:"table_down_across"},{label:"Row (Across)",value:"table_across"},{label:"Column (Down then Across within Group)",value:"pane_down_across"},{label:"Column (Down)",value:"table_down"},{label:"Column (Down within Group)",value:"pane_down"}];res.PIVOT_COLOR_OPTIONS_HASH=_createHash(res.PIVOT_COLOR_OPTIONS);res.PIVOT_COLOR_OPTIONS_HASH.table5="All";res.PIVOT_COLOR_OPTIONS_HASH.row5="Row";res.PIVOT_WINDOW_FUNC_DIRECTIONS=[{label:"All (Down then Across)",value:"table_down_across"},{label:"Row (Across)",value:"table_across"},{label:"Column (Down then Across within Group)",value:"pane_down_across"},{label:"Column (Down)",value:"table_down"},{label:"Column (Down within Group)",value:"pane_down"}];res.PIVOT_WINDOW_FUNC_DIRECTIONS_HASH=_createHash(res.PIVOT_WINDOW_FUNC_DIRECTIONS);res.PIVOT_DIRECTIONS_BACKWARD_COMPATIBILITY_MAP={all:"table_down_across",row:"table_across",row_group:"pane_down_across",column:"table_down"};res.TABLE_MAX_NUMROW_OPTIONS=[{label:"100",value:100},{label:"200",value:200},{label:"500",value:500},{label:"1,000",value:1e3}];res.TABLE_MAX_NUMROW_OPTIONS_HASH=_createHash(res.TABLE_MAX_NUMROW_OPTIONS);res.MODEL_DATA_TYPE_OPTIONS=[{label:"Coefficients",value:"tidy"},{label:"Model Quality Stats",value:"glance"},{label:"Scored Data",value:"augment"}];res.MODEL_DATA_TYPE_OPTIONS_HASH=_createHash(res.MODEL_DATA_TYPE_OPTIONS);res.ERROR_BAR_TYPE_OPTIONS=[{label:"Standard Error",hint:"Standard Error",value:Column.OperationType.STDERR},{label:"95% Conf. Interval",hint:"95% Confidence Interval",value:Column.OperationType.CONF_INTV_95},{label:"99% Conf. Interval",hint:"99% Confidence Interval",value:Column.OperationType.CONF_INTV_99},{label:"1 Standard Deviation",hint:"1 Standard Deviation",value:Column.OperationType.SD1},{label:"2 Standard Deviation",hint:"2 Standard Deviation",value:Column.OperationType.SD2},{label:"3 Standard Deviation",hint:"3 Standard Deviation",value:Column.OperationType.SD3},{label:"IQR",hint:"Interquartile Range (IQR)",value:Column.OperationType.IQR}];res.ERROR_BAR_TYPE_OPTIONS_HASH=_createHash(res.ERROR_BAR_TYPE_OPTIONS);res.REFERENCE_LINE_RANGE_TYPE_OPTIONS=[{label:"95% Conf. Interval",hint:"95% Confidence Interval",value:Column.OperationType.CONF_INTV_95},{label:"99% Conf. Interval",hint:"99% Confidence Interval",value:Column.OperationType.CONF_INTV_99},{label:"1 Standard Deviation",hint:"1 Standard Deviation",value:Column.OperationType.SD1},{label:"2 Standard Deviation",hint:"2 Standard Deviation",value:Column.OperationType.SD2},{label:"3 Standard Deviation",hint:"3 Standard Deviation",value:Column.OperationType.SD3},{label:"IQR",hint:"Interquartile Range (IQR)",value:Column.OperationType.IQR}];res.REFERENCE_LINE_RANGE_TYPE_OPTIONS_HASH=_createHash(res.REFERENCE_LINE_RANGE_TYPE_OPTIONS);res.ERROR_BAR_GRAPH_OPTIONS=[{label:"Bar",value:"bar"},{label:"Circle",value:"marker"}];res.ERROR_BAR_GRAPH_OPTIONS_HASH=_createHash(res.ERROR_BAR_GRAPH_OPTIONS);res.ERROR_BAR_CALC_TYPE_OPTIONS=[{label:"Mean",value:"mean"},{label:"Ratio (%)",value:"ratio"}];res.ERROR_BAR_CALC_TYPE_OPTIONS_HASH=_createHash(res.ERROR_BAR_CALC_TYPE_OPTIONS);res.WINDOW_FUNCTION_CALC_TYPES=[{label:"(none)",value:"none",items:[{label:"(none)",hint:"none",value:Column.OperationType.NONE}]},{label:"Cumulative",value:"cum",itemLabel:"Summarize Values Using",items:[{label:"Sum",hint:"Cumulative Sum",value:Column.OperationType.CUMSUM},{label:"Sum Ratio",hint:"Cumulative Sum Ratio",value:Column.OperationType.PCT_CUMSUM},{label:"Mean (Average)",hint:"Cumulative Average",value:Column.OperationType.CUMMEAN},{label:"Min Value",hint:"Cumulative Min",value:Column.OperationType.CUMMIN},{label:"Max Value",hint:"Cumulative Max",value:Column.OperationType.CUMMAX},{label:"Product",hint:"Cumulative Product",value:Column.OperationType.CUMPROD}]},{label:"% of",value:"total",itemLabel:"Summarize Values Using",items:[{label:"Sum (Total)",hint:"Sum (Total)",value:Column.OperationType.PCT_OF_TOTAL},{label:"Mean (Average)",hint:"Mean (Average)",value:Column.OperationType.PCT_OF_MEAN},{label:"Median",hint:"Median",value:Column.OperationType.PCT_OF_MEDIAN},{label:"Mode",hint:"Mode",value:Column.OperationType.PCT_OF_MODE},{label:"Min Value",hint:"Min",value:Column.OperationType.PCT_OF_MIN},{label:"Max Value",hint:"Max",value:Column.OperationType.PCT_OF_MAX},{label:"First Value",hint:"First",value:Column.OperationType.PCT_OF_FIRST},{label:"Last Value",hint:"Last",value:Column.OperationType.PCT_OF_LAST}]},{label:"Difference From",value:"diff",itemLabel:"Difference from",items:[{label:"Mean (Average)",hint:"Difference from Average",value:Column.OperationType.DIFF_FROM_MEAN},{label:"Median",hint:"Difference from Median",value:Column.OperationType.DIFF_FROM_MEDIAN},{label:"Mode",hint:"Difference from Mode",value:Column.OperationType.DIFF_FROM_MODE},{label:"Min Value",hint:"Difference from Min",value:Column.OperationType.DIFF_FROM_MIN},{label:"Max Value",hint:"Difference from Max",value:Column.OperationType.DIFF_FROM_MAX},{label:"First Value",hint:"Difference from First",value:Column.OperationType.DIFF_FROM_FIRST},{label:"Last Value",hint:"Difference from Last",value:Column.OperationType.DIFF_FROM_LAST},{label:"Previous Value",hint:"Difference from Previous",value:Column.OperationType.DIFF_FROM_PREV},{label:"Next Value",hint:"Difference from Next",value:Column.OperationType.DIFF_FROM_NEXT}]},{label:"% Difference From",value:"pdiff",itemLabel:"% Difference from",items:[{label:"Mean (Average)",hint:"% Difference from Average",value:Column.OperationType.PCT_DIFF_FROM_MEAN},{label:"Median",hint:"% Difference from Median",value:Column.OperationType.PCT_DIFF_FROM_MEDIAN},{label:"Mode",hint:"% Difference from Mode",value:Column.OperationType.PCT_DIFF_FROM_MODE},{label:"Min Value",hint:"% Difference from Min",value:Column.OperationType.PCT_DIFF_FROM_MIN},{label:"Max Value",hint:"% Difference from Max",value:Column.OperationType.PCT_DIFF_FROM_MAX},{label:"First Value",hint:"% Difference from First",value:Column.OperationType.PCT_DIFF_FROM_FIRST},{label:"Last Value",hint:"% Difference from Last",value:Column.OperationType.PCT_DIFF_FROM_LAST},{label:"Previous Value",hint:"% Difference from Previous",value:Column.OperationType.PCT_DIFF_FROM_PREV},{label:"Next Value",hint:"% Difference from Next",value:Column.OperationType.PCT_DIFF_FROM_NEXT}]},{label:"Moving Calculation",value:"roll",itemLabel:"Summarize Values Using",items:[{label:"Sum",hint:"Moving Sum",value:Column.OperationType.ROLL_SUM},{label:"Mean (Average)",hint:"Moving Average",value:Column.OperationType.ROLL_MEAN},{label:"Median",hint:"Moving Median",value:Column.OperationType.ROLL_MEDIAN},{label:"Min Value",hint:"Moving Min",value:Column.OperationType.ROLL_MIN},{label:"Max Value",hint:"Moving Max",value:Column.OperationType.ROLL_MAX},{label:"Standard Deviation",hint:"Moving Standard Deviation",value:Column.OperationType.ROLL_SD},{label:"Variance",hint:"Moving Variance",value:Column.OperationType.ROLL_VAR},{label:"Product",hint:"Moving Product",value:Column.OperationType.ROLL_PROD}]},{label:"Rank",value:"rank",itemLabel:"Rank Type",items:[{label:"Min Rank (1,2,2,4)",hint:"Min Rank",value:Column.OperationType.MIN_RANK},{label:"Dense Rank (1,2,2,3)",hint:"Dense Rank",value:Column.OperationType.DENSE_RANK},{label:"Percent Rank (10,20,20,30)",hint:"Percent Rank",value:Column.OperationType.PCT_RANK}]}];res.OTHER_GROUP_OPTION_TYPE={NONE:"off",FCT_LUMP:"on",FCT_OTHER_KEEP_VALUES:"keep_values",FCT_OTHER_DROP_VALUES:"drop_values"};res.OTHER_GROUP_OPTIONS=[{label:"(None)",value:res.OTHER_GROUP_OPTION_TYPE.NONE},{label:"Based on Frequency",value:res.OTHER_GROUP_OPTION_TYPE.FCT_LUMP},{label:"Manually Select to Keep",value:res.OTHER_GROUP_OPTION_TYPE.FCT_OTHER_KEEP_VALUES},{label:"Manually Select to Drop",value:res.OTHER_GROUP_OPTION_TYPE.FCT_OTHER_DROP_VALUES}];res.WINDOW_FUNCTION_CALC_TYPES_ERRBAR=[res.WINDOW_FUNCTION_CALC_TYPES[0],res.WINDOW_FUNCTION_CALC_TYPES[2]];res.WINDOW_FUNCTION_CALC_TYPES_PIVOT=[res.WINDOW_FUNCTION_CALC_TYPES[0],res.WINDOW_FUNCTION_CALC_TYPES[1],res.WINDOW_FUNCTION_CALC_TYPES[2],res.WINDOW_FUNCTION_CALC_TYPES[3],res.WINDOW_FUNCTION_CALC_TYPES[4],res.WINDOW_FUNCTION_CALC_TYPES[5],res.WINDOW_FUNCTION_CALC_TYPES[6]];res.DEFAULT_CATEG_COLOR_NUM_GROUPS_TO_PRESERVE=20;res.DEFAULT_FACET_NUM_GROUPS_TO_PRESERVE=20;res.DEFAULT_GROUP_BY_NUM_GROUPS_TO_PRESERVE=1e3;res.DEFAULT_PIVOT_NUM_GROUPS_TO_PRESERVE=100;res.DEFAULT_SCATTER_X_NUM_GROUPS_TO_PRESERVE=200;res.DEFAULT_SCATTER_Y_NUM_GROUPS_TO_PRESERVE=200;res.DEFAULT_HEATMAP_X_NUM_GROUPS_TO_PRESERVE=200;res.DEFAULT_HEATMAP_Y_NUM_GROUPS_TO_PRESERVE=200;res.DEFAULT_BUBBLE_X_NUM_GROUPS_TO_PRESERVE=200;res.DEFAULT_BUBBLE_Y_NUM_GROUPS_TO_PRESERVE=200;var _createCalcTypesHash=function(definitionArr){var obj={};definitionArr.forEach(function(item){obj[item.value]=item});return obj};res.WINDOW_FUNCTION_CALC_TYPES_HASH=_createCalcTypesHash(res.WINDOW_FUNCTION_CALC_TYPES);var _createCalcDetailTypesHash=function(definitionArr){var ht={};definitionArr.forEach(function(item){var detailHt={};item.items.forEach(function(x){detailHt[_getAggFuncNameFromWinFuncName(x.value)]=x.value});ht[item.value]=detailHt});return ht};var _getAggFuncNameFromWinFuncName=function(windowFuncValue){var aggFuncName=windowFuncValue==="ptotal"?"sum":windowFuncValue==="dfirst"?"first":windowFuncValue==="pdfirst"?"first":windowFuncValue==="pofmedian"?"med":/^roll/.test(windowFuncValue)?windowFuncValue.replace(/^roll/,""):/^pof/.test(windowFuncValue)?windowFuncValue.replace(/^pof/,""):/^df/.test(windowFuncValue)?windowFuncValue.replace(/^df/,""):/^pdf/.test(windowFuncValue)?windowFuncValue.replace(/^pdf/,""):/^cum/.test(windowFuncValue)?windowFuncValue.replace(/^cum/,""):windowFuncValue;return aggFuncName};res.getAggFuncNameFromWinFuncName=_getAggFuncNameFromWinFuncName;res.WINDOW_FUNCTION_CALC_DETAIL_TYPES_HASH=_createCalcDetailTypesHash(res.WINDOW_FUNCTION_CALC_TYPES);res.WINDOW_FUNCTION_OPTIONS=[{label:"(none)",value:Column.OperationType.NONE},{label:"Cumulative Sum",value:Column.OperationType.CUMSUM},{label:"Cumulative Sum Ratio",value:Column.OperationType.PCT_CUMSUM},{label:"Cumulative Average",value:Column.OperationType.CUMMEAN},{label:"Cumulative Min",value:Column.OperationType.CUMMIN},{label:"Cumulative Max",value:Column.OperationType.CUMMAX},{label:"Cumulative Prod",value:Column.OperationType.CUMPROD},{label:"% of Total",value:Column.OperationType.PCT_OF_TOTAL},{label:"% of First",value:Column.OperationType.PCT_OF_FIRST},{label:"% of Last",value:Column.OperationType.PCT_OF_LAST},{label:"% of Min",value:Column.OperationType.PCT_OF_MIN},{label:"% of Max",value:Column.OperationType.PCT_OF_MAX},{label:"% of Average",value:Column.OperationType.PCT_OF_MEAN},{label:"% of Median",value:Column.OperationType.PCT_OF_MEDIAN},{label:"% of Mode",value:Column.OperationType.PCT_OF_MODE},{label:"Difference from Previous",value:Column.OperationType.DIFF_FROM_PREV},{label:"Difference from Next",value:Column.OperationType.DIFF_FROM_NEXT},{label:"Difference from First",value:Column.OperationType.DIFF_FROM_FIRST},{label:"Difference from Last",value:Column.OperationType.DIFF_FROM_LAST},{label:"Difference from Min",value:Column.OperationType.DIFF_FROM_MIN},{label:"Difference from Max",value:Column.OperationType.DIFF_FROM_MAX},{label:"Difference from Average",value:Column.OperationType.DIFF_FROM_MEAN},{label:"Difference from Median",value:Column.OperationType.DIFF_FROM_MEDIAN},{label:"Difference from Mode",value:Column.OperationType.DIFF_FROM_MODE},{label:"% Difference from Previous",value:Column.OperationType.PCT_DIFF_FROM_PREV},{label:"% Difference from Next",value:Column.OperationType.PCT_DIFF_FROM_NEXT},{label:"% Difference from First",value:Column.OperationType.PCT_DIFF_FROM_FIRST},{label:"% Difference from Last",value:Column.OperationType.PCT_DIFF_FROM_LAST},{label:"% Difference from Min",value:Column.OperationType.PCT_DIFF_FROM_MIN},{label:"% Difference from Max",value:Column.OperationType.PCT_DIFF_FROM_MAX},{label:"% Difference from Average",value:Column.OperationType.PCT_DIFF_FROM_MEAN},{label:"% Difference from Median",value:Column.OperationType.PCT_DIFF_FROM_MEDIAN},{label:"% Difference from Mode",value:Column.OperationType.PCT_DIFF_FROM_MODE},{label:"Moving Average",value:Column.OperationType.ROLL_MEAN},{label:"Moving Min",value:Column.OperationType.ROLL_MIN},{label:"Moving Max",value:Column.OperationType.ROLL_MAX},{label:"Moving Median",value:Column.OperationType.ROLL_MEDIAN},{label:"Moving Standard Deviation",value:Column.OperationType.ROLL_SD},{label:"Moving Variance",value:Column.OperationType.ROLL_VAR},{label:"Moving Sum",value:Column.OperationType.ROLL_SUM},{label:"Moving Prod",value:Column.OperationType.ROLL_PROD},{label:"Min Rank",value:Column.OperationType.MIN_RANK},{label:"Dense Rank",value:Column.OperationType.DENSE_RANK},{label:"Percent Rank",value:Column.OperationType.PCT_RANK}];res.WINDOW_FUNCTION_OPTIONS_HASH=_createHash(res.WINDOW_FUNCTION_OPTIONS);res.REFERENCE_LINE_OPTIONS=[{label:"Sum",value:Column.OperationType.SUM},{label:"Avg.",value:Column.OperationType.AVERAGE},{label:"Med.",value:Column.OperationType.MEDIAN},{label:"Mode",value:Column.OperationType.MODE},{label:"Min",value:Column.OperationType.MIN},{label:"Max",value:Column.OperationType.MAX},{label:"First",value:Column.OperationType.FIRST_EXCLUDE_NA},{label:"Last",value:Column.OperationType.LAST_EXCLUDE_NA},{label:"First",value:Column.OperationType.FIRST},{label:"Last",value:Column.OperationType.LAST},{label:"Diagonal",value:Column.OperationType.DIAGONAL},{label:"Const.",value:Column.OperationType.CONSTANT}];res.REFERENCE_LINE_OPTIONS_HASH=_createHash(res.REFERENCE_LINE_OPTIONS);res.PIVOT_TOTAL_AGGREGATION_OPTIONS=[{value:"",label:"AUTO",shortLabel:"AUTO"},{value:Column.OperationType.SUM,label:"Sum",shortLabel:"SUM"},{value:Column.OperationType.AVERAGE,label:"Mean (Average)",shortLabel:"AVG"},{value:Column.OperationType.MEDIAN,label:"Median",shortLabel:"MED"},{value:Column.OperationType.MODE,label:"Mode",shortLabel:"MODE"},{value:Column.OperationType.MIN,label:"Min Value",shortLabel:"MIN"},{value:Column.OperationType.MAX,label:"Max Value",shortLabel:"MAX"}];res.PIVOT_TOTAL_AGGREGATION_OPTIONS_SHORT_NAME_HASH=_createHash(res.PIVOT_TOTAL_AGGREGATION_OPTIONS,"shortLabel");res.PIVOT_TOTAL_AGGREGATION_OPTIONS_HASH=_createHash(res.PIVOT_TOTAL_AGGREGATION_OPTIONS);var MAX_NUMBER_OF_CONTROLS={rowh:10,colh:1,meas:30,y:30,tcol:300,scattermatrix:50};res.MAX_NUMBER_OF_CONTROLS=MAX_NUMBER_OF_CONTROLS;res.AXIS_DIRECTION_OPTIONS=[{label:"Normal",value:"normal"},{label:"Reversed",value:"reversed"},{label:"Default",value:""}];res.BUCKET_TYPE_OPTIONS=[{value:Column.OperationType.BUCKET_EQUAL_WIDTH,label:"Equal Width"},{value:Column.OperationType.BUCKET_EQUAL_FREQ,label:"Equal Frequency"},{value:Column.OperationType.BUCKET_CUSTOM,label:"Manual"},{value:Column.OperationType.BUCKET_OUTLIER,label:"Outliers"}];res.BUCKET_TYPE_OPTIONS_HASH=_createHash(res.BUCKET_TYPE_OPTIONS);res.BUCKET_TYPE_OPTIONS_HASH[Column.OperationType.BUCKET_OUTLIER_IQR]="IQR";res.BUCKET_TYPE_OPTIONS_HASH[Column.OperationType.BUCKET_OUTLIER_PERCENTILE]="Percentile";res.BUCKET_TYPE_OPTIONS_HASH[Column.OperationType.BUCKET_OUTLIER_SD]="Standard Deviation";res.BUCKET_OUTLIER_OPTIONS=[{value:Column.OperationType.BUCKET_OUTLIER_IQR,label:"IQR"},{value:Column.OperationType.BUCKET_OUTLIER_PERCENTILE,label:"Percentile"},{value:Column.OperationType.BUCKET_OUTLIER_SD,label:"Standard Deviation"}];res.BUCKET_OUTLIER_OPTIONS_HASH=_createHash(res.BUCKET_OUTLIER_OPTIONS);res.getBucketType=function(opId,options){var bucketType=options[opId+"BucketType"]||Column.OperationType.BUCKET_EQUAL_WIDTH;if(bucketType===Column.OperationType.BUCKET_OUTLIER){bucketType=options[opId+"BucketOutlierType"]||Column.OperationType.BUCKET_OUTLIER_IQR}return bucketType};res.getOptions=function(vizOptionsJson,option){var i=0,res=[],max=MAX_NUMBER_OF_CONTROLS[option];if(vizOptionsJson.marker==="scattermatrix"&&option==="y"){max=MAX_NUMBER_OF_CONTROLS["scattermatrix"]}if(max===undefined){throw new Error("not supported case")}else{for(i=0;i<max;i++){if(i===0&&option==="y"){res.push(vizOptionsJson[option])}else{res.push(vizOptionsJson[option+i])}}while(res.length>0&&!res[res.length-1]){res.pop()}return res}};var _createNameHash=function(arr){var obj={};arr.forEach(function(item){obj[item.value]=item});return obj};res.QUANT_COLOR_PALETTES_BASE=[{value:"Blues",label:"Blue",color:["#eff3ff","#bdd7e7","#6baed6","#3182bd","#08519c"],textColor:["","","","#fff","#fff"],sampleColor:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#08519c","#084594","#08306b"]},{value:"Greens",label:"Green",color:["#edf8e9","#bae4b3","#74c476","#31a354","#006d2c"],textColor:["","","","#fff","#fff"],sampleColor:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#006d2c","#005a32","#00441b"]},{value:"Oranges",label:"Orange",color:["#feedde","#fdbe85","#fd8d3c","#e6550d","#a63603"],textColor:["","","","#fff","#fff"],sampleColor:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#a63603","#8c2d04","#7f2704"]},{value:"Purples",label:"Purple",color:["#f2f0f7","#cbc9e2","#9e9ac8","#756bb1","#54278f"],textColor:["","","","#fff","#fff"],sampleColor:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#54278f","#4a1486","#3f007d"]},{value:"Reds",label:"Red",color:["#fee5d9","#fcae91","#fb6a4a","#de2d26","#a50f15"],textColor:["","","","#fff","#fff"],sampleColor:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#99000d","#67000d"]},{value:"Viridis",label:"Viridis",color:["#FDE725","#5DC863","#21908C","#3B528B","#440154"],textColor:["#fff","#fff","#fff","",""],sampleColor:["#FDE725","#B4DE2C","#6DCD59","#35B779","#1F9E89","#26828E","#31688E","#3E4A89","#482878","#440154"]},{value:"YlGn",label:"Yellow-Green",color:["#ffffcc","#c2e699","#78c679","#31a354","#006837"],textColor:["","","","#fff","#fff"],sampleColor:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#006837","#005a32","#004529"]},{value:"YlGnBu",label:"Yellow-Green-Blue",color:["#ffffcc","#a1dab4","#41b6c4","#2c7fb8","#253494"],textColor:["","","","#fff","#fff"],sampleColor:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#0c2c84","#081d58"]},{value:"YlOrBr",label:"Yellow-Orange-Brown",color:["#ffffd4","#fed98e","#fe9929","#d95f0e","#993404"],textColor:["","","","#fff","#fff"],sampleColor:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#993404","#8c2d04","#662506"]},{value:"YlOrRd",label:"Yellow-Orange-Red",color:["#ffffb2","#fecc5c","#fd8d3c","#f03b20","#bd0026"],textColor:["","","","#fff","#fff"],sampleColor:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#bd0026","#b10026","#800026"]},{value:"RdBu",label:"Red-Blue",color:["rgb(5,10,172)","rgb(106,137,247)","rgb(190,190,190)","rgb(230,145,90)","rgb(178,10,28)"],textColor:["#fff","","","","#fff"]},{value:"RdLb",label:"Red-Light Blue",color:["#4A90E2","#b3cae4","rgba(170,170,170,0.41)","rgba(222,145,158,1)","rgba(231,66,12,1)"],textColor:["#fff","","","","#fff"]},{value:"RdYlBu",label:"Red-Yellow-Blue Diverging",color:["#d7191c","#fdae61","#ffffbf","#abd9e9","#2c7bb6"],textColor:["#fff","","","","#fff"]},{value:"RdYlGn",label:"Red-Yellow Green Diverging",color:["#d7191c","#fdae61","#ffffbf","#a6d96a","#1a9641"],textColor:["#fff","","","","#fff"]}];res.CATEG_COLOR_PALETTES_BASE=[{value:"default",label:"Palette 1",color:["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"],textColor:["#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff"]},{value:"Paired",label:"Palette 2",color:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00"],textColor:["#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff"]},{value:"Pastel1",label:"Palette 3",color:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec"],textColor:["#000","#000","#000","#000","#000","#000","#000","#000"]},{value:"Pastel2",label:"Palette 4",color:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc","#cccccc"],textColor:["#000","#000","#000","#000","#000","#000","#000","#000"]},{value:"Set1",label:"Palette 5",color:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf"],textColor:["#fff","#fff","#fff","#fff","#fff","#fff","#000","#fff","#fff"]},{value:"Set2",label:"Palette 6",color:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494","#b3b3b3"],textColor:["#000","#000","#000","#000","#000","#000","#000","#000","#000"]},{value:"Set3",label:"Palette 7",color:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5"],textColor:["#000","#000","#000","#000","#000","#000","#000","#000","#000"]},{value:"Accent",label:"Palette 8",color:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17","#666666"],textColor:["","","","","#fff","#fff","#fff","#fff"]},{value:"Dark2",label:"Palette 9",color:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666"],textColor:["#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff"]},{value:"Milano",label:"Palette 10",color:["#F1632C","#FAA234","#AB9A84","#6B6258","#B2B148","#507B52","#91C699","#718BA3","#CEC58B","#3E556E"],textColor:["#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff"]},{value:"Cat10",label:"Palette 11",color:["#3C6398","#EF7B13","#DA3E44","#63AAA3","#47953A","#E9C12C","#A06291","#FC8795","#8A624B","#ACA09C"],
textColor:["#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff"]},{value:"Cat25",label:"Palette 12",color:["#3C6398","#8EBFE4","#EF7B13","#FEB165","#47953A","#7ACC66","#A88A17","#EEC748","#398882","#73B0A7","#7ACC66","#A88A17","#EEC748","#398882","#73B0A7","#DA3E44","#FD8886","#665D5B","#ACA09C","#C95983","#F9AEC8","#A06291","#CA91BD","#8C634C","#CEA694"],textColor:["#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff"]},{value:"Cat12",label:"Palette 13",color:["#3E923C","#75CC69","#EB7807","#FCBC53","#2D98AF","#86D1DF","#82970D","#B7C921","#8F7303","#F5CF0A","#1C786B","#7AB497"],textColor:["#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff"]},{value:"B1",label:"Palette 14 (Color Blind)",color:["#0B5A9C","#FB6708","#929BAB","#454D58","#4C8FC5","#BC3D05","#68707D","#92C0E5","#FDAF61","#BCC5D1"],textColor:["#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff"]},{value:"Logi1",label:"Palette 15 (Logical)",color:["rgba(98,165,21,1)","rgba(231,66,12,1)","#cccccc"],textColor:["#fff","#fff","#fff"]},{value:"Outlier1",label:"Palette 16 (Outlier)",color:["rgba(231,66,12,1)","rgba(170,170,170,0.41)","rgba(231,66,12,1)","rgba(170,170,170,0.41)"],textColor:["#fff","#000","#fff","#000"]},{value:"Outlier2",label:"Palette 17 (Outlier)",color:["rgba(231,66,12,1)","rgba(170,170,170,0.41)","rgba(98,165,21,1)","rgba(170,170,170,0.41)"],textColor:["#fff","#000","#fff","#000"]},{value:"Analytics1",label:"Palette 18 (Analytics)",color:["#4A90E2","rgba(231,66,12,1)","rgba(170,170,170,0.41)"],textColor:["#fff","#fff","#fff"]},{value:"Analytics1r",label:"Palette 19 (Analytics)",color:["rgba(231,66,12,1)","#4A90E2","rgba(170,170,170,0.41)"],textColor:["#fff","#fff","#fff"]},{value:"Analytics2",label:"Palette 20 (Analytics)",color:["#4A90E2","rgba(231,66,12,1)"],textColor:["#fff","#fff"]},{value:"Analytics3",label:"Palette 21 (Analytics)",color:["rgba(40,110,175,1)","rgba(170,170,170,0.41)"],textColor:["#fff","#fff"]},{value:"Analytics4",label:"Palette 22 (Analytics)",color:["#4A90E2","rgba(98,165,21,1)","rgba(231,66,12,1)"],textColor:["#fff","#fff","#fff"]},{value:"Analytics4r",label:"Palette 23 (Analytics)",color:["#4A90E2","rgba(231,66,12,1)","rgba(98,165,21,1)"],textColor:["#fff","#fff","#fff"]},{value:"Analytics5",label:"Palette 24 (Analytics)",color:["#4A90E2","#dcdee0","rgba(98,165,21,1)","rgba(231,66,12,1)"],textColor:["#fff","#fff","#fff","#fff"]},{value:"Analytics5r",label:"Palette 25 (Analytics)",color:["#4A90E2","#dcdee0","rgba(231,66,12,1)","rgba(98,165,21,1)"],textColor:["#fff","#fff","#fff","#fff"]},{value:"Analytics6",label:"Palette 26 (Analytics)",color:["#dcdee0","#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"],textColor:["#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff"]},{value:"Analytics6r",label:"Palette 27 (Analytics)",color:["#dcdee0","#17becf","#bcbd22","#7f7f7f","#e377c2","#8c564b","#9467bd","#d62728","#2ca02c","#ff7f0e","#1f77b4"],textColor:["#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff"]},{value:"Analytics7",label:"Palette 28 (Analytics)",color:["#1f77b4","#ff7f0e","#2ca02c"],textColor:["#fff","#fff"]},{value:"Analytics8",label:"Palette 29 (Analytics)",color:["rgba(170,170,170,0.41)"],textColor:["#fff"]},{value:"Analytics9",label:"Palette 30 (Analytics)",color:["#1f77b4","rgba(170,170,170,0.41)"],textColor:["#fff","#fff"]},{value:"Analytics10",label:"Palette 31 (Analytics)",color:["#1f77b4","#51A7F9","#ff7f0e","#2ca02c"],textColor:["#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff"]},{value:"Analytics11",label:"Palette 32 (Analytics)",color:["#84BC54","#F0D351","rgba(170,170,170,0.41)"],textColor:["#fff"]},{value:"Analytics12",label:"Palette 33 (Analytics)",color:["#4A90E2","rgba(231,66,12,1)"],textColor:["#fff","#fff","#fff"]},{value:"Analytics13",label:"Palette 34 (Analytics)",color:["#4A90E2","#dcdee0","rgba(231,66,12,1)"],textColor:["#fff","#fff","#fff","#fff"]},{value:"Analytics14",label:"Palette 35 (Analytics)",color:["#dcdee0","#1f77b4"],textColor:["#fff","#fff","#fff","#fff"]}];res.CATEG_COLOR_PALETTES=res.CATEG_COLOR_PALETTES_BASE.concat(res.QUANT_COLOR_PALETTES_BASE);res.CATEG_COLOR_PALETTES_NO_CUSTOM=res.CATEG_COLOR_PALETTES_BASE.concat(res.QUANT_COLOR_PALETTES_BASE);res.QUANT_COLOR_PALETTES=res.QUANT_COLOR_PALETTES_BASE.concat(res.CATEG_COLOR_PALETTES_BASE);res.CATEG_COLOR_PALETTES.push({value:"custom",label:"Custom",color:["#cccccc","#cccccc","#cccccc","#cccccc","#cccccc","#cccccc","#cccccc","#cccccc","#cccccc"],textColor:["#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff"]});res.QUANT_COLOR_PALETTES_HASH=_createNameHash(res.QUANT_COLOR_PALETTES);res.CATEG_COLOR_PALETTES_HASH=_createNameHash(res.CATEG_COLOR_PALETTES);res.CATEG_COLOR_PALETTES_NO_ANALYTICS=res.CATEG_COLOR_PALETTES.filter(function(c){return!/^Analytics/.test(c.value)});res.QUANT_COLOR_PALETTES_NO_ANALYTICS=res.QUANT_COLOR_PALETTES.filter(function(c){return!/^Analytics/.test(c.value)});var hexToRgb=function(hex){var result,base;if(/^rgb/.test(hex.trim())){result=/([\d]+)[, ]*([\d]+)[, ]*([\d]+)/.exec(hex.trim());base=10}else{result=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex.trim());base=16}return result?{r:parseInt(result[1],base),g:parseInt(result[2],base),b:parseInt(result[3],base)}:null};var hexToRgba=function(hex,opacity){var rgb=hexToRgb(hex);if(rgb===null){rgb={r:204,g:204,b:204}}return"rgba("+rgb.r+","+rgb.g+","+rgb.b+","+opacity+")"};var rgbaToHex=function(orig){var a,isPercent,rgb=orig.replace(/\s/g,"").match(/^rgba?\((\d+),(\d+),(\d+),?([^,\s)]+)?/i),alpha=(rgb&&rgb[4]||"").trim(),hex=rgb?(rgb[1]|1<<8).toString(16).slice(1)+(rgb[2]|1<<8).toString(16).slice(1)+(rgb[3]|1<<8).toString(16).slice(1):orig;if(alpha!==""){a=alpha}else{a=1}a=(a*255|1<<8).toString(16).slice(1);hex=hex+a;return"#"+hex};var rgbToHex=function(color){color=""+color;if(!color||color.indexOf("rgb")<0){return}if(color.charAt(0)=="#"){return color}var nums=/(.*?)rgb\((\d+),\s*(\d+),\s*(\d+)\)/i.exec(color),r=parseInt(nums[2],10).toString(16),g=parseInt(nums[3],10).toString(16),b=parseInt(nums[4],10).toString(16);return"#"+((r.length==1?"0"+r:r)+(g.length==1?"0"+g:g)+(b.length==1?"0"+b:b))};res.hexToRgb=hexToRgb;res.hexToRgba=hexToRgba;res.rgbaToHex=rgbaToHex;res.rgbToHex=rgbToHex;res.getDefaultColorPalette=function(bucketType){switch(bucketType){case Column.OperationType.BUCKET_EQUAL_FREQ:case Column.OperationType.BUCKET_EQUAL_WIDTH:return"Blues";case Column.OperationType.BUCKET_OUTLIER_IQR:case Column.OperationType.BUCKET_OUTLIER_PERCENTILE:case Column.OperationType.BUCKET_OUTLIER_SD:return"Outlier2";case Column.OperationType.BUCKET_KMEANS:return"default";case Column.OperationType.BUCKET_CUSTOM:return"Blues";case Column.OperationType.BUCKET_LOGICAL:return"Logi1"}return null};res.getDefaultOpacity=function(options){switch(options.marker){case"scatter":case"scattermatrix":case"bubble":case"area":return.8;case"hist":return!options.color?.9:.6;case"densityplot":return.2;default:return null}};res.getDefaultColorStackDirection=function(options){if(options.colorbucket&&options.colorBucketType==="bucket_outlier"){return"reversed"}else{return"normal"}};res.getDefaultSingleValueValue=function(col){if(col&&/^(count|countd|sum|distinct|nacount|nnacount|truecount|falsecount)$/.test(col.func)){return"0"}else{return"<NA>"}};res.getPivotTotalAggregationFunc=function(columnFunc,pivotAggFunc,isNumeric){if(!pivotAggFunc){switch(columnFunc){case Column.OperationType.SUM:case Column.OperationType.AVERAGE:case Column.OperationType.MEDIAN:case Column.OperationType.MIN:case Column.OperationType.MAX:case Column.OperationType.DATE_MIN:case Column.OperationType.DATE_MAX:return columnFunc;case Column.OperationType.ALL:return Column.OperationType.ALL_PIVOT_TOTAL;case Column.OperationType.ANY:return Column.OperationType.ANY_PIVOT_TOTAL;case Column.OperationType.FIRST:case Column.OperationType.LAST:case Column.OperationType.MODE:return isNumeric?Column.OperationType.AVERAGE:columnFunc;case Column.OperationType.COUNT:case Column.OperationType.COUNT_DISTINCT:return Column.OperationType.SUM;default:return Column.OperationType.AVERAGE}}else{return pivotAggFunc}};res.getDefaultHoverMode=function(marker){switch(marker){case"boxplot":return"x";default:return"closest"}};res.getDefaultAxisDirection=function(marker,option){return"normal"};res.isAxisDirectionEnabled=function(marker){return res.isPlotly(marker)&&!/^(pie|hist|densityplot)$/.test(marker)};res.isColorStackDirectionEnabled=function(marker,barStyle,barOrientation){return marker==="area"||marker==="bar"&&barStyle!=="group"&&barOrientation!=="horizontal"};res.isColorHighlightSupported=function(marker){return res.isPlotly(marker)&&!/^(heatmap|contour)$/.test(marker)||/^(geojson|map)$/.test(marker)};res.isRecodeSupported=function(marker,option){return(res.isPlotly(marker)||res.isLeaflet(marker))&&option==="color"};res.isRecodeEnabled=function(marker,option,column){return res.isRecodeSupported(marker,option)&&column&&!VizUtil.isContinuousValue(column,marker,option)};res.getBucketInfo=function(data,bucketProp){var hash={};data.forEach(function(d){if(!!d[bucketProp]&&!hash[d[bucketProp]]){hash[d[bucketProp]]=1}});var exts=Object.keys(hash).map(function(key){var ext=key.replace(/[\[\(\]]/g,"").split(",");ext=ext.map(function(m){return parseFloat(m)});return{key:key,extent:ext}});exts=exts.sort(function(a,b){return a.extent[0]-b.extent[0]});exts=exts.map(function(m,idx){m.id=idx+1;return m});var h={};exts.forEach(function(m){h[m.key]=m.id});var isNew=true;Object.keys(hash).forEach(function(key){isNew=isNew&&/\]/.test(key)});return{legend:isNew?exts:null,map:h}};res.formatColorBucketData=function(data,colorBucketCol,formatter){var v;data.forEach(function(d){v=d[colorBucketCol];if(v){v=v.trim();if(/^[\[\(].*[\)\]]$/.test(v)){v=v.replace(/[\[\]\(\)]/g,"");v=v.split(",");v=formatter(v[0])+" - "+formatter(v[1]);d[colorBucketCol]=v}}else{d[colorBucketCol]=null}})};var escapeForQuotedStringInR=function(exp){return exp.replace(/\\/g,"\\\\").replace(/"/g,'\\"')};res.addBucketInfo=function(vizOptions,opId,attrs,ops){var bucketType=res.getBucketType(opId,vizOptions);var bucketAttrs=res.constructBucketAttributes(opId,vizOptions,bucketType);if(bucketAttrs){var type=vizOptions[opId+"BucketType"];if(type===Column.OperationType.BUCKET_OUTLIER||type===Column.OperationType.BUCKET_EQUAL_WIDTH||type===Column.OperationType.BUCKET_EQUAL_FREQ){var x=vizOptions["x"],facet=vizOptions["facet"];switch(vizOptions[opId+"BucketGroup"]){case"facet":bucketAttrs[Column.Attribute.BUCKET_GROUP_BY_COLUMN]=facet?facet.validLabel:null;bucketAttrs[Column.Attribute.BUCKET_GROUP_BY_COLUMN_ORIGINAL_NAMES]=facet?facet.validName:null;break;case"xaxis":bucketAttrs[Column.Attribute.BUCKET_GROUP_BY_COLUMN]=x?x.validLabel:null;bucketAttrs[Column.Attribute.BUCKET_GROUP_BY_COLUMN_ORIGINAL_NAMES]=x?x.validName:null;break;case"xaxis+facet":bucketAttrs[Column.Attribute.BUCKET_GROUP_BY_COLUMN]=x&&facet?facet.validLabel+","+x.validLabel:null;bucketAttrs[Column.Attribute.BUCKET_GROUP_BY_COLUMN_ORIGINAL_NAMES]=x&&facet?facet.validName+","+x.validName:null;break;case"all":default:break}}Object.keys(bucketAttrs).forEach(function(key){attrs[key]=bucketAttrs[key]});ops.push(Column.OperationType.CUT);ops.push(bucketType)}};res.constructBucketAttributes=function(opId,vizOptions,bucketType){var attrs={};switch(bucketType){case Column.OperationType.BUCKET_EQUAL_FREQ:case Column.OperationType.BUCKET_EQUAL_WIDTH:var useIndexForDefaultLabels=vizOptions[opId+"BucketGroup"]&&vizOptions[opId+"BucketGroup"]!=="all";attrs.numOfBuckets=vizOptions[opId+"BucketNumOfBuckets"]||5;attrs.numDecimalDigits=vizOptions["numDecimalDigits"]||2;attrs.cutZeroToCenter=vizOptions[opId+"SetZeroToCenter"]==="on"?"TRUE":"FALSE";attrs.labelsExp=res.constructBucketLabels(vizOptions[opId+"BucketLabels"],attrs.numOfBuckets,useIndexForDefaultLabels);break;case Column.OperationType.BUCKET_OUTLIER_IQR:attrs.labelsExp=res.constructBucketLabels(vizOptions[opId+"BucketOutlierLabels"],3,false);break;case Column.OperationType.BUCKET_OUTLIER_PERCENTILE:var pctThreshold=vizOptions[opId+"BucketPctThreshold"];var isPctInvalid=pctThreshold&&(pctThreshold<=0||pctThreshold>=1);attrs.outlierPctThreshold=isPctInvalid?.95:pctThreshold;attrs.labelsExp=res.constructBucketLabels(vizOptions[opId+"BucketOutlierLabels"],3,false);break;case Column.OperationType.BUCKET_OUTLIER_SD:var sdThreshold=vizOptions[opId+"BucketSdThreshold"];var isSdInvalid=sdThreshold&&sdThreshold<=0;attrs.outlierSdThreshold=isSdInvalid?2:sdThreshold;attrs.labelsExp=res.constructBucketLabels(vizOptions[opId+"BucketOutlierLabels"],3,false);break;case Column.OperationType.BUCKET_KMEANS:attrs.kmeansNumOfBuckets=vizOptions[opId+"BucketKmeansNumOfBuckets"]||3;break;case Column.OperationType.BUCKET_CUSTOM:var cpValue=vizOptions[opId+"BucketCuttingPoints"];var isCpInvalid=cpValue&&/[^0-9,\. ]/.test(cpValue);attrs=res.constructCustomBucketAttributes(isCpInvalid?"":cpValue,vizOptions[opId+"BucketLabels"],vizOptions[opId+"BucketIncludeOutsideRange"]!=="off",vizOptions[opId+"BucketIncludeRightEdge"]!=="off",vizOptions[opId+"BucketIncludeLowest"]!=="off",10);break;case Column.OperationType.BUCKET_LOGICAL:break}var color=vizOptions["color"],marker=vizOptions["marker"];attrs[Column.Attribute.BUCKET_PRIORITY]=opId==="x"||opId==="y"?1:2;if(color&&opId==="color"){var valuePrefix=res.getValuePrefix(vizOptions["colorNumberFormatting"],vizOptions["colorCurrencySymbol"],marker);attrs[Column.Attribute.VALUE_PREFIX]=valuePrefix;var valueSuffix=res.getValueSuffix(vizOptions["colorWindowFunc"],color.func,vizOptions["colorNumberFormatting"],marker);attrs[Column.Attribute.VALUE_SUFFIX]=valueSuffix}return attrs};res.constructCustomBucketAttributes=function(breaksTxt,labelsTxt,includeOutsideRange,includeRightEdge,includeLowest,digLab){var breaksExp,labelsExp,breaks,labels;if(!breaksTxt){breaks=["-Inf","Inf"];breaksExp="c("+breaks.join(",")+")"}else{breaks=breaksTxt.split(",");if(includeOutsideRange){breaks.push("Inf");breaks.unshift("-Inf")}}breaksExp="c("+breaks.map(function(x){return x.endsWith("Inf")?x:parseFloat(x)}).join(",")+")";labelsExp=res.constructBucketLabels(labelsTxt,breaks.length-1,false);return{breaksExp:breaksExp,expectedNumberOfLabels:breaks.length-1,labelsExp:labelsExp,includeLowest:includeLowest?"TRUE":"FALSE",includeRightEdge:includeRightEdge?"TRUE":"FALSE",digLab:digLab}};res.constructBucketLabels=function(labelsTxt,numOfLabels,useIndexForDefaultLabels){if(!labelsTxt&&!useIndexForDefaultLabels){return"NULL"}var labels=[];if(labelsTxt){labels=labelsTxt.trim().split(",");labels=labels.map(function(x){return x.trim()}).filter(function(x){return!!x})}if(labels.length<numOfLabels){for(i=labels.length;i<numOfLabels;i++){labels.push(String(i+1))}}else if(labels.length>numOfLabels){labels=labels.slice(0,numOfLabels)}return"c("+labels.map(function(x){return'"'+escapeForQuotedStringInR(x.trim())+'"'}).join(",")+")"};res.addOtherGroupInfo=function(vizOptions,opId,attrs,ops){attrs.removeOtherGroup=!vizOptions[opId+"ShowOtherGroup"]&&!!vizOptions[opId+"HideOtherGroup"]?vizOptions[opId+"HideOtherGroup"]==="on":vizOptions[opId+"ShowOtherGroup"]==="off";attrs.labelForOtherGroup=vizOptions[opId+"OtherGroupLabel"]||"Others";var type=vizOptions[opId+"EnableOtherGroup"];switch(type){case res.OTHER_GROUP_OPTION_TYPE.FCT_LUMP:default:ops.push(Column.OperationType.FCT_LUMP);attrs.numGroupsToPreserve=vizOptions[opId+"NumGroupsToPreserve"];if(!attrs.numGroupsToPreserve){switch(opId){case"categColor":attrs.numGroupsToPreserve=res.DEFAULT_CATEG_COLOR_NUM_GROUPS_TO_PRESERVE;break;case"facet":attrs.numGroupsToPreserve=res.DEFAULT_FACET_NUM_GROUPS_TO_PRESERVE;break;case"x":switch(vizOptions.marker){case"scatter":attrs.numGroupsToPreserve=res.DEFAULT_SCATTER_X_NUM_GROUPS_TO_PRESERVE;break;case"heatmap":attrs.numGroupsToPreserve=res.DEFAULT_HEATMAP_X_NUM_GROUPS_TO_PRESERVE;break;case"bubble":attrs.numGroupsToPreserve=res.DEFAULT_BUBBLE_X_NUM_GROUPS_TO_PRESERVE;break;default:attrs.numGroupsToPreserve=res.DEFAULT_CATEG_COLOR_NUM_GROUPS_TO_PRESERVE;break}break;case"groupby":attrs.numGroupsToPreserve=res.DEFAULT_GROUP_BY_NUM_GROUPS_TO_PRESERVE;break;default:if(/^y/.test(opId)){switch(vizOptions.marker){case"scatter":attrs.numGroupsToPreserve=res.DEFAULT_SCATTER_Y_NUM_GROUPS_TO_PRESERVE;break;case"heatmap":attrs.numGroupsToPreserve=res.DEFAULT_HEATMAP_Y_NUM_GROUPS_TO_PRESERVE;break;case"bubble":attrs.numGroupsToPreserve=res.DEFAULT_BUBBLE_Y_NUM_GROUPS_TO_PRESERVE;break;default:attrs.numGroupsToPreserve=res.DEFAULT_CATEG_COLOR_NUM_GROUPS_TO_PRESERVE;break}}else if(/^colh/.test(opId)){attrs.numGroupsToPreserve=res.DEFAULT_PIVOT_NUM_GROUPS_TO_PRESERVE}else if(/^rowh/.test(opId)){attrs.numGroupsToPreserve=res.DEFAULT_PIVOT_NUM_GROUPS_TO_PRESERVE}else{attrs.numGroupsToPreserve=res.DEFAULT_CATEG_COLOR_NUM_GROUPS_TO_PRESERVE}break}}break;case res.OTHER_GROUP_OPTION_TYPE.FCT_OTHER_DROP_VALUES:case res.OTHER_GROUP_OPTION_TYPE.FCT_OTHER_KEEP_VALUES:ops.push(Column.OperationType.FCT_OTHER);var otherGroupValues=vizOptions[opId+"OtherGroupValues"]||[];attrs.otherGroupValues="c("+otherGroupValues.map(function(col){return'"'+col.value+'"'}).join(",")+")";attrs.otherGroupValuesHandling=type===res.OTHER_GROUP_OPTION_TYPE.FCT_OTHER_DROP_VALUES?"drop":"keep";break}};res.distinct=function(arr){var u={},a=[];for(var i=0,l=arr.length;i<l;++i){if(u.hasOwnProperty(arr[i])){continue}a.push(arr[i]);u[arr[i]]=1}return a};res.isLeaflet=function(marker){return/^(geojson|map|maphmap)$/.test(marker)};res.isPivot=function(marker){return/^(pivot|table|singlevalue)$/.test(marker)};res.isROutput=function(marker){return/^r-/.test(marker)};res.isPlotly=function(marker){return!(res.isLeaflet(marker)||res.isPivot(marker)||res.isROutput(marker))};res.isWindowFunctionSupported=function(marker){return/^(bar|line|area|pivot)$/.test(marker)};res.isMultiYSupported=function(marker){return/^(bar|line|scatter|scattermatrix)$/.test(marker)};res.isSyncAxisSupported=function(marker){return!/^(pie|ring|heatmap)$/.test(marker)};res.isHoverModeSupported=function(marker){return/^(bar|line|area|hist|densityplot|scatter|bubble|errbar)$/.test(marker)};res.isColorBucketSupported=function(marker){return/^(bar|line|area|hist|densityplot|violin|boxplot|scatter|bubble|errbar|map|geojson)$/.test(marker)};res.isOtherGroupEnabled=function(opId,vizOptions){if(vizOptions[opId+"EnableOtherGroup"]==="off"){return false}var marker=vizOptions.marker;var isColorContinuous=vizOptions.color&&res.isContinuousValue(vizOptions.color,marker,"color");switch(opId){case"categColor":return!isColorContinuous&&/^(bar|line|area|pie|hist|densityplot|scatter|bubble|boxplot|violin|errbar|map|geojson)$/.test(marker);case"facet":return/^(bar|line|area|pie|hist|densityplot|scatter|bubble|boxplot|violin|errbar|heatmap)$/.test(marker);case"x":switch(marker){case"scatter":return res.returnsCharacterValue(vizOptions[opId]);case"heatmap":return true;case"bubble":return!res.isContinuousValue(vizOptions[opId],marker,opId);default:return false}case"groupby":switch(marker){case"bubble":return true;case"map":return vizOptions.groupby.type!==res.TYPE_ROWID;default:return false}return/^(bubble|map)$/.test(marker);default:if(/^y/.test(opId)){switch(marker){case"scatter":return res.returnsCharacterValue(vizOptions[opId]);case"heatmap":return true;case"bubble":return!res.isContinuousValue(vizOptions[opId],marker,opId);default:return false}}else if(/^colh/.test(opId)){return true}else if(/^rowh/.test(opId)){return true}else{return false}}return false};res.isManualSelectOtherGroupEnabled=function(opId,vizOptions){return res.isOtherGroupEnabled(opId,vizOptions)&&(vizOptions[opId+"EnableOtherGroup"]===VizUtil.OTHER_GROUP_OPTION_TYPE.FCT_OTHER_KEEP_VALUES||vizOptions[opId+"EnableOtherGroup"]===VizUtil.OTHER_GROUP_OPTION_TYPE.FCT_OTHER_DROP_VALUES)};res.applyColorBucketAfterSummarize=function(marker){return/^(scatter|bubble|map|geojson)$/.test(marker)};res.isIncludeOutlierEnabled=function(marker,includeOutlierPropValue){if(!includeOutlierPropValue){return!/^(violin|boxplot)$/.test(marker)}return includeOutlierPropValue==="on"};res.POST_FILTER_COLUMN_NAME=".postfilter";res.isPostFilterSupported=function(options){return/^(bar|errbar|violin|boxplot|bubble|geojson)$/.test(options.marker)};res.isPostFilterEnabled=function(options,option){if(options.marker==="geojson"&&options.colorbucket&&options.x){return true}else if(/^(bar|errbar|violin|boxplot)$/.test(options.marker)&&options.x){return true}else if(/^(bubble)$/.test(options.marker)&&options.x&&options.y){var isNumX=res.returnsNumericValue(options.x);var isNumY=res.returnsNumericValue(options.y);if(option==="y"){return isNumX&&!isNumY}else{return!isNumX&&isNumY}}else{return false}};res.isDualYSupported=function(marker,barstyle){return/^(bar|scatter|line|bubble)$/.test(marker)};res.getValueSuffix=function(winfunc,colfunc,numberFormatting,marker){if(numberFormatting==="percentage"&&/^(bar|line|area|scatter|bubble|pivot|singlevalue|table)$/.test(marker)){return"%"}if(colfunc&&/^(truepct|falsepct|napct|nnapct)$/.test(colfunc)){return"%"}if(!winfunc){return""}else{return/(^ptotal$|^pdf|^pof|^pcumsum$|^prank$)/.test(winfunc)?"%":""}};res.getValuePrefix=function(numberFormatting,prefix,marker){if(numberFormatting==="currency"&&/^(bar|line|area|scatter|bubble|pivot|singlevalue|table)$/.test(marker)){return prefix||""}return""};res.returnsNumericValue=function(col){if(!col||!col.name||!col.func){throw new Error("Invalid argument was passed to returnsNumericValue: "+JSON.stringify(col||"col is empty."))}return col.isNumeric&&col.func!=="aschar"||/^(sum|count|countd|ave|median|min|max|var|sd|iqr|mad|nacount|nnacount|napct|nnapct|truecount|falsecount|truepct|falsepct|asint|asintby10|ascategory)/.test(col.func)||col.isDate&&/^(year|halfyear|quarter|bimon|mon|day|hour|minute|second|week|week_of_quarter|week_of_month|dayofyear|dayofquarter|dayofweek)$/.test(col.func)};var HANDLE_OUTPUT_AS_CATEGORICAL=[Column.OperationType.AS_INTEGER,Column.OperationType.AS_INTEGER_BY10,Column.OperationType.ABS,Column.OperationType.LOG,Column.OperationType.LOG2,Column.OperationType.LOG10,Column.OperationType.YEAR,Column.OperationType.HALF_YEAR,Column.OperationType.QUARTER,Column.OperationType.BI_MONTH,Column.OperationType.MONTH,Column.OperationType.WEEK,Column.OperationType.DAY,Column.OperationType.DAY_OF_YEAR,Column.OperationType.DAY_OF_QUARTER,Column.OperationType.DAY_OF_WEEK,Column.OperationType.HOUR,Column.OperationType.MINUTE,Column.OperationType.SECOND,Column.OperationType.AS_CHAR,Column.OperationType.AS_LOGICAL_FACTOR,Column.OperationType.AS_DISCRETE_VALUES];var HANDLE_OUTPUT_AS_CATEGORICAL_AT_COLOR=[Column.OperationType.NONE,Column.OperationType.YEAR,Column.OperationType.HALF_YEAR,Column.OperationType.QUARTER,Column.OperationType.BI_MONTH,Column.OperationType.MONTH,Column.OperationType.WEEK,Column.OperationType.DAY,Column.OperationType.DAY_OF_YEAR,Column.OperationType.DAY_OF_QUARTER,Column.OperationType.DAY_OF_WEEK,Column.OperationType.HOUR,Column.OperationType.MINUTE,Column.OperationType.SECOND,Column.OperationType.AS_CHAR,Column.OperationType.AS_LOGICAL_FACTOR,Column.OperationType.AS_DISCRETE_VALUES];res.isContinuousValue=function(col,marker,option){if(option==="color"){if(marker==="bubble"){return res.returnsNumericValue(col)&&HANDLE_OUTPUT_AS_CATEGORICAL.indexOf(col.func)===-1&&col.func!==Column.OperationType.AS_NUM}else if(marker==="maphmap"){return res.returnsNumericValue(col)}else{return res.returnsNumericValue(col)&&HANDLE_OUTPUT_AS_CATEGORICAL_AT_COLOR.indexOf(col.func)===-1}}else{return res.returnsNumericValue(col)&&HANDLE_OUTPUT_AS_CATEGORICAL.indexOf(col.func)===-1}};res.returnsDateValue=function(col){if(!col||!col.name||!col.func){throw new Error("Invalid argument was passed to returnsDateValue.")}return col.isDate&&(!col.func||/^(rto|none$)/.test(col.func))};res.returnsCharacterValue=function(col){if(!col||!col.name||!col.func){throw new Error("Invalid argument was passed to returnsCharacterValue.")}return!res.returnsNumericValue(col)&&!res.returnsDateValue(col)};res.isEmpty=function(val){return typeof val==="undefined"||val===null};res.isUndefined=function(val){return typeof val==="undefined"};res.shouldRenderNoData=function(data,options){switch(options.marker){case"geojson":return!options.geojson;case"singlevalue":return false;case"pivot":return!data||data.length<3;default:if(/^r-/.test(options.marker)){return!data||!data.outputFile}else{return!data||data.length===0}}};var BalloonItemList=function(){this.top=[];this.main=[];this.bottom=[];this.indexed=[]};BalloonItemList.prototype.toArray=function(){if(this.indexed.length>0){return this.indexed.sort(function(a,b){return a.index-b.index}).map(function(x){return x.item})}else{return this.top.concat(this.main).concat(this.bottom)}};BalloonItemList.prototype.add=function(item,marker,option,isNumeric,section,index){if(typeof index==="number"){this.indexed.push({index:index,item:item});return}if(typeof item==="string"){var _idx=this.top.indexOf(item);if(_idx>-1){return}_idx=this.bottom.indexOf(item);if(_idx>-1){return}_idx=this.main.indexOf(item);if(_idx>-1){this.main.splice(_idx,1)}}if(section==="bottom"){this.bottom.unshift(item);return}if(/^label/.test(option)||section==="top"){this.top.push(item);return}switch(marker){case"bar":case"errbar":case"line":case"area":case"boxplot":case"violin":if(/^(x)$/.test(option)){this.top.push(item)}else{this.main.push(item)}break;case"heatmap":case"contour":if(/^(x|y)$/.test(option)){this.top.push(item)}else{this.main.push(item)}break;case"hist":case"densityplot":this.main.push(item);break;default:if(/^(x$|y|z)/.test(option)&&!isNumeric){this.top.push(item)}else{this.main.push(item)}break}};res.BalloonItemList=BalloonItemList;res.generateHighlightColorScale=function(defaultColor,highlightValues){var hash={};var ohash={};var ovhash={};highlightValues.forEach(function(v,idx,arr){hash[v.value]=v.color;ohash[v.color]=arr.length-idx;ovhash[v.value]=arr.length-idx});var scaleFunc=function(val){return!hash[val]?defaultColor:hash[val]};scaleFunc.domain=function(){};scaleFunc.getOrderByColor=function(val){return!ohash[val]?0:ohash[val]};scaleFunc.getOrderByValue=function(val){return!ovhash[val]?0:ovhash[val]};scaleFunc.isHighlightColorScale=true;return scaleFunc};res.renderNoData=function(div,msg,borderCss,hintText){if(!div){return}div.innerHTML='<div style="width:100%; height:100%; display:table;" class="viz-rendering-error">'+'<div style="width:100%; height:100%; display:table-cell; vertical-align:middle; text-align:center; font-size:14px; color:#999; padding:0 40px; '+(borderCss?"border:"+borderCss:"")+'">'+"<div>"+(msg?msg:"There is no data to display")+"</div>"+(hintText?'<div style="width:360px; margin:auto; margin-top:15px">'+hintText+"</div>":"")+"</div>"+"</div>"};res.COLOR_PALETTE_REGEX=/((rgb[a]*\([0-9 \,\.]*\))|\#[0-9a-fA-F]+)/g;res.isInColumnarFormat=function(data){return Object.prototype.toString.call(data)!=="[object Array]"};res.convertColumnarData=function(data){if(!data||!res.isInColumnarFormat(data)){return data}var cols=Object.keys(data),rows=[],idx=0,row=null;if(cols.length===0){return rows}while(idx<data[cols[0]].length){row={};cols.forEach(function(col){row[col]=data[col][idx]});rows.push(row);idx++}return rows};var decimalAdjust=function(type,value,exp){if(typeof exp==="undefined"||+exp===0){return Math[type](value)}value=+value;exp=+exp;if(value===null||isNaN(value)||!(typeof exp==="number"&&exp%1===0)){return NaN}if(value<0){return-decimalAdjust(type,-value,exp)}value=value.toString().split("e");value=Math[type](+(value[0]+"e"+(value[1]?+value[1]-exp:-exp)));value=value.toString().split("e");return+(value[0]+"e"+(value[1]?+value[1]+exp:exp))};res.round10=function(value,exp){return decimalAdjust("round",value,-exp)};res.floor10=function(value,exp){return decimalAdjust("floor",value,-exp)};res.ceil10=function(value,exp){return decimalAdjust("ceil",value,-exp)};res.isInSameCategory=function(dataType,targetDataType){dataType=/^(integer|double)/.test(dataType)?"numeric":/^(POSIX)/.test(dataType)?"Date":dataType;targetDataType=/^(integer|double)/.test(targetDataType)?"numeric":/^(POSIX)/.test(targetDataType)?"Date":targetDataType;return dataType===targetDataType};res.valueFormatterGenerator=function(numDecimalDigits,useThousandSeparator,truncateTrailingZeros){var fmtstr=useThousandSeparator===false?"":",";if(!res.isEmpty(numDecimalDigits)){fmtstr+="."+numDecimalDigits+"f"}var fmtr=d3.format(fmtstr);return function(v){if(v===undefined||v===null)return"";var s=fmtr(v);if(s!=="NaN"){if(truncateTrailingZeros&&s.indexOf(".")!==-1&&s.indexOf("e")===-1){s=s.replace(/[0]+$/,"");s=s.replace(/[\.]$/,"")}return s}else{s=v.toString();return s.length>60?s.substr(0,60)+"...":s}}};res.addOpacity=function(str,opacity){var p=typeof ratio==="string"?parseFloat(opacity):opacity;var code=res.getRGBACode(str);return"rgba("+code.r+","+code.g+","+code.b+","+p+")"};res.getRGBACode=function(str){var s,r,g,b,a;if(/rgb/.test(str)){s=str.replace(/(rgb\(|rgba\(|\))/g,"");s=s.split(",");r=parseInt(s[0]);g=parseInt(s[1]);b=parseInt(s[2]);a=s.length>3?s[3]:1}else{s=str.replace("#","");r=parseInt(s.substring(0,2),16);g=parseInt(s.substring(2,4),16);b=parseInt(s.substring(4,6),16);a=1}return{r:r,g:g,b:b,a:a}};res.isSortable=function(options,sortTarget,sortByTarget){return!(!options||!sortTarget||!sortByTarget||!options[sortTarget]||!options[sortByTarget]||!res.returnsCharacterValue(options[sortTarget])||!res.returnsNumericValue(options[sortByTarget]))};res.isSortSupported=function(marker){return/^(bar|errbar|bubble|boxplot|violin)$/.test(marker)};res.analyticify=function(viz){var options=!!viz.options?viz.options:viz;if(!options.facetEnableOtherGroup){options.facetEnableOtherGroup="off"}if(!options.categColorEnableOtherGroup){options.categColorEnableOtherGroup="off"}if(options.marker==="table"&&!options.disableDecimalFormatting){options.disableDecimalFormatting=true}if(options.marker==="table"&&!options.tableShowAllColumn){options.tableShowAllColumn="on"}if(options.marker==="heatmap"){options.yAxisDirection="reversed"}return viz};res.constructFilterConditions=function(cdatalist,vizOptions){var filterConditions=[];cdatalist.forEach(function(cdata){var filterc=[];var v;var histRange=cdata&&cdata.length>0?cdata[0].histRange:null;cdata.forEach(function(d){if(d.filter){if(d.histRange){filterc.push({name:d.validName||d.name,func:"between",columnFunc:d.func,includeEdge:d.includeEdge||"end",val1:d.rawValue-d.histRange,val2:d.rawValue+d.histRange,value:d.value})}else{v={name:d.validName||d.name,value:d.rawValue,func:d.func};if(d.numDecimalDigits&&d.func==="round"){try{v.value=parseFloat(d.value.toString().replace(/,/g,""));v.rawValue=d.rawValue}catch(e){}if(isNaN(v.value)){v.value=d.rawValue}v.digit=d.numDecimalDigits}var isColorBucketing=d.type==="color"&&vizOptions.colorbucket&&!VizUtil.applyColorBucketAfterSummarize(vizOptions.marker);if(d.func===Column.OperationType.AS_CATEGORY||isColorBucketing){var attrs={};res.addBucketInfo(vizOptions,d.type,attrs,[]);if(Object.keys(attrs).length>0){attrs.bucketType=res.getBucketType(d.type,vizOptions);v.attrs=attrs}}else{var opId=d.type==="color"?"categColor":d.type;if(res.isOtherGroupEnabled(opId,vizOptions)){var attrs={};res.addOtherGroupInfo(vizOptions,opId,attrs,[]);if(res.isManualSelectOtherGroupEnabled(opId,vizOptions)){var type=vizOptions[opId+"EnableOtherGroup"];attrs.otherGroupType=Column.OperationType.FCT_OTHER;attrs.otherGroupValuesHandling=type===res.OTHER_GROUP_OPTION_TYPE.FCT_OTHER_DROP_VALUES?"drop":"keep"}else{attrs.otherGroupType=Column.OperationType.FCT_LUMP}v.attrs=attrs}}if(d.type==="color"&&vizOptions.colorRecode){if(!v.attrs){v.attrs={}}v.attrs.recode=vizOptions.colorRecode}filterc.push(v)}}});filterConditions.push(filterc)})
;if(filterConditions.length===1&&Array.isArray(filterConditions[0])&&filterConditions[0].length===1){filterConditions=filterConditions[0]}return filterConditions};res._messages={en:{Exclude:"Exclude","Keep Only":"Keep Only","Show Detail":"Show Detail","items selected":"items selected"},ja:{Exclude:"除く","Keep Only":"残す","Show Detail":"詳細","items selected":"個選択されています"}};res.getMessage=function(lang,key){return res._messages[lang||"en"][key]};res.compareVersionStr=function(v1,v2,options){var lexicographical=options&&options.lexicographical,zeroExtend=options&&options.zeroExtend,v1parts=v1.split("."),v2parts=v2.split(".");function isValidPart(x){return(lexicographical?/^\d+[A-Za-z]*$/:/^\d+$/).test(x)}if(!v1parts.every(isValidPart)||!v2parts.every(isValidPart)){return NaN}if(zeroExtend){while(v1parts.length<v2parts.length)v1parts.push("0");while(v2parts.length<v1parts.length)v2parts.push("0")}if(!lexicographical){v1parts=v1parts.map(Number);v2parts=v2parts.map(Number)}for(var i=0;i<v1parts.length;++i){if(v2parts.length===i){return 1}if(v1parts[i]===v2parts[i]){continue}else if(v1parts[i]>v2parts[i]){return 1}else{return-1}}if(v1parts.length!=v2parts.length){return-1}return 0};var ElemMock=function(elemName){this.name=elemName;this.textContent="";this.innerHTML="";this.style={};this.classes={};this.children=[];this.attrs={};var self=this;this.classList={add:function(){for(var i=0;i<arguments.length;i++){self.classes[arguments[i]]=true}},remove:function(className){for(var i=0;i<arguments.length;i++){self.classes[arguments[i]]=null}}};this.appendChild=function(child){self.children.push(child)};this.setAttribute=function(name,value){this.attrs[name]=value};this.getAttribute=function(name){return this.attrs[name]};this.onclick=function(){};this.serialize=function(){return JSON.parse(JSON.stringify(this))}};var JQueryMock=function(){var res={balloon:function(){},click:function(){},css:function(){}};return res};JQueryMock.balloon={defaults:{}};JQueryMock.isMock=true;var DocumentMock={createElement:function(name){return new ElemMock(name)},isMock:true};res.getDocumentMock=function(){return DocumentMock};res.getJQueryMock=function(){return JQueryMock};res.colorbrewer={schemeGroups:{sequential:["BuGn","BuPu","GnBu","OrRd","PuBu","PuBuGn","PuRd","RdPu","YlGn","YlGnBu","YlOrBr","YlOrRd"],singlehue:["Blues","Greens","Greys","Oranges","Purples","Reds"],diverging:["BrBG","PiYG","PRGn","PuOr","RdBu","RdGy","RdYlBu","RdYlGn","Spectral"],qualitative:["Accent","Dark2","Paired","Pastel1","Pastel2","Set1","Set2","Set3"]},YlGn:{1:["#f7fcb9"],2:["#f7fcb9","#31a354"],3:["#f7fcb9","#addd8e","#31a354"],4:["#ffffcc","#c2e699","#78c679","#238443"],5:["#ffffcc","#c2e699","#78c679","#31a354","#006837"],6:["#ffffcc","#d9f0a3","#addd8e","#78c679","#31a354","#006837"],7:["#ffffcc","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#005a32"],8:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#005a32"],9:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#006837","#004529"],10:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#006837","#005a32","#004529"]},YlGnBu:{1:["#edf8b1"],2:["#edf8b1","#2c7fb8"],3:["#edf8b1","#7fcdbb","#2c7fb8"],4:["#ffffcc","#a1dab4","#41b6c4","#225ea8"],5:["#ffffcc","#a1dab4","#41b6c4","#2c7fb8","#253494"],6:["#ffffcc","#c7e9b4","#7fcdbb","#41b6c4","#2c7fb8","#253494"],7:["#ffffcc","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#0c2c84"],8:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#0c2c84"],9:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#081d58"],10:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#0c2c84","#081d58"]},GnBu:{1:["#e0f3db"],2:["#e0f3db","#43a2ca"],3:["#e0f3db","#a8ddb5","#43a2ca"],4:["#f0f9e8","#bae4bc","#7bccc4","#2b8cbe"],5:["#f0f9e8","#bae4bc","#7bccc4","#43a2ca","#0868ac"],6:["#f0f9e8","#ccebc5","#a8ddb5","#7bccc4","#43a2ca","#0868ac"],7:["#f0f9e8","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#08589e"],8:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#08589e"],9:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#0868ac","#084081"],10:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#0868ac","#08589e","#084081"]},BuGn:{1:["#e5f5f9"],2:["#e5f5f9","#2ca25f"],3:["#e5f5f9","#99d8c9","#2ca25f"],4:["#edf8fb","#b2e2e2","#66c2a4","#238b45"],5:["#edf8fb","#b2e2e2","#66c2a4","#2ca25f","#006d2c"],6:["#edf8fb","#ccece6","#99d8c9","#66c2a4","#2ca25f","#006d2c"],7:["#edf8fb","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#005824"],8:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#005824"],9:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#006d2c","#00441b"],10:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#006d2c","#005824","#00441b"]},PuBuGn:{1:["#ece2f0"],2:["#ece2f0","#1c9099"],3:["#ece2f0","#a6bddb","#1c9099"],4:["#f6eff7","#bdc9e1","#67a9cf","#02818a"],5:["#f6eff7","#bdc9e1","#67a9cf","#1c9099","#016c59"],6:["#f6eff7","#d0d1e6","#a6bddb","#67a9cf","#1c9099","#016c59"],7:["#f6eff7","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016450"],8:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016450"],9:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016c59","#014636"],10:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016c59","#016450","#014636"]},PuBu:{1:["#ece7f2"],2:["#ece7f2","#2b8cbe"],3:["#ece7f2","#a6bddb","#2b8cbe"],4:["#f1eef6","#bdc9e1","#74a9cf","#0570b0"],5:["#f1eef6","#bdc9e1","#74a9cf","#2b8cbe","#045a8d"],6:["#f1eef6","#d0d1e6","#a6bddb","#74a9cf","#2b8cbe","#045a8d"],7:["#f1eef6","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#034e7b"],8:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#034e7b"],9:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#045a8d","#023858"],10:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#045a8d","#034e7b","#023858"]},BuPu:{1:["#e0ecf4"],2:["#e0ecf4","#8856a7"],3:["#e0ecf4","#9ebcda","#8856a7"],4:["#edf8fb","#b3cde3","#8c96c6","#88419d"],5:["#edf8fb","#b3cde3","#8c96c6","#8856a7","#810f7c"],6:["#edf8fb","#bfd3e6","#9ebcda","#8c96c6","#8856a7","#810f7c"],7:["#edf8fb","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#6e016b"],8:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#6e016b"],9:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#810f7c","#4d004b"],10:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#810f7c","#6e016b","#4d004b"]},RdPu:{1:["#fde0dd"],2:["#fde0dd","#c51b8a"],3:["#fde0dd","#fa9fb5","#c51b8a"],4:["#feebe2","#fbb4b9","#f768a1","#ae017e"],5:["#feebe2","#fbb4b9","#f768a1","#c51b8a","#7a0177"],6:["#feebe2","#fcc5c0","#fa9fb5","#f768a1","#c51b8a","#7a0177"],7:["#feebe2","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177"],8:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177"],9:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177","#49006a"],10:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#c51b8a","#ae017e","#7a0177","#49006a"]},PuRd:{1:["#e7e1ef"],2:["#e7e1ef","#dd1c77"],3:["#e7e1ef","#c994c7","#dd1c77"],4:["#f1eef6","#d7b5d8","#df65b0","#ce1256"],5:["#f1eef6","#d7b5d8","#df65b0","#dd1c77","#980043"],6:["#f1eef6","#d4b9da","#c994c7","#df65b0","#dd1c77","#980043"],7:["#f1eef6","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#91003f"],8:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#91003f"],9:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#980043","#67001f"],10:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#980043","#91003f","#67001f"]},OrRd:{1:["#fee8c8"],2:["#fee8c8","#e34a33"],3:["#fee8c8","#fdbb84","#e34a33"],4:["#fef0d9","#fdcc8a","#fc8d59","#d7301f"],5:["#fef0d9","#fdcc8a","#fc8d59","#e34a33","#b30000"],6:["#fef0d9","#fdd49e","#fdbb84","#fc8d59","#e34a33","#b30000"],7:["#fef0d9","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#990000"],8:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#990000"],9:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#b30000","#7f0000"],10:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#b30000","#990000","#7f0000"]},YlOrRd:{1:["#ffeda0"],2:["#ffeda0","#f03b20"],3:["#ffeda0","#feb24c","#f03b20"],4:["#ffffb2","#fecc5c","#fd8d3c","#e31a1c"],5:["#ffffb2","#fecc5c","#fd8d3c","#f03b20","#bd0026"],6:["#ffffb2","#fed976","#feb24c","#fd8d3c","#f03b20","#bd0026"],7:["#ffffb2","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#b10026"],8:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#b10026"],9:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#bd0026","#800026"],10:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#bd0026","#b10026","#800026"]},YlOrBr:{1:["#fff7bc"],2:["#fff7bc","#d95f0e"],3:["#fff7bc","#fec44f","#d95f0e"],4:["#ffffd4","#fed98e","#fe9929","#cc4c02"],5:["#ffffd4","#fed98e","#fe9929","#d95f0e","#993404"],6:["#ffffd4","#fee391","#fec44f","#fe9929","#d95f0e","#993404"],7:["#ffffd4","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#8c2d04"],8:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#8c2d04"],9:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#993404","#662506"],10:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#993404","#8c2d04","#662506"]},Purples:{1:["#756bb1"],2:["#efedf5","#756bb1"],3:["#efedf5","#bcbddc","#756bb1"],4:["#f2f0f7","#cbc9e2","#9e9ac8","#6a51a3"],5:["#f2f0f7","#cbc9e2","#9e9ac8","#756bb1","#54278f"],6:["#f2f0f7","#dadaeb","#bcbddc","#9e9ac8","#756bb1","#54278f"],7:["#f2f0f7","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#4a1486"],8:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#4a1486"],9:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#54278f","#3f007d"],10:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#54278f","#4a1486","#3f007d"]},Blues:{1:["#3182bd"],2:["#deebf7","#3182bd"],3:["#deebf7","#9ecae1","#3182bd"],4:["#eff3ff","#bdd7e7","#6baed6","#2171b5"],5:["#eff3ff","#bdd7e7","#6baed6","#3182bd","#08519c"],6:["#eff3ff","#c6dbef","#9ecae1","#6baed6","#3182bd","#08519c"],7:["#eff3ff","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#084594"],8:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#084594"],9:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#08519c","#08306b"],10:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#08519c","#084594","#08306b"]},Greens:{1:["#31a354"],2:["#e5f5e0","#31a354"],3:["#e5f5e0","#a1d99b","#31a354"],4:["#edf8e9","#bae4b3","#74c476","#238b45"],5:["#edf8e9","#bae4b3","#74c476","#31a354","#006d2c"],6:["#edf8e9","#c7e9c0","#a1d99b","#74c476","#31a354","#006d2c"],7:["#edf8e9","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#005a32"],8:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#005a32"],9:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#006d2c","#00441b"],10:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#006d2c","#005a32","#00441b"]},Oranges:{1:["#e6550d"],2:["#fee6ce","#e6550d"],3:["#fee6ce","#fdae6b","#e6550d"],4:["#feedde","#fdbe85","#fd8d3c","#d94701"],5:["#feedde","#fdbe85","#fd8d3c","#e6550d","#a63603"],6:["#feedde","#fdd0a2","#fdae6b","#fd8d3c","#e6550d","#a63603"],7:["#feedde","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#8c2d04"],8:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#8c2d04"],9:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#a63603","#7f2704"],10:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#a63603","#8c2d04","#7f2704"]},Reds:{1:["#de2d26"],2:["#fee0d2","#de2d26"],3:["#fee0d2","#fc9272","#de2d26"],4:["#fee5d9","#fcae91","#fb6a4a","#cb181d"],5:["#fee5d9","#fcae91","#fb6a4a","#de2d26","#a50f15"],6:["#fee5d9","#fcbba1","#fc9272","#fb6a4a","#de2d26","#a50f15"],7:["#fee5d9","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#99000d"],8:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#99000d"],9:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#67000d"],10:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#99000d","#67000d"]},Greys:{1:["#636363"],2:["#f0f0f0","#636363"],3:["#f0f0f0","#bdbdbd","#636363"],4:["#f7f7f7","#cccccc","#969696","#525252"],5:["#f7f7f7","#cccccc","#969696","#636363","#252525"],6:["#f7f7f7","#d9d9d9","#bdbdbd","#969696","#636363","#252525"],7:["#f7f7f7","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525"],8:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525"],9:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525","#000000"],10:["#ffffff","#f0f0f0","#d9d9d9","#cccccc","#bdbdbd","#969696","#737373","#525252","#252525","#000000"]},PuOr:{1:["#f1a340"],2:["#f1a340","#998ec3"],3:["#f1a340","#f7f7f7","#998ec3"],4:["#e66101","#fdb863","#b2abd2","#5e3c99"],5:["#e66101","#fdb863","#f7f7f7","#b2abd2","#5e3c99"],6:["#b35806","#f1a340","#fee0b6","#d8daeb","#998ec3","#542788"],7:["#b35806","#f1a340","#fee0b6","#f7f7f7","#d8daeb","#998ec3","#542788"],8:["#b35806","#e08214","#fdb863","#fee0b6","#d8daeb","#b2abd2","#8073ac","#542788"],9:["#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788"],10:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"],11:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"]},BrBG:{1:["#d8b365"],2:["#d8b365","#5ab4ac"],3:["#d8b365","#f5f5f5","#5ab4ac"],4:["#a6611a","#dfc27d","#80cdc1","#018571"],5:["#a6611a","#dfc27d","#f5f5f5","#80cdc1","#018571"],6:["#8c510a","#d8b365","#f6e8c3","#c7eae5","#5ab4ac","#01665e"],7:["#8c510a","#d8b365","#f6e8c3","#f5f5f5","#c7eae5","#5ab4ac","#01665e"],8:["#8c510a","#bf812d","#dfc27d","#f6e8c3","#c7eae5","#80cdc1","#35978f","#01665e"],9:["#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e"],10:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"],11:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"]},PRGn:{1:["#af8dc3"],2:["#af8dc3","#7fbf7b"],3:["#af8dc3","#f7f7f7","#7fbf7b"],4:["#7b3294","#c2a5cf","#a6dba0","#008837"],5:["#7b3294","#c2a5cf","#f7f7f7","#a6dba0","#008837"],6:["#762a83","#af8dc3","#e7d4e8","#d9f0d3","#7fbf7b","#1b7837"],7:["#762a83","#af8dc3","#e7d4e8","#f7f7f7","#d9f0d3","#7fbf7b","#1b7837"],8:["#762a83","#9970ab","#c2a5cf","#e7d4e8","#d9f0d3","#a6dba0","#5aae61","#1b7837"],9:["#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837"],10:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"],11:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"]},PiYG:{1:["#e9a3c9"],2:["#e9a3c9","#a1d76a"],3:["#e9a3c9","#f7f7f7","#a1d76a"],4:["#d01c8b","#f1b6da","#b8e186","#4dac26"],5:["#d01c8b","#f1b6da","#f7f7f7","#b8e186","#4dac26"],6:["#c51b7d","#e9a3c9","#fde0ef","#e6f5d0","#a1d76a","#4d9221"],7:["#c51b7d","#e9a3c9","#fde0ef","#f7f7f7","#e6f5d0","#a1d76a","#4d9221"],8:["#c51b7d","#de77ae","#f1b6da","#fde0ef","#e6f5d0","#b8e186","#7fbc41","#4d9221"],9:["#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221"],10:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"],11:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"]},RdBu:{1:["#ef8a62"],2:["#ef8a62","#67a9cf"],3:["#ef8a62","#f7f7f7","#67a9cf"],4:["#ca0020","#f4a582","#92c5de","#0571b0"],5:["#ca0020","#f4a582","#f7f7f7","#92c5de","#0571b0"],6:["#b2182b","#ef8a62","#fddbc7","#d1e5f0","#67a9cf","#2166ac"],7:["#b2182b","#ef8a62","#fddbc7","#f7f7f7","#d1e5f0","#67a9cf","#2166ac"],8:["#b2182b","#d6604d","#f4a582","#fddbc7","#d1e5f0","#92c5de","#4393c3","#2166ac"],9:["#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac"],10:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"],11:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"]},RdGy:{1:["#ef8a62"],2:["#ef8a62","#999999"],3:["#ef8a62","#ffffff","#999999"],4:["#ca0020","#f4a582","#bababa","#404040"],5:["#ca0020","#f4a582","#ffffff","#bababa","#404040"],6:["#b2182b","#ef8a62","#fddbc7","#e0e0e0","#999999","#4d4d4d"],7:["#b2182b","#ef8a62","#fddbc7","#ffffff","#e0e0e0","#999999","#4d4d4d"],8:["#b2182b","#d6604d","#f4a582","#fddbc7","#e0e0e0","#bababa","#878787","#4d4d4d"],9:["#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d"],10:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"],11:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"]},RdYlBu:{1:["#fc8d59"],2:["#fc8d59","#91bfdb"],3:["#fc8d59","#ffffbf","#91bfdb"],4:["#d7191c","#fdae61","#abd9e9","#2c7bb6"],5:["#d7191c","#fdae61","#ffffbf","#abd9e9","#2c7bb6"],6:["#d73027","#fc8d59","#fee090","#e0f3f8","#91bfdb","#4575b4"],7:["#d73027","#fc8d59","#fee090","#ffffbf","#e0f3f8","#91bfdb","#4575b4"],8:["#d73027","#f46d43","#fdae61","#fee090","#e0f3f8","#abd9e9","#74add1","#4575b4"],9:["#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4"],10:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"],11:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"]},Spectral:{1:["#fc8d59"],2:["#fc8d59","#99d594"],3:["#fc8d59","#ffffbf","#99d594"],4:["#d7191c","#fdae61","#abdda4","#2b83ba"],5:["#d7191c","#fdae61","#ffffbf","#abdda4","#2b83ba"],6:["#d53e4f","#fc8d59","#fee08b","#e6f598","#99d594","#3288bd"],7:["#d53e4f","#fc8d59","#fee08b","#ffffbf","#e6f598","#99d594","#3288bd"],8:["#d53e4f","#f46d43","#fdae61","#fee08b","#e6f598","#abdda4","#66c2a5","#3288bd"],9:["#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd"],10:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"],11:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"]},RdYlGn:{1:["#fc8d59"],2:["#fc8d59","#91cf60"],3:["#fc8d59","#ffffbf","#91cf60"],4:["#d7191c","#fdae61","#a6d96a","#1a9641"],5:["#d7191c","#fdae61","#ffffbf","#a6d96a","#1a9641"],6:["#d73027","#fc8d59","#fee08b","#d9ef8b","#91cf60","#1a9850"],7:["#d73027","#fc8d59","#fee08b","#ffffbf","#d9ef8b","#91cf60","#1a9850"],8:["#d73027","#f46d43","#fdae61","#fee08b","#d9ef8b","#a6d96a","#66bd63","#1a9850"],9:["#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850"],10:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"],11:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"]},Accent:{1:["#7fc97f"],2:["#7fc97f","#fdc086"],3:["#7fc97f","#beaed4","#fdc086"],4:["#7fc97f","#beaed4","#fdc086","#ffff99"],5:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0"],6:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f"],7:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17"],8:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17","#666666"]},Dark2:{1:["#1b9e77"],2:["#1b9e77","#7570b3"],3:["#1b9e77","#d95f02","#7570b3"],4:["#1b9e77","#d95f02","#7570b3","#e7298a"],5:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e"],6:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02"],7:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d"],8:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666"]},Paired:{1:["#a6cee3"],2:["#a6cee3","#b2df8a"],3:["#a6cee3","#1f78b4","#b2df8a"],4:["#a6cee3","#1f78b4","#b2df8a","#33a02c"],5:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99"],6:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c"],7:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f"],8:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00"],9:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6"],10:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a"],11:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99"],12:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928"]},Pastel1:{1:["#fbb4ae"],2:["#fbb4ae","#ccebc5"],3:["#fbb4ae","#b3cde3","#ccebc5"],4:["#fbb4ae","#b3cde3","#ccebc5","#decbe4"],5:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6"],6:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc"],7:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd"],8:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec"],9:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec","#f2f2f2"]},Pastel2:{1:["#b3e2cd"],2:["#b3e2cd","#cbd5e8"],3:["#b3e2cd","#fdcdac","#cbd5e8"],4:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4"],5:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9"],6:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae"],7:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc"],8:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc","#cccccc"]},Set1:{1:["#e41a1c"],2:["#e41a1c","#4daf4a"],3:["#e41a1c","#377eb8","#4daf4a"],4:["#e41a1c","#377eb8","#4daf4a","#984ea3"],5:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00"],6:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33"],7:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628"],8:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf"],9:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999"]},Set2:{1:["#66c2a5"],2:["#66c2a5","#8da0cb"],3:["#66c2a5","#fc8d62","#8da0cb"],4:["#66c2a5","#fc8d62","#8da0cb","#e78ac3"],5:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854"],6:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f"],7:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494"],8:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494","#b3b3b3"]},Set3:{1:["#8dd3c7"],2:["#8dd3c7","#bebada"],3:["#8dd3c7","#ffffb3","#bebada"],4:["#8dd3c7","#ffffb3","#bebada","#fb8072"],5:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3"],6:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462"],7:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69"],8:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5"],9:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9"],10:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd"],11:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5"],12:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5","#ffed6f"]},Viridis:{1:["#FDE725"],2:["#FDE725","#440154"],3:["#FDE725","#21908C","#440154"],4:["#FDE725","#35B779","#31688E","#440154"],5:["#FDE725","#5DC863","#21908C","#3B528B","#440154"],6:["#FDE725","#7AD151","#22A884","#2A788E","#414487","#440154"],7:["#FDE725","#8FD744","#35B779","#21908C","#31688E","#443A83","#440154"],8:["#FDE725","#9FDA3A","#4AC16D","#1FA187","#277F8E","#365C8D","#46337E","#440154"],9:["#FDE725","#AADC32","#5DC863","#27AD81","#21908C","#2C728E","#3B528B","#472D7B","#440154"],10:["#FDE725","#B4DE2C","#6DCD59","#35B779","#1F9E89","#26828E","#31688E","#3E4A89","#482878","#440154"],11:["#FDE725","#BBDF27","#7AD151","#43BF71","#22A884","#21908C","#2A788E","#35608D","#414487","#482576","#440154"],12:["#FDE725","#C2DF23","#85D54A","#51C56A","#2BB07F","#1E9B8A","#25858E","#2D708E","#38598C","#433E85","#482173","#440154"]}};return res}();if(typeof module==="object"&&module.exports)module.exports=VizUtil;var PivotTableGenerator=function(){};var _sortIdx=0;var _SORT_NONE=0;var _SORT_DESC=1;var _SORT_ASC=2;var SCROLL_BAR_WIDTH=25;var SHOW_BALLOON_THRESHOLD=15;var _getNextSortDir=function(current){return(current+1)%3};var _sortDir=_SORT_NONE;PivotTableGenerator.getSortIndex=function(){return _sortIdx};PivotTableGenerator.setSortIndex=function(idx){_sortIdx=idx};PivotTableGenerator.getSortDirection=function(){return _sortDir};PivotTableGenerator.setSortDirection=function(dir){_sortDir=dir};var isNumberCol=function(col){if(!col){return false}return col.isNumeric||/(difftime|Period|duration|hms|interval)/i.test(col.type)};PivotTableGenerator.applyConditionalFormatting=function(cfs,coldef,val){if(!cfs){return null}var res=null,i=0,cf=null,cond;for(i=cfs.length-1;i>=0;i--){cf=cfs[i];cond=cf.value;switch(cf.operator){case"gt":cond=coldef.isNumeric?parseFloat(cond):coldef.isDate?new Date(cond):null;val=coldef.isNumeric?parseFloat(val):coldef.isDate?new Date(val):null;if(cond!==null&&cond<val){res=cf.color}break;case"gte":cond=coldef.isNumeric?parseFloat(cond):coldef.isDate?new Date(cond):null;val=coldef.isNumeric?parseFloat(val):coldef.isDate?new Date(val):null;if(cond!==null&&cond<=val){res=cf.color}break;case"lt":cond=coldef.isNumeric?parseFloat(cond):coldef.isDate?new Date(cond):null;val=coldef.isNumeric?parseFloat(val):coldef.isDate?new Date(val):null;if(cond!==null&&cond>val){res=cf.color}break;case"lte":cond=coldef.isNumeric?parseFloat(cond):coldef.isDate?new Date(cond):null;val=coldef.isNumeric?parseFloat(val):coldef.isDate?new Date(val):null;if(cond!==null&&cond>=val){res=cf.color}break;case"eq":if(cond===val.toString()){res=cf.color}break;case"ne":if(cond!==val.toString()){res=cf.color}break;case"in":if(cond&&typeof cond==="string"){cond=cond.split(",").map(function(c){return c.trim()})}if(Array.isArray(cond)&&cond.indexOf(val.toString())>-1){res=cf.color}break;case"ni":if(cond&&typeof cond==="string"){cond=cond.split(",").map(function(c){return c.trim()})}if(Array.isArray(cond)&&cond.indexOf(val.toString())===-1){res=cf.color}break;case"sw":if(val.toString().startsWith(cond)){res=cf.color}break;case"nsw":if(!val.toString().startsWith(cond)){res=cf.color}break;case"ew":if(val.toString().endsWith(cond)){res=cf.color}break;case"new":if(!val.toString().endsWith(cond)){res=cf.color}break;case"contains":if(val.toString().indexOf(cond)>-1){res=cf.color}break;case"not-contains":if(val.toString().indexOf(cond)===-1){res=cf.color}break;case"between":if(cond&&typeof cond==="string"){cond=cond.split(",").map(function(c){return c.trim()})}if(Array.isArray(cond)&&cond.length>1){var start=coldef.isNumeric?parseFloat(cond[0]):coldef.isDate?new Date(cond[0]):null;var end=coldef.isNumeric?parseFloat(cond[1]):coldef.isDate?new Date(cond[1]):null;val=coldef.isNumeric?parseFloat(val):coldef.isDate?new Date(val):null;if(start!==null&&end!==null&&start<=val&&end>=val){res=cf.color}}break;case"not-between":if(cond&&typeof cond==="string"){cond=cond.split(",").map(function(c){return c.trim()})}if(Array.isArray(cond)&&cond.length>1){var start=coldef.isNumeric?parseFloat(cond[0]):coldef.isDate?new Date(cond[0]):null;var end=coldef.isNumeric?parseFloat(cond[1]):coldef.isDate?new Date(cond[1]):null;val=coldef.isNumeric?parseFloat(val):coldef.isDate?new Date(val):null;if(start!==null&&end!==null&&(start>val||end<val)){res=cf.color}}break}}return res};PivotTableGenerator.render=function(viz,data,elTarget,prevState,headerSyncDelay,onLoadCallback,onErrorCallback,onBeforeRenderingCallback,onPivotSortCallback,onTableColumnConfigClickCallback){try{PivotTableGenerator._render(viz,data,elTarget,prevState,headerSyncDelay,onBeforeRenderingCallback,onPivotSortCallback,onTableColumnConfigClickCallback)}catch(e){if(onErrorCallback&&typeof onErrorCallback==="function"){onErrorCallback(e,viz)}if(elTarget){VizUtil.renderNoData(elTarget,"Graph rendering failed.")}console.error(e)}finally{if(onLoadCallback&&typeof onLoadCallback==="function"){onLoadCallback()}}};PivotTableGenerator._render=function(viz,data,elTarget,prevState,headerSyncDelay,onBeforeRenderingCallback,onPivotSortCallback,onTableColumnConfigClickCallback){while(elTarget&&elTarget.childNodes.length>0){elTarget.removeChild(elTarget.firstChild)}var isHeadless=!elTarget;var _document=typeof document==="undefined"?null:document,_$=typeof $==="undefined"?null:$;if(isHeadless){_document=VizUtil.getDocumentMock();_$=VizUtil.getJQueryMock();elTarget=_document.createElement("div")}if(viz.marker==="singlevalue"){PivotTableGenerator.renderSingleValue(viz,data,elTarget,isHeadless,onBeforeRenderingCallback);return}var _syncHeader=function(elTarget){var i,l;var headerCells=elTarget.querySelectorAll(".pivot-view .pivot-col-header-view .pivot-cell.header");var bodyCells=elTarget.querySelectorAll(".pivot-view .pivot-body-view .pivot-cell.header");for(i=0,l=bodyCells.length;i<l;i++){headerCells.item(i).style.minWidth=bodyCells.item(i).offsetWidth+"px";headerCells.item(i).style.maxWidth=bodyCells.item(i).offsetWidth+"px"}var colTitle=elTarget.querySelector(".pivot-col-title");if(colTitle){var rowHeaders=elTarget.querySelectorAll(".pivot-view .pivot-body-view .pivot-cell.header.row-header");if(rowHeaders.length>0){var p=0;for(i=0,l=rowHeaders.length;i<l;i++){if(bodyCells[i]){p+=bodyCells[i].clientWidth}}colTitle.style.paddingLeft=p+"px"}else{colTitle.style.paddingLeft="10px"}}};var _syncTitle=function(elTarget){var pivotTitle=elTarget.querySelector(".pivot-title");var pivotTable=elTarget.querySelector(".pivot-view .pivot-body-view .pivot-table-frame");var pivotTitleWidth=_$(pivotTitle).width();var pivotTableWidth=_$(pivotTable).width();if(pivotTitleWidth>pivotTableWidth){_$(pivotTitle).width(pivotTableWidth)}};var PIXEL_STEP=10;var LINE_HEIGHT=40;var PAGE_HEIGHT=800;var normalizeWheel=function(event){var sX=0,sY=0,pX=0,pY=0;if("detail"in event){sY=event.detail}if("wheelDelta"in event){sY=-event.wheelDelta/120}if("wheelDeltaY"in event){sY=-event.wheelDeltaY/120}if("wheelDeltaX"in event){sX=-event.wheelDeltaX/120}if("axis"in event&&event.axis===event.HORIZONTAL_AXIS){sX=sY;sY=0}pX=sX*PIXEL_STEP;pY=sY*PIXEL_STEP;if("deltaY"in event){pY=event.deltaY}if("deltaX"in event){pX=event.deltaX}if((pX||pY)&&event.deltaMode){if(event.deltaMode==1){pX*=LINE_HEIGHT;pY*=LINE_HEIGHT}else{pX*=PAGE_HEIGHT;pY*=PAGE_HEIGHT}}if(pX&&!sX){sX=pX<1?-1:1}if(pY&&!sY){sY=pY<1?-1:1}return{spinX:sX,spinY:sY,pixelX:pX,pixelY:pY}};var _scroll;var _onScrollHandler=function(ev){var left=ev.target.scrollLeft;_scroll.left=left;_scroll.headerElem.parentNode.scrollLeft=_scroll.left};var _onWheelHandler=function(ev){ev.preventDefault();var normEv=normalizeWheel(ev);if(Math.abs(normEv.pixelX)>Math.abs(normEv.pixelY)){if(_scroll.bodyElem.clientWidth>_scroll.bodyElem.parentNode.clientWidth){_scroll.left=Math.max(_scroll.left+normEv.pixelX,0);_scroll.left=Math.min(_scroll.left,_scroll.bodyElem.clientWidth-_scroll.bodyElem.parentNode.clientWidth);_scroll.headerElem.parentNode.scrollLeft=_scroll.left;_scroll.bodyElem.parentNode.scrollLeft=_scroll.left}}else{
if(_scroll.bodyElem.clientHeight>_scroll.bodyElem.parentNode.clientHeight){_scroll.top=Math.max(_scroll.top+normEv.pixelY,0);_scroll.top=Math.min(_scroll.top,_scroll.bodyElem.clientHeight-_scroll.bodyElem.parentNode.clientHeight-5);_scroll.bodyElem.parentNode.scrollTop=_scroll.top}}};var _initScrollHandler=function(elTarget,prevState){var tableElem=elTarget.querySelector(".pivot-view");var bodyElem=tableElem.querySelector(".pivot-table-body-frame");var headerElem=tableElem.querySelector(".pivot-table-col-header-frame");var scroll={left:0,top:0,tableElem:tableElem,headerElem:headerElem,bodyElem:bodyElem};_scroll=scroll;if(prevState){_scroll.left=prevState.left;_scroll.headerElem.parentNode.scrollLeft=_scroll.left;_scroll.bodyElem.parentNode.scrollLeft=_scroll.left}tableElem.addEventListener("wheel",_onWheelHandler);bodyElem.parentNode.addEventListener("scroll",_onScrollHandler)};_$(".pivot-balloon-style").css("display","none");if(!prevState){_sortIdx=0;_sortDir=_SORT_NONE;if(!VizUtil.isEmpty(viz.pivotClientSortIndex)&&!VizUtil.isEmpty(viz.pivotClientSortDirection)){_sortIdx=viz.pivotClientSortIndex;_sortDir=viz.pivotClientSortDirection}}var pdata=PivotTableGenerator.constructPivotData(viz,data,_sortIdx,_sortDir);if(!data||data.length===0||data[0].length===0){VizUtil.renderNoData(elTarget);return}var isPivot=viz.marker==="pivot";SHOW_BALLOON_THRESHOLD=isPivot?15:25;var textWrap=viz.pivotTextWrap||"none";var hideDataCells=viz.pivotHideDataCells==="on";var masterFontSize=viz.pivotMasterFontSize||null;var colh0FontSize=masterFontSize||viz.colh0FontSize;var meas0FontSize=masterFontSize||viz.meas0FontSize;var rowh0TotalFontSize=masterFontSize||viz.rowh0TotalFontSize;var colh0TotalFontSize=masterFontSize||viz.colh0TotalFontSize;var meas0TotalFontSize=masterFontSize||viz.meas0TotalFontSize;var colh0ShowFuncName=viz.colh0ShowFuncName!=="off";var measOps=VizUtil.getOptions(viz,"meas");measOps=measOps.filter(function(m){return!!m});var masterColAlign=null;var colAligns=[];if(!isPivot){data[1].forEach(function(col,idx){colAligns.push(isNumberCol(viz["tcol"+idx])?"num-col":"text-col")})}else if(measOps.length>1){measOps.forEach(function(col,idx){colAligns.push(VizUtil.returnsNumericValue(col)?"num-col":"text-col")})}else{masterColAlign=measOps[0]&&VizUtil.returnsNumericValue(measOps[0])?"num-col":"text-col"}var bgcolorScale,fgcolorScale;var reverseColorPaletteOrderOp=viz.reverseColorPaletteOrder||viz.reverseColorPalleteOrder||"off";if(isPivot&&!!viz.pivotColor&&viz.pivotColor!=="none"&&measOps.filter(function(m){return VizUtil.returnsNumericValue(m)}).length===0){var pname=viz.categColorPalette||"default";if(pname==="custom"&&!!viz.customCategColorPalette&&viz.customCategColorPalette.length>0){var colorarr=viz.customCategColorPalette.match(VizUtil.COLOR_PALETTE_REGEX).slice();for(var i=0;i<colorarr.length;i++){if(VizUtil.hexToRgb(colorarr[i])===null){colorarr[i]="#CCCCCC"}}if(reverseColorPaletteOrderOp==="on"){colorarr.reverse()}bgcolorScale=d3.scale.ordinal().range(colorarr);fgcolorScale=d3.scale.ordinal().range(["#ffffff"])}else{var colors=VizUtil.CATEG_COLOR_PALETTES_HASH[pname].color.slice();if(reverseColorPaletteOrderOp==="on"){colors.reverse()}bgcolorScale=d3.scale.ordinal().range(colors);fgcolorScale=d3.scale.ordinal().range(VizUtil.CATEG_COLOR_PALETTES_HASH[pname].textColor)}if(measOps[0].type=="logical"){bgcolorScale("TRUE");bgcolorScale("FALSE");fgcolorScale("TRUE");fgcolorScale("TRUE")}}var getColAlign=function(idx){return!!masterColAlign?masterColAlign:colAligns[idx]};_$.balloon.defaults.classname="pivot-balloon-style";_$.balloon.defaults.css=null;_$.balloon.defaults.minLifetime=0;_$.balloon.defaults.showDuration=0;_$.balloon.defaults.hideDuration=0;_$.balloon.defaults.tipSize=5;var colorPaletteOp=viz.quantColorPalette||viz.colorPallete||"Blues";if(!VizUtil.QUANT_COLOR_PALETTES_HASH[colorPaletteOp]){colorPaletteOp="Blues"}var reverseColorPaletteOrderOp=viz.reverseColorPaletteOrder||viz.reverseColorPalleteOrder||"off";var bgcolorPalette=VizUtil.QUANT_COLOR_PALETTES_HASH[colorPaletteOp].color.slice();var fgcolorPalette=VizUtil.QUANT_COLOR_PALETTES_HASH[colorPaletteOp].textColor.slice();if(reverseColorPaletteOrderOp==="on"){bgcolorPalette.reverse();fgcolorPalette.reverse()}bgcolorPalette.unshift("#ffffff");fgcolorPalette.unshift("#4d4d4d");var elMetainfo=_document.createElement("div");elMetainfo.classList.add("pivot-metainfo");if(viz.title&&viz.marker==="table"){elMetainfo.classList.add("with-title")}elTarget.appendChild(elMetainfo);var elTitle=_document.createElement("div");elTitle.classList.add("pivot-title");elTarget.appendChild(elTitle);var elColTitle=_document.createElement("div");elColTitle.classList.add("pivot-col-title");elColTitle.textContent="Column Title";elTarget.appendChild(elColTitle);var elPivotView=_document.createElement("div");elPivotView.classList.add("pivot-view");elPivotView.classList.add(isPivot?"type-pivot":"type-table");elTarget.appendChild(elPivotView);var elPivotColHeaderView=_document.createElement("div");elPivotColHeaderView.classList.add("pivot-col-header-view");var elPivotColHeader=_document.createElement("div");elPivotColHeader.classList.add("pivot-table-frame");elPivotColHeader.classList.add("pivot-table-col-header-frame");elPivotColHeaderView.appendChild(elPivotColHeader);var elPivotBodyView=_document.createElement("div");elPivotBodyView.classList.add("pivot-body-view");var elPivot=_document.createElement("div");elPivot.classList.add("pivot-table-frame");elPivot.classList.add("pivot-table-body-frame");elPivotBodyView.appendChild(elPivot);elPivotView.appendChild(elPivotBodyView);elPivotView.appendChild(elPivotColHeaderView);var infoMsgArr=[];var tFmtr=d3.format(",");if(pdata.data.length<pdata.originalRowSize){infoMsgArr.push(tFmtr(pdata.data.length)+" of "+tFmtr(pdata.originalRowSize)+" rows")}else{infoMsgArr.push(tFmtr(pdata.data.length)+" rows")}if(pdata.colh.length<pdata.originalColSize){infoMsgArr.push(tFmtr(pdata.colh.length)+" of "+tFmtr(pdata.originalColSize)+" columns")}else{infoMsgArr.push(tFmtr(pdata.colh.length)+" columns")}var isShowDetails=viz.dataCacheId&&viz.dataCacheId===".detail.table";if(!isPivot&&pdata.data.length>=pdata.originalRowSize&&pdata.colh.length>=pdata.originalColSize&&!isShowDetails){infoMsgArr=[]}if(infoMsgArr.length>0){elMetainfo.textContent="Showing "+infoMsgArr.join(", ")}else{if(!isPivot){elPivotView.style.marginTop="0px"}}var voffset=0;if(viz.title){elTitle.textContent=viz.title;if(viz.titleFontSize){elTitle.style.fontSize=viz.titleFontSize+"px"}elTitle.classList.remove("hidden");voffset+=45}else{elTitle.textContent="";elTitle.classList.add("hidden")}if(viz.colh0&&!hideDataCells){elColTitle.textContent=viz.colh0Title||viz.colh0.name;var colh0TitleFontSize=masterFontSize||viz.colh0TitleFontSize;if(colh0TitleFontSize){elColTitle.style.fontSize=colh0TitleFontSize+"px"}elColTitle.classList.remove("hidden");voffset+=20}else{elColTitle.textContent="";elColTitle.classList.add("hidden")}if(voffset>0){elPivotView.style.height=" calc( 100% - "+voffset+"px )"}var elRow,elCell,elCellText,elLink;var getMeasureStr=function(coldef){if(!coldef){return""}else if(coldef.title){return coldef.title}else{var s=!coldef.column?VizUtil.NUMROWS_COL_LABEL:coldef.column.type===VizUtil.TYPE_NUMROWS?VizUtil.NUMROWS_COL_LABEL:coldef.column.name;if(colh0ShowFuncName&&s!==VizUtil.NUMROWS_COL_LABEL&&coldef.column.type!==VizUtil.TYPE_CUSTOM){s+=" ("+(VizUtil.AGGREGATION_FUNCTION_OPTIONS_HASH[coldef.column.func]||coldef.column.func)+")"}return s}};var onColumnHeaderClickHandler=function(idx){if(_sortIdx===idx){_sortDir=_getNextSortDir(_sortDir)}else{_sortIdx=idx;_sortDir=_SORT_DESC}if(onPivotSortCallback){onPivotSortCallback(_sortIdx,_sortDir)}PivotTableGenerator.render(viz,data,elTarget,{top:_scroll.top,left:_scroll.left},null,null,null,null,onPivotSortCallback,onTableColumnConfigClickCallback)};var renderColHeader=function(targetElem,addRightPaddingForScollbar){elRow=_document.createElement("div");elRow.classList.add("pivot-row");targetElem.appendChild(elRow);pdata.rowhCols.forEach(function(c,cidx){elCell=_document.createElement("div");elCell.classList.add("pivot-cell","header","row-header");if(viz["rowh"+cidx+"HideCells"]){elCell.style.display="none"}if(colh0FontSize){elCell.style.fontSize=colh0FontSize+"px"}elCellText=_document.createElement("div");elCellText.classList.add("pivot-cell-text");elCell.appendChild(elCellText);elCellText.textContent=pdata.rowhColDefs[cidx].title||c;elRow.appendChild(elCell);if(elCell.textContent.length>SHOW_BALLOON_THRESHOLD){_$(elCell).balloon({contents:elCell.textContent})}});if(!hideDataCells){pdata.colh.forEach(function(c,idx){var sortEnabled=_sortDir!==_SORT_NONE&&idx===_sortIdx;elCell=_document.createElement("div");elCell.classList.add("pivot-cell","header","col-header");if(sortEnabled){elCell.classList.add("with-sort")}elCell.classList.add(getColAlign(idx));var w=viz.meas0CellWidth;if(w){elCell.style.maxWidth=w+"px";elCell.style.minWidth=w+"px";elCell.style.width=w+"px"}if(colh0FontSize){elCell.style.fontSize=colh0FontSize+"px"}elCellText=_document.createElement("div");elCell.appendChild(elCellText);elCellText.classList.add("pivot-cell-text");if(isPivot){elCellText.textContent=viz.colh0?VizUtil.isEmpty(c)?" ":pdata.colhColDefs&&pdata.colhColDefs.length>0&&pdata.colhColDefs[0].column&&pdata.colhColDefs[0].column.isDate&&c==="NA"?"(NA)":c:getMeasureStr(pdata.measColDefs[idx])}else{elCellText.textContent=VizUtil.isEmpty(c)?" ":c}if(sortEnabled){elCellText.innerHTML=elCellText.innerHTML+(_sortDir===_SORT_DESC?' <i class="fa fa-caret-down"></i>':' <i class="fa fa-caret-up"></i>')}if(onTableColumnConfigClickCallback&&!(viz["tcol"+idx]&&viz["tcol"+idx].hideEditIcon===true)){var elConfigIcon=_document.createElement("i");elConfigIcon.style.color="#999";elConfigIcon.style.paddingLeft="5px";elConfigIcon.style.cursor="pointer";elConfigIcon.style.transform="translateY(-1px)";elConfigIcon.classList.add("fal","fa-edit","column-header-config");elConfigIcon.onclick=onTableColumnConfigClickCallback.bind(null,viz["tcol"+idx]);elCellText.appendChild(elConfigIcon)}elRow.appendChild(elCell);if(elCell.textContent.length>SHOW_BALLOON_THRESHOLD){_$(elCell).balloon({contents:elCell.textContent})}if(!onTableColumnConfigClickCallback){_$(elCell).click(onColumnHeaderClickHandler.bind(this,idx))}else{elCell.style.cursor="unset"}});if(isPivot&&pdata.rowTotals&&pdata.rowTotals.length>0){var rowTotalIdx=pdata.colh.length;elCell=_document.createElement("div");elCell.classList.add("pivot-cell","header","col-header");elCell.classList.add(getColAlign());var w=viz.meas0CellWidth;if(w){elCell.style.maxWidth=w+"px";elCell.style.minWidth=w+"px";elCell.style.width=w+"px"}if(colh0FontSize){elCell.style.fontSize=colh0FontSize+"px"}elCellText=_document.createElement("div");elCell.appendChild(elCellText);elCellText.classList.add("pivot-cell-text");elCellText.textContent="Total";if(_sortDir!==_SORT_NONE&&rowTotalIdx===_sortIdx){elCellText.innerHTML=elCellText.innerHTML+(_sortDir===_SORT_DESC?' <i class="fa fa-caret-down"></i>':' <i class="fa fa-caret-up"></i>')}elRow.appendChild(elCell);if(elCell.textContent.length>SHOW_BALLOON_THRESHOLD){_$(elCell).balloon({contents:elCell.textContent})}_$(elCell).click(onColumnHeaderClickHandler.bind(this,rowTotalIdx))}}if(addRightPaddingForScollbar){elCell=_document.createElement("div");elCell.classList.add("pivot-cell","header","col-header");elCell.style.minWidth=SCROLL_BAR_WIDTH+"px";elCell.style.width=SCROLL_BAR_WIDTH+"px";elCell.style.padding="0px";elCell.style.border="0px";elRow.appendChild(elCell)}};renderColHeader(elPivot);renderColHeader(elPivotColHeader,true);var disableDecimalFormatting=!!viz.disableDecimalFormatting;var numDecimalDigits=viz.numDecimalDigits;var useThousandSeparator=viz.useThousandSeparator!=="off";var numFormatter=VizUtil.valueFormatterGenerator(disableDecimalFormatting?null:numDecimalDigits||2,useThousandSeparator,!numDecimalDigits);var customNumFormatter=null;var formatValue=function(v,prefix,suffix){if(!numFormatter&&!customNumFormatter){return v}if(v==="Inf"||v==="-Inf"){return v}else if(VizUtil.isEmpty(v)||v===""){return" "}var s=customNumFormatter?customNumFormatter(v):numFormatter(v);if(s.startsWith("-")){return"-"+prefix+s.replace(/^-/,"")+suffix}else{return prefix+s+suffix}};if(pdata.tcolColDefs){pdata.tcolColDefs.forEach(function(tcol,idx){if(tcol){if(tcol.column.numDecimalDigits||tcol.column.useThousandSeparator){tcol.column.customNumFormatter=VizUtil.valueFormatterGenerator(disableDecimalFormatting?null:tcol.column.numDecimalDigits||2,tcol.column.useThousandSeparator!=="off",!tcol.column.numDecimalDigits)}if(pdata.extents[idx]){if(tcol.column.formattingType==="bar"){tcol.column.posColor=tcol.column.positiveColor?chroma(tcol.column.positiveColor).alpha(parseFloat(tcol.column.opacity||"1")):"rgba(153, 228, 245, 0.6)";tcol.column.negColor=tcol.column.negativeColor?chroma(tcol.column.negativeColor).alpha(parseFloat(tcol.column.opacity||"1")):"rgba(247, 160, 153, 0.6)"}else if(tcol.column.formattingType==="color"){var cpl=VizUtil.QUANT_COLOR_PALETTES_HASH[tcol.column.colorPalette||"Blues"].color.slice();if(tcol.column.reverseColorPalette==="on"){cpl.reverse()}tcol.column.scale=chroma.scale(cpl).correctLightness().domain(pdata.extents[idx])}}}})}var canOmitLabel=function(rowhdata,ridx,rhcidx){var v=true;for(var i=0;i<=rhcidx;i++){v=v&&rowhdata[ridx-1][i]===rowhdata[ridx][i]}return v};pdata.data.forEach(function(row,ridx){elRow=_document.createElement("div");elRow.classList.add("pivot-row");elPivot.appendChild(elRow);var rowclass="";if(pdata.rowh[ridx]){pdata.rowh[ridx].forEach(function(rhc,rhcidx){elCell=_document.createElement("div");elCell.classList.add("pivot-cell","row-header");if(viz["rowh"+rhcidx+"HideCells"]){elCell.style.display="none"}switch(textWrap){case"auto":elCell.classList.add("wrap-responsive-width");break;case"fixed":elCell.classList.add("wrap");break;default:break}var w=pdata.rowhColDefs[rhcidx].cellWidth;if(w&&textWrap!=="auto"){elCell.style.maxWidth=w+"px";elCell.style.minWidth=w+"px";elCell.style.width=w+"px"}var rowhFontSize=masterFontSize||pdata.rowhColDefs[rhcidx].fontSize;if(rowhFontSize){elCell.style.fontSize=rowhFontSize+"px"}if(rhcidx<pdata.numRowh-1){elCell.classList.add("grouped","thick")}if(pdata.numRowh===1){elCell.classList.add("thick")}if(ridx<pdata.rowh.length-1&&rhcidx<pdata.numRowh-1){if(pdata.rowh[ridx+1][rhcidx]!==rhc){rowclass="bottom-border"}}if(rowclass){elCell.classList.add(rowclass)}var elCellText;if(ridx>0&&rhcidx<pdata.numRowh-1&&canOmitLabel(pdata.rowh,ridx,rhcidx)){elCellText=_document.createElement("span");elCellText.textContent=" "}else{if(!VizUtil.isEmpty(rhc)&&rhc.length>0&&typeof rhc==="string"&&/^(http:\/\/|https:\/\/)/.test(rhc)){elCellText=_document.createElement("a");elCellText.setAttribute("href",rhc);elCellText.setAttribute("target","_blank");elCellText.textContent=rhc;elCellText.onclick=PivotTableGenerator.onLinkClick}else{elCellText=_document.createElement("span");elCellText.textContent=VizUtil.isEmpty(rhc)?" ":pdata.rowhColDefs[rhcidx].column.isDate&&rhc==="NA"?"(NA)":rhc}if(rhc&&rhc.length>10){elCellText.setAttribute("title",rhc)}}elCell.appendChild(elCellText);elRow.appendChild(elCell);if(elCell.textContent.length>SHOW_BALLOON_THRESHOLD){_$(elCell).balloon({contents:elCell.textContent})}})}if(!hideDataCells){row.forEach(function(c,cidx){var tcol=pdata.tcolColDefs&&cidx<pdata.tcolColDefs.length?pdata.tcolColDefs[cidx].column||{}:{};elCell=_document.createElement("div");elCell.classList.add("pivot-cell");if(rowclass){elCell.classList.add(rowclass)}elCell.classList.add(getColAlign(cidx));var w=viz.meas0CellWidth;if(w){elCell.style.maxWidth=w+"px";elCell.style.minWidth=w+"px";elCell.style.width=w+"px"}if(meas0FontSize){elCell.style.fontSize=meas0FontSize+"px"}if(c.length>1&&c[1]){elCell.style.backgroundColor=bgcolorPalette[c[1]];elCell.style.color=fgcolorPalette[c[1]]}if(bgcolorScale&&fgcolorScale&&!!c[0]){elCell.style.backgroundColor=bgcolorScale(c[0]);elCell.style.color=fgcolorScale(c[0])}if(!isPivot&&!VizUtil.isEmpty(c)&&c.length>0&&typeof c[0]==="string"&&/^(http:\/\/|https:\/\/)/.test(c[0])){elCellText=_document.createElement("a");elCellText.setAttribute("href",c[0]);elCellText.setAttribute("target","_blank");elCellText.textContent=c[0];elCellText.onclick=PivotTableGenerator.onLinkClick}else{elCellText=_document.createElement("span");var prefix="",suffix="";if(measOps.length>1){if(viz["meas"+cidx]){prefix=VizUtil.getValuePrefix(viz["meas"+cidx+"NumberFormatting"],viz["meas"+cidx+"CurrencySymbol"],viz.marker);suffix=VizUtil.getValueSuffix(viz["meas"+cidx+"WindowFunc"],viz["meas"+cidx].func,viz["meas"+cidx+"NumberFormatting"],viz.marker)}}else if(viz.meas0){prefix=VizUtil.getValuePrefix(viz.meas0NumberFormatting,viz.meas0CurrencySymbol,viz.marker);suffix=VizUtil.getValueSuffix(viz.meas0WindowFunc,viz.meas0.func,viz.meas0NumberFormatting,viz.marker)}else if(!isPivot){prefix=VizUtil.getValuePrefix(tcol.numberFormatting,tcol.currencySymbol,viz.marker);suffix=VizUtil.getValueSuffix(null,tcol.func,tcol.numberFormatting,viz.marker);customNumFormatter=tcol.customNumFormatter;if(VizUtil.isEmpty(c)||c.length===0){}else{var _color;if(tcol.formattingType==="cf"){_color=PivotTableGenerator.applyConditionalFormatting(tcol.conditionalFormattings,tcol,c[0])}else if(tcol.formattingType==="color"&&tcol.scale){_color=tcol.scale(c[0])}if(_color){elCell.style[tcol.formattingTarget==="bgcolor"?"backgroundColor":"color"]=_color;if(tcol.formattingTarget==="bgcolor"&&chroma.contrast(_color,"#ffffff")>chroma.contrast(_color,"#4d4d4d")){elCell.style.color="#ffffff"}}}}if(VizUtil.isEmpty(c)||c.length===0){elCellText.textContent=" "}else{elCellText.textContent=getColAlign(cidx)==="num-col"?formatValue(c[0],prefix,suffix):c[0];var url=PivotTableGenerator.bindUrlData(viz[isPivot?measOps.length>1?"meas"+cidx+"UrlTemplate":"meas0UrlTemplate":"tcol"+cidx+"UrlTemplate"],ridx,cidx,pdata.rowh,pdata.rowhCols,row,pdata.colh,pdata.colhCols,c[0],pdata.measCols,pdata.extraData,pdata.extraCols,isPivot);if(url){elLink=_document.createElement("a");elLink.setAttribute("href",url);elLink.setAttribute("target","_blank");elLink.onclick=PivotTableGenerator.onLinkClick;if(elCellText.textContent===" "){elLink.classList.add("no-text-deco")}elLink.appendChild(elCellText);elCellText=elLink}}}if(pdata.barExtents&&pdata.barExtents[cidx]&&pdata.data.length>1&&tcol&&(tcol.formattingType==="bar"||viz.tableFormattingType==="bar"&&!tcol.formattingType||viz.tableShowBarsOnSort==="on"&&_sortDir!==_SORT_NONE&&_sortIdx===cidx)){elCellText.style.position="relative";var extent=pdata.barExtents[cidx];var scaleFunc=d3.scale.linear().domain(extent).range([10,90]);var zeroPoint=scaleFunc(0);var dataPoint=scaleFunc(c[0]);var left=c[0]<0?dataPoint+"%":zeroPoint+"%";var width=Math.abs(zeroPoint-dataPoint)+"%";var posColor=tcol.posColor||viz.tableBarPositiveColor||"rgba(153, 228, 245, 0.6)";var negColor=tcol.negColor||viz.tableBarNegativeColor||"rgba(247, 160, 153, 0.6)";var color=c[0]<0?negColor:posColor;elCell.style.position="relative";var elCellBg=_document.createElement("div");elCellBg.style.position="absolute";elCellBg.style.width=width;elCellBg.style.height="80%";elCellBg.style.top="10%";elCellBg.style.left=left;elCellBg.style.backgroundColor=color;elCellBg.style.padding="0";elCell.appendChild(elCellBg)}elCell.appendChild(elCellText);elRow.appendChild(elCell);if(isPivot){if(elCell.textContent!==" "){var htmlarr=[];htmlarr.push('<div class="pivot-table-frame pivot-data-popover">');pdata.rowhCols.forEach(function(_row,_ridx){htmlarr.push('<div class="pivot-row">');htmlarr.push('<div class="pivot-cell">');htmlarr.push(_row);htmlarr.push(":  </div>");htmlarr.push('<div class="pivot-cell value-cell">');htmlarr.push(pdata.rowh[ridx][_ridx]);htmlarr.push("</div>");htmlarr.push("</div>")});pdata.colhCols.forEach(function(_col){htmlarr.push('<div class="pivot-row">');htmlarr.push('<div class="pivot-cell">');htmlarr.push(_col);htmlarr.push(":  </div>");htmlarr.push('<div class="pivot-cell value-cell">');htmlarr.push(pdata.colh[cidx]);htmlarr.push("</div>");htmlarr.push("</div>")});htmlarr.push('<div class="pivot-row">');htmlarr.push('<div class="pivot-cell">');htmlarr.push(pdata.numMeas===0?"(count)":pdata.measCols[pdata.colhCols.length===0?cidx:0]);htmlarr.push(":  </div>");htmlarr.push('<div class="pivot-cell value-cell">');htmlarr.push(elCell.textContent);htmlarr.push("</div>");htmlarr.push("</div>");htmlarr.push("</div>");_$(elCell).balloon({contents:htmlarr.join(""),html:true})}}else{if(elCell.textContent.length>SHOW_BALLOON_THRESHOLD){if(elCellText.nodeName==="A"&&typeof module!=="object"){elCellText.setAttribute("title",elCellText.getAttribute("href"))}else{var htmlarr=[];htmlarr.push('<div class="pivot-table-frame pivot-data-popover" style="max-width:600px">');htmlarr.push(elCell.textContent);htmlarr.push("</div>");_$(elCell).balloon({contents:htmlarr.join(""),html:true})}}}});if(isPivot&&pdata.rowTotals){elCell=_document.createElement("div");elCell.classList.add("pivot-cell","row-total");elCell.classList.add(getColAlign());if(rowclass){elCell.classList.add(rowclass)}var w=viz.meas0CellWidth;if(w){elCell.style.maxWidth=w+"px";elCell.style.minWidth=w+"px";elCell.style.width=w+"px"}if(meas0FontSize){elCell.style.fontSize=meas0FontSize+"px"}elCellText=_document.createElement("span");var prefix="",suffix="";if(viz.meas0){prefix=VizUtil.getValuePrefix(viz.meas0NumberFormatting,viz.meas0CurrencySymbol,viz.marker);suffix=VizUtil.getValueSuffix(viz.meas0WindowFunc,viz.meas0.func,viz.meas0NumberFormatting,viz.marker)}var c=pdata.rowTotals[ridx];elCellText.textContent=VizUtil.isEmpty(c)||c.length===0||c[0]==="NA"?" ":formatValue(c[0],prefix,suffix);elCell.appendChild(elCellText);elRow.appendChild(elCell)}}});if(viz.pivotShowTotals==="on"&&pdata.colTotals&&pdata.data.length>0&&!hideDataCells&&isPivot){var i,v;if(pdata.data.length<pdata.originalRowSize){elRow=_document.createElement("div");elRow.classList.add("pivot-row");elPivot.appendChild(elRow);for(i=0;i<pdata.numRowh;i++){elCell=_document.createElement("div");elCell.classList.add("pivot-cell");elRow.appendChild(elCell)}if(pdata.numMeas>1){for(i=0;i<pdata.numMeas;i++){elCell=_document.createElement("div");elCell.classList.add("pivot-cell");elCell.classList.add(getColAlign(i));elCell.textContent="⋮";elRow.appendChild(elCell)}}else{for(i=0;i<pdata.colh.length;i++){elCell=_document.createElement("div");elCell.classList.add("pivot-cell");elCell.classList.add(getColAlign(i));elCell.textContent="⋮";elRow.appendChild(elCell)}}}elRow=_document.createElement("div");elRow.classList.add("pivot-row");elPivot.appendChild(elRow);var totals=pdata.colTotals.slice();for(i=0;i<pdata.numRowh;i++){elCell=_document.createElement("div");elCell.classList.add("pivot-cell","total","text-col");if(rowh0TotalFontSize){elCell.style.fontSize=rowh0TotalFontSize+"px"}if(viz["rowh"+i+"HideCells"]){elCell.style.display="none"}elCell.textContent=i===0?"Total":"";elRow.appendChild(elCell)}totals.forEach(function(total,totalidx){if(pdata.numMeas>1){v=total;for(i=0;i<pdata.numMeas;i++){var prefix="",suffix="";if(viz["meas"+i]){prefix=VizUtil.getValuePrefix(viz["meas"+i+"NumberFormatting"],viz["meas"+i+"CurrencySymbol"],viz.marker);suffix=VizUtil.getValueSuffix(viz["meas"+i+"WindowFunc"],viz["meas"+i].func,viz["meas"+i+"NumberFormatting"],viz.marker)}elCell=_document.createElement("div");elCell.classList.add("pivot-cell","total");elCell.classList.add(getColAlign(i));if(meas0TotalFontSize){elCell.style.fontSize=meas0TotalFontSize+"px"}if(pdata.numMeas===v.length){elCell.textContent=formatValue(v.length>=i?v[i]:"",prefix,suffix)}else{elCell.textContent=formatValue(v.length>=i*2?v[i*2]:"",prefix,suffix)}elRow.appendChild(elCell)}}else{if(totalidx<pdata.colh.length){var prefix="",suffix="";if(viz.meas0){prefix=VizUtil.getValuePrefix(viz.meas0NumberFormatting,viz.meas0CurrencySymbol,viz.marker);suffix=VizUtil.getValueSuffix(viz.meas0WindowFunc,viz.meas0.func,viz.meas0NumberFormatting,viz.marker)}v=total.shift();elCell=_document.createElement("div");elCell.classList.add("pivot-cell","total");elCell.classList.add(getColAlign(totalidx));if(meas0TotalFontSize){elCell.style.fontSize=meas0TotalFontSize+"px"}elCell.textContent=formatValue(v,prefix,suffix);elRow.appendChild(elCell)}}});if(isPivot&&pdata.grandTotal){elCell=_document.createElement("div");elCell.classList.add("pivot-cell","total");elCell.classList.add(getColAlign());var w=viz.meas0CellWidth;if(w){elCell.style.maxWidth=w+"px";elCell.style.minWidth=w+"px";elCell.style.width=w+"px"}if(meas0FontSize){elCell.style.fontSize=meas0FontSize+"px"}elCellText=_document.createElement("span");var prefix="",suffix="";if(viz.meas0){prefix=VizUtil.getValuePrefix(viz.meas0NumberFormatting,viz.meas0CurrencySymbol,viz.marker);suffix=VizUtil.getValueSuffix(viz.meas0WindowFunc,viz.meas0.func,viz.meas0NumberFormatting,viz.marker)}var c=pdata.grandTotal;elCellText.textContent=VizUtil.isEmpty(c)||c.length===0||c[0]==="NA"?" ":formatValue(c[0],prefix,suffix);elCell.appendChild(elCellText);elRow.appendChild(elCell)}}if(!!onBeforeRenderingCallback&&typeof onBeforeRenderingCallback==="function"){onBeforeRenderingCallback({marker:viz.marker,data:pdata,dom:elTarget.serialize()})}if(isHeadless){return}if(headerSyncDelay){setTimeout(function(){_syncHeader(elTarget);_syncTitle(elTarget);_initScrollHandler(elTarget,prevState)},headerSyncDelay)}else{_syncHeader(elTarget);_syncTitle(elTarget);_initScrollHandler(elTarget,prevState)}};PivotTableGenerator.renderSingleValue=function(viz,data,elTarget,isHeadless,onBeforeRenderingCallback){var numDecimalDigits=viz.numDecimalDigits;var useThousandSeparator=viz.useThousandSeparator!=="off";var numFormat=viz.svNumberFormatting||"number";var showInPercentage=numFormat==="percentage";var prefix="",suffix="";if(VizUtil.returnsNumericValue(viz.meas0)){prefix=VizUtil.getValuePrefix(viz.svNumberFormatting,viz.svCurrencySymbol,viz.marker);suffix=VizUtil.getValueSuffix(null,viz.meas0.func,viz.svNumberFormatting,viz.marker)}var formatValue=VizUtil.valueFormatterGenerator(viz.disableDecimalFormatting==="on"?null:numDecimalDigits||2,useThousandSeparator,!numDecimalDigits);var value=viz.dataDefaultValue||VizUtil.getDefaultSingleValueValue(viz.meas0);var noValueFound=true;var pdata=null,v=null;if(data&&data.length>0){pdata=PivotTableGenerator.constructPivotData(viz,data);if(pdata.data.length>0&&pdata.data[0].length>0&&pdata.data[0][0].length>0){v=pdata.data[0][0][0];if(!isNaN(v)){v=parseFloat(v)}value=prefix+formatValue(v)+suffix;noValueFound=false}}var defaultFgColor="#4d4d4d";var defaultCaptionFgColor="#4d4d4d";if(noValueFound){defaultFgColor="#999999"}var iconClass=viz.singlevalueIconClass||"";var fgColor=viz.singlevalueColor||defaultFgColor;var captionFgColor=viz.singlevalueColor||defaultCaptionFgColor;var bgColor=viz.singlevalueBgColor||"#ffffff";var border=viz.singlevalueBorder||"1px solid #d7d7d7";var padding=viz.singlevaluePadding||"0px 9px 0px 0px";var innerPadding=viz.singlevalueInnerPadding||"22px";var caption=viz.displayName||viz.title||(viz.meas0.type===VizUtil.TYPE_NUMROWS?VizUtil.NUMROWS_COL_LABEL:viz.meas0.name);if(!!onBeforeRenderingCallback&&typeof onBeforeRenderingCallback==="function"){onBeforeRenderingCallback({marker:viz.marker,data:pdata,value:value,iconClass:iconClass,fgColor:fgColor,captionFgColor:captionFgColor,bgColor:bgColor,border:border,padding:padding,innerPadding:innerPadding,caption:caption})}if(isHeadless){return}var $elBox=$(document.createElement("div"));$elBox.css({padding:padding}).attr("data-viz-type","singlevalue").addClass("single-value-box");var $elBoxInner=$(document.createElement("div"));$elBoxInner.css({padding:innerPadding,"background-color":bgColor,color:fgColor,border:border}).addClass("single-value-innerbox");var $elValue=$(document.createElement("div"));$elValue.text(value).addClass("single-value-text");if(noValueFound){$elValue.text(value).addClass("no-value")}var $elCaption=$(document.createElement("div"));$elCaption.text(caption).addClass("single-value-caption").css("color",captionFgColor);var $elIconDiv=$(document.createElement("div"));if(iconClass){var $elIcon=$(document.createElement("i"));$elIcon.addClass("fal "+iconClass+" single-value-icon").appendTo($elIconDiv)}$elBox.append($elBoxInner.append($elValue).append($elCaption));$elBox.append($elIconDiv);$elBox.appendTo(elTarget)};PivotTableGenerator.onLinkClick=function(event){if(typeof module==="object"&&module.exports){if(event){event.preventDefault();event.stopPropagation()}global._guiShell.openExternal(this.getAttribute("href"));return false}else{return true}};PivotTableGenerator.bindUrlData=function(urlTemplate,ridx,cidx,rowh,rowhCols,rowData,colh,colhCols,meas,measCols,extraData,extraCols,isPivot){if(!urlTemplate){return null}var ht={};if(isPivot){if(rowh&&rowhCols&&ridx<rowh.length){var v=rowh[ridx];rowhCols.forEach(function(rhc,rhcidx){ht[rhc]=v[rhcidx]})}if(measCols&&measCols.length>1){if(measCols&&measCols.length>0&&cidx<measCols.length){ht[measCols[cidx]]=meas}}else{if(colh&&colhCols&&colhCols.length>0&&cidx<colh.length){ht[colhCols[0]]=colh[cidx]}if(measCols&&measCols.length>0){ht[measCols[0]]=meas}}}else{if(colh&&rowData){colh.forEach(function(c,idx){if(idx<rowData.length){ht[c]=rowData[idx][0]}})}if(extraData&&extraData.length>ridx&&extraCols){var extraRowData=extraData[ridx];extraCols.forEach(function(c,idx){ht[c]=extraRowData[idx]})}}var res=urlTemplate.replace(/\$\{([^\}]+)\}/g,function(match,p1){return ht[p1]?encodeURIComponent(ht[p1]):""});return res};PivotTableGenerator.constructPivotData=function(viz,data,sortIdx,sortDir){var isPivot=viz.marker==="pivot";var _t=new Date;var rowh=[];var colh=data[1].slice();var cells=[];var extraCells=[];var extraColh=data.length>7?data[7].slice():null;var rowhCols=[];var rowhColDefs=[];var colhCols=[];var colhColDefs=[];var tcolColDefs=[];var measCols=[];var measColDefs=[];var rowhIdx=0,colhIdx=0,measIdx=0,c,i,l;var colTotals=isPivot&&data.length>4&&!(data[4].length===1&&data[4][0]===null)?data[4]:null;var rowTotals=isPivot&&data.length>5&&!(data[5].length===1&&data[5][0]===null)?data[5]:null;var grandTotal=null;var sortAcrossGroup=viz.pivotSortWithinGroup==="off";if(colTotals){colTotals=colTotals.map(function(d){return typeof d==="string"&&isPivot?d.split(","):[d]})}if(rowTotals){rowTotals=rowTotals.map(function(d){return typeof d==="string"&&isPivot?d.split(","):[d]});grandTotal=rowTotals.pop()}data[0].forEach(function(dataRow){cells.push(dataRow.slice())});if(data.length>6){data[6].forEach(function(dataRow){extraCells.push(dataRow.slice())})}for(i=0,l=VizUtil.MAX_NUMBER_OF_CONTROLS.rowh;i<l;i++){c=viz["rowh"+i];if(c){rowhCols.push(c.name);rowhColDefs.push({option:"rowh"+i,column:c,title:viz["rowh"+i+"Title"],cellWidth:viz["rowh"+i+"CellWidth"],fontSize:viz["rowh"+i+"FontSize"]});rowhIdx++}}var numRowh=rowhCols.length;colh.splice(0,numRowh);if(numRowh>0){var rh;cells.forEach(function(r){rh=r.splice(0,numRowh);rowh.push(rh)})}for(i=0,l=VizUtil.MAX_NUMBER_OF_CONTROLS.colh;i<l;i++){c=viz["colh"+i];if(c){colhCols.push(c.name);colhColDefs.push({option:"colh"+i,column:c,title:viz["colh"+i+"Title"]});colhIdx++}}for(i=0,l=VizUtil.MAX_NUMBER_OF_CONTROLS.tcol;i<l;i++){c=viz["tcol"+i];if(c){colhCols.push(c.name);tcolColDefs.push({option:"tcol"+i,column:c});colhIdx++}}for(i=0,l=VizUtil.MAX_NUMBER_OF_CONTROLS.meas;i<l;i++){c=viz["meas"+i];if(c){measCols.push(c.type===VizUtil.TYPE_NUMROWS?VizUtil.NUMROWS_COL_LABEL:c.name);measColDefs.push({option:"meas"+i,column:c,title:viz["meas"+i+"Title"]});measIdx++}}var numMeas=measCols.length;cells.forEach(function(dataRow){dataRow.forEach(function(d,didx){if(d===null||d===undefined){dataRow[didx]=[]}else{dataRow[didx]=typeof d==="string"&&isPivot?d.split(","):[d]}})});if(isPivot&&measIdx>1){colh=[];for(i=0;i<measIdx;i++){colh.push("measure"+i)}cells.forEach(function(dataRow){var measArr=dataRow.pop();if(measArr.length===measIdx){for(i=0,
l=measArr.length;i<l;i++){dataRow.push([measArr[i]])}}else{for(i=0,l=measArr.length;i<l;i+=2){dataRow.push([measArr[i],measArr[i+1]])}}})}var sortCol=null;if(isPivot){if(numMeas>1&&measColDefs.length>sortIdx){sortCol=measColDefs[sortIdx].column}else if(measColDefs.length>0){sortCol=measColDefs[0].column}}else if(tcolColDefs.length>sortIdx){sortCol=tcolColDefs[sortIdx].column}var sorted=PivotTableGenerator.sortPivotData(rowh,cells,rowTotals,sortIdx,sortCol,sortDir,sortAcrossGroup);rowh=sorted.rowh;cells=sorted.cells;rowTotals=sorted.rowTotals;var extents=null,barExtents=null;if(!isPivot){extents=[];barExtents=[];colhCols.forEach(function(colname,idx){if(!!viz["tcol"+idx]&&viz["tcol"+idx].isNumeric){var arr=[];cells.forEach(function(row){if(!isNaN(row[idx][0])){arr.push(row[idx][0])}});extents.push(d3.extent(arr));arr.push(0);barExtents.push(d3.extent(arr))}else{extents.push(false);barExtents.push(false)}})}console.log("Time Elapsed for pivoting data (ms): "+((new Date).getTime()-_t.getTime()));return{colh:colh,colhCols:colhCols,colhColDefs:colhColDefs,tcolColDefs:tcolColDefs,rowh:rowh,rowhCols:rowhCols,numRowh:numRowh,rowhColDefs:rowhColDefs,measCols:measCols,measColDefs:measColDefs,numMeas:numMeas,data:cells,extraData:extraCells.length>0?extraCells:null,extraCols:extraColh,colTotals:colTotals,rowTotals:rowTotals,grandTotal:grandTotal,originalRowSize:data[2][0],originalColSize:data[3][0]-numRowh,extents:extents,barExtents:barExtents}};PivotTableGenerator._sortDescending=function(a,b){a=a==="Inf"?Number.MAX_SAFE_INTEGER:a==="-Inf"?Number.MIN_SAFE_INTEGER+1:a;b=b==="Inf"?Number.MAX_SAFE_INTEGER:b==="-Inf"?Number.MIN_SAFE_INTEGER+1:b;return d3.descending(a,b)};PivotTableGenerator._sortAscending=function(a,b){a=a==="Inf"?Number.MAX_SAFE_INTEGER:a==="-Inf"?Number.MIN_SAFE_INTEGER+1:a;b=b==="Inf"?Number.MAX_SAFE_INTEGER:b==="-Inf"?Number.MIN_SAFE_INTEGER+1:b;return d3.ascending(a,b)};PivotTableGenerator.sortPivotData=function(rowh,cells,rowTotals,sortIdx,sortCol,sortDir,sortAcrossGroup){if(sortDir===_SORT_NONE){return{rowh:rowh,cells:cells,rowTotals:rowTotals}}var newrowh=[];var newrowTotals=null;if(rowTotals){newrowTotals=[];cells.forEach(function(cellrow,idx){cellrow.push(rowTotals[idx])})}cells.forEach(function(cellrow,idx){cellrow.push(rowh[idx])});var sortfunc=sortDir===_SORT_DESC?PivotTableGenerator._sortDescending:PivotTableGenerator._sortAscending;var nestedData=null,v;if(rowh.length>0&&rowh[0].length>1&&!sortAcrossGroup){nestedData=d3.nest().key(function(d){v=d[d.length-1].slice();v.pop();return v.join("::")}).entries(cells)}else{nestedData=[{key:rowh[0],values:cells}]}var isNumericColumn=sortCol?VizUtil.returnsNumericValue(sortCol):true;nestedData.forEach(function(group){group.values.sort(function(a,b){if(isNumericColumn){return sortfunc(a.length<=sortIdx||VizUtil.isEmpty(a[sortIdx])||VizUtil.isEmpty(a[sortIdx][0])||a[sortIdx][0]===""?Number.MIN_SAFE_INTEGER:isNaN(a[sortIdx][0])?a[sortIdx][0]:parseFloat(a[sortIdx][0]),b.length<=sortIdx||VizUtil.isEmpty(b[sortIdx])||VizUtil.isEmpty(b[sortIdx][0])||b[sortIdx][0]===""?Number.MIN_SAFE_INTEGER:isNaN(b[sortIdx][0])?b[sortIdx][0]:parseFloat(b[sortIdx][0]))}else{return sortfunc(a.length<=sortIdx||VizUtil.isEmpty(a[sortIdx])||VizUtil.isEmpty(a[sortIdx][0])?"":a[sortIdx][0],b.length<=sortIdx||VizUtil.isEmpty(b[sortIdx])||VizUtil.isEmpty(b[sortIdx][0])?"":b[sortIdx][0])}})});var newcells=[];nestedData.forEach(function(group){newcells=newcells.concat(group.values)});newcells.forEach(function(cellrow){newrowh.push(cellrow.pop());if(rowTotals){newrowTotals.push(cellrow.pop())}});return{rowh:newrowh,cells:newcells,rowTotals:newrowTotals}};PivotTableGenerator.getRenderFunction=function(viz,data,headerSyncDelay,onLoadCallback,onErrorCallback){var func=function(props){viz.width=props.width;viz.height=props.height;var elTarget=props.elem;PivotTableGenerator.render(viz,data,elTarget,false,headerSyncDelay,onLoadCallback,onErrorCallback)};return func};if(typeof module==="object"&&module.exports)module.exports=PivotTableGenerator;var ROutputGenerator=function(){};ROutputGenerator.render=function(viz,data,elTarget,onLoadCallback,onErrorCallback,onBeforeRenderingCallback){try{ROutputGenerator._render(viz,data,elTarget,onBeforeRenderingCallback)}catch(e){if(onErrorCallback&&typeof onErrorCallback==="function"){onErrorCallback(e,viz)}if(elTarget){VizUtil.renderNoData(elTarget,"Graph rendering failed.")}console.error(e)}finally{if(onLoadCallback&&typeof onLoadCallback==="function"){onLoadCallback()}}};ROutputGenerator._render=function(viz,data,elTarget,onBeforeRenderingCallback){if(!!onBeforeRenderingCallback&&typeof onBeforeRenderingCallback==="function"){onBeforeRenderingCallback({marker:viz.marker,data:data})}if(!elTarget){return}while(elTarget.childNodes.length>0){elTarget.removeChild(elTarget.firstChild)}if(data&&data.length===0){VizUtil.renderNoData(elTarget);return}var outputFile=null;if(data.outputFile&&data.outputFile.length>0){outputFile=data.outputFile[0];if(!/^data:/.test(outputFile)){if(/^[\/\\]/.test(outputFile)||/^[a-zA-Z]:/.test(outputFile)){outputFile="file://"+outputFile}outputFile=outputFile+"?cb="+Date.now()}}var elContent=document.createElement("div");elContent.style.width="100%";elContent.style.height="100%";elTarget.appendChild(elContent);var elImage=document.createElement("img");elImage.classList.add("r-output");elImage.src=outputFile;elImage.style.maxWidth="99%";elImage.style.maxHeight="99%";elImage.style.transform="translate(-50%, -50%)";elImage.style.position="relative";elImage.style.top="50%";elImage.style.left="50%";elContent.appendChild(elImage)};if(typeof module==="object"&&module.exports)module.exports=ROutputGenerator;"use strict";var PlotlyGraphGenerator=function(){};var NA_LABEL="(NA)";var _adjustColor=function(str,ratio){var p=typeof ratio==="string"?parseFloat(ratio):ratio;var code=_getRGBACode(str);var r=Math.max(0,Math.min(255,code.r*p));var g=Math.max(0,Math.min(255,code.g*p));var b=Math.max(0,Math.min(255,code.b*p));var a=code.a;return"rgba("+r+","+g+","+b+","+a+")"};var _setOpacity=function(str,opacity){var p=typeof ratio==="string"?parseFloat(opacity):opacity;var code=_getRGBACode(str);return"rgba("+code.r+","+code.g+","+code.b+","+p+")"};var _getRGBACode=function(str){var s,r,g,b,a;if(/rgb/.test(str)){s=str.replace(/(rgb\(|rgba\(|\))/g,"");s=s.split(",");r=parseInt(s[0]);g=parseInt(s[1]);b=parseInt(s[2]);a=s.length>3?s[3]:1}else{s=str.replace("#","");r=parseInt(s.substring(0,2),16);g=parseInt(s.substring(2,4),16);b=parseInt(s.substring(4,6),16);a=1}return{r:r,g:g,b:b,a:a}};function calculateStackedYValue(traces){var i;for(i=0;i<traces.length;i++){traces[i]["stacky"]=traces[i]["y"].slice()}for(i=1;i<traces.length;i++){for(var j=0;j<Math.min(traces[i]["stacky"].length,traces[i-1]["stacky"].length);j++){traces[i]["stacky"][j]+=traces[i-1]["stacky"][j]}}return traces}function convertToStackedYValue(traces){calculateStackedYValue(traces);traces.forEach(function(trace){trace.origy=trace.y;trace.y=trace.stacky});return traces}var isAllUnique=function(arr){var i=0,l=0,v=arr[0];for(i=0,l=arr.length;i<l;i++){if(v!==arr[i]){return false}}return true};var countNumberOfBars=function(gData){if(!gData){return 0}var o={};gData.forEach(function(g){if(g.x){g.x.forEach(function(x){o[x]=true})}});return Object.keys(o).length};var makeArrayUnique=function(arr){var h={},res=[];arr.forEach(function(i){if(!h[i]){res.push(i);h[i]=true}});return res};var isAllNull=function(arr){var i=0,l=0,isAllNull=true;for(i=0,l=arr.length;i<l;i++){if(arr[i]!==null){isAllNull=false;break}}return isAllNull};var isAllEmpty=function(arr){var i=0,l=0,isAllEmpty=true;for(i=0,l=arr.length;i<l;i++){if(arr[i]!==null&&arr[i]!==undefined){isAllEmpty=false;break}}return isAllEmpty};var isArray=function(o){return Object.prototype.toString.call(o)==="[object Array]"};var consolidateRefLines=function(gReflineLayerData){var hash={},id=null,d=null;gReflineLayerData.forEach(function(g){id=g.yaxis||"y";d=hash[id];if(!d){hash[id]=g}else{if(g.x&&isArray(g.x)&&d.x){d.x=d.x.concat(g.x)}if(g.y&&isArray(g.y)&&d.y){d.y=d.y.concat(g.y)}if(g.z&&isArray(g.z)&&d.z){d.z=d.z.concat(g.z)}if(g.text&&isArray(g.text)&&d.text){d.text=d.text.concat(g.text)}}});var gData=Object.keys(hash).map(function(key){var g=hash[key];g.visible=true;if(!g.text){return g}var text="";g.text.forEach(function(t){if(t&&t.length>text.length){text=t}});g.text=text;return g});return gData};var recalculateRefLineData=function(viz,gRefLineLayerData,layout,formatRefLineValueHash){if(!viz.x){return}if(!VizUtil.returnsNumericValue(viz.x)||viz.x.func==="ascategory"){gRefLineLayerData.forEach(function(g){if(!g||!g.x||g.x.length===0){return}var hash={},newx=[],newy=[];g.x.forEach(function(xval,idx){if(!VizUtil.isEmpty(xval)){if(!hash[xval]){newx.push(xval);hash[xval]=[]}hash[xval].push(g.y[idx])}});var yvals;g.x=newx;g.y=newx.map(function(xval){yvals=hash[xval].filter(function(v){return!VizUtil.isEmpty(v)});if(yvals.length>0){return yvals[0]}else{return null}});var reflineGroup=viz[(g.customdata?g.customdata.yOp||"y":"y")+"ReflineGroup"];if(viz.facet&&viz.facetSyncXAxis==="off"||/^(xaxis|xaxis\+facet)$/.test(reflineGroup)){newx=[],newy=[];g.x.forEach(function(v,idx){if(!VizUtil.isEmpty(g.y[idx])){newx.push(v);newy.push(g.y[idx])}});g.x=newx;g.y=newy}if(!/xaxis/.test(reflineGroup)){yvals=g.y.filter(function(v){return!VizUtil.isEmpty(v)});if(yvals.length>0){g.y=g.y.map(function(){return yvals[0]})}}})}else{gRefLineLayerData.forEach(function(g){if(!g||!g.x||g.x.length===0){return}if(/xaxis/.test(viz[(g.customdata?g.customdata.yOp||"y":"y")+"ReflineGroup"])){return}var isDiagonal=g.customdata&&g.customdata.type==="diagonal";var range;if(g.xaxis&&layout[g.xaxis.replace(/^x/,"xaxis")].range){range=layout[g.xaxis.replace(/^x/,"xaxis")].range}else{range=d3.extent(g.x);range[0]=range[0]-Math.abs(range[1]-range[0])*.1;range[1]=range[1]+Math.abs(range[1]-range[0])*.1}var step=Math.abs(range[1]-range[0])/100;var x=[],y=[],yval=null,i;for(i=0;i<g.x.length;i++){if(g.x[i]!==null&&g.y[i]!==null){yval=g.y[i];break}}for(i=0;i<100;i++){x.push(range[0]+step*i);y.push(isDiagonal?range[0]+step*i:yval)}g.x=x;g.y=y})}gRefLineLayerData.forEach(function(g){var yOp=g.customdata?g.customdata.yOp||"y":"y";var formatter=formatRefLineValueHash[yOp].formatter;var prefix=formatRefLineValueHash[yOp].prefix;var suffix=formatRefLineValueHash[yOp].suffix;g.text=g.y.map(function(v){return(g.name?g.name+": ":"")+prefix+formatter(v)+suffix})})};var recalculateVRefLineData=function(viz,gVRefLineLayerData,layout,formatVRefLineValueHash){if(!viz.y){return}if(!VizUtil.returnsNumericValue(viz.y)||viz.y.func==="ascategory"){gVRefLineLayerData.forEach(function(g){if(!g||!g.y||g.y.length===0){return}var hash={},newx=[],newy=[];g.y.forEach(function(yval,idx){if(!VizUtil.isEmpty(yval)){if(!hash[yval]){newy.push(yval);hash[yval]=[]}hash[yval].push(g.x[idx])}});var xvals;g.y=newy;g.x=newy.map(function(yval){xvals=hash[yval].filter(function(v){return!VizUtil.isEmpty(v)});if(xvals.length>0){return xvals[0]}else{return null}});if(viz.facet&&viz.facetSyncYAxis==="off"){newx=[],newy=[];g.y.forEach(function(v,idx){if(!VizUtil.isEmpty(g.x[idx])){newx.push(g.x[idx]);newy.push(v)}});g.x=newx;g.y=newy}if(!/yaxis/.test(viz.xReflineGroup)){xvals=g.x.filter(function(v){return!VizUtil.isEmpty(v)});if(xvals.length>0){g.x=g.x.map(function(){return xvals[0]})}}})}else{gVRefLineLayerData.forEach(function(g){if(!g||!g.y||g.y.length===0){return}if(/yaxis/.test(viz.xReflineGroup)){return}var range;if(g.yaxis&&layout[g.yaxis.replace(/^y/,"yaxis")].range){range=layout[g.yaxis.replace(/^y/,"yaxis")].range}else{var includeZero=false;if(viz.yAxisIncludeZero){includeZero=viz.yAxisIncludeZero==="on"}else{includeZero=!/^(scatter|bubble)$/.test(viz.marker)}range=includeZero?d3.extent([0].concat(g.y)):d3.extent(g.y);range[0]=range[0]-Math.abs(range[1]-range[0])*.1;range[1]=range[1]+Math.abs(range[1]-range[0])*.1}if(viz.marker==="hist"){range[0]=0}var step=Math.abs(range[1]-range[0])/100;var x=[],y=[],xval=null,i;for(i=0;i<g.y.length;i++){if(g.x[i]!==null&&g.y[i]!==null){xval=g.x[i];break}}for(i=0;i<100;i++){x.push(xval);y.push(range[0]+step*i)}g.x=x;g.y=y})}gVRefLineLayerData.forEach(function(g){var xOp=g.customdata?g.customdata.xOp||"x":"x";var formatter=formatVRefLineValueHash[xOp].formatter;var prefix=formatVRefLineValueHash[xOp].prefix;var suffix=formatVRefLineValueHash[xOp].suffix;g.text=g.x.map(function(v){return(g.name?g.name+": ":"")+prefix+formatter(v)+suffix})})};var recalculateDiagonalRefLineData=function(reflineGroup){if(!reflineGroup||reflineGroup.customdata.type!=="diagonal"){return reflineGroup}var xrange=d3.extent(reflineGroup.x);var yrange=d3.extent(reflineGroup.y);xrange[0]=xrange[0]-Math.abs(xrange[1]-xrange[0])*.1;xrange[1]=xrange[1]+Math.abs(xrange[1]-xrange[0])*.1;var step=Math.abs(xrange[1]-xrange[0])/100;var x=[],y=[],v;for(var i=0;i<100;i++){v=xrange[0]+step*i;x.push(v);y.push(v)}reflineGroup.x=x;reflineGroup.y=y};var getCorrespondingYAxis=function(yaxis,isFacet){var idx=!yaxis||yaxis==="y"?1:parseInt(yaxis.replace("y",""));if(idx===2&&!isFacet){return"y"}else{return"y"+(idx%2===0?idx-1:idx+1)}};PlotlyGraphGenerator._convertGraphDataForScatterLineGroupedByLabel=function(gData){gData.forEach(function(d){if(!d._label||!d.text||!/^lines/.test(d.mode)){return}var hash={},i=0,label;for(i=0;i<d._label.length;i++){label=d._label[i];if(!hash[label]){hash[label]={x:[null],y:[null],z:[null],text:[null]}}hash[label].text.push(d.text[i]);if(d.x){hash[label].x.push(d.x[i])}if(d.y){hash[label].y.push(d.y[i])}if(d.z){hash[label].z.push(d.z[i])}}var x=[],y=[],z=[],text=[],hovertext=[];Object.keys(hash).forEach(function(key){x=x.concat(hash[key].x);y=y.concat(hash[key].y);z=z.concat(hash[key].z);if(d._multiYAndColor){text=text.concat(hash[key].text.map(function(d,idx,arr){return idx===arr.length-1?d:d===null?null:""}))}else{text=text.concat(hash[key].text)}});d.text=text;if(d.x){d.x=x}if(d.y){d.y=y}if(d.z){d.z=z}})};PlotlyGraphGenerator._removeNAValues=function(gData,viz){gData.forEach(function(g){if(!g.yOp){return}if(g.y&&viz[g.yOp+"RemoveNAValues"]){PlotlyGraphGenerator._removeNAValuesFromGraphData(g)}})};PlotlyGraphGenerator._removeNAValuesFromGraphData=function(g){var x=[],y=[],text=[],customdata=[],size=[],errhigh=[],errlow=[];g.y.forEach(function(v,idx){if(!VizUtil.isEmpty(v)||g._orderRow&&g._orderRow[idx]){if(g.x&&idx<g.x.length){x.push(g.x[idx])}if(g.y&&idx<g.y.length){y.push(g.y[idx])}if(g.text&&idx<g.text.length){text.push(g.text[idx])}if(g.customdata&&idx<g.customdata.length){customdata.push(g.customdata[idx])}if(g.marker&&g.marker.size&&Array.isArray(g.marker.size)&&idx<g.marker.size.length){size.push(g.marker.size[idx])}if(g.error_y&&g.error_y.array&&idx<g.error_y.array.length){errhigh.push(g.g.error_y.array[idx])}if(g.error_y&&g.error_y.arrayminus&&idx<g.error_y.arrayminus.length){errlow.push(g.g.error_y.arrayminus[idx])}}});g.x=x;g.y=y;g.text=text;g.customdata=customdata;if(g.marker&&g.marker.size&&Array.isArray(g.marker.size)){g.marker.size=size}if(g.error_y&&g.error_y.array){g.error_y.array=errhigh}if(g.error_y&&g.error_y.arrayminus){g.error_y.arrayminus=errlow}};PlotlyGraphGenerator._sortGraphDataByHighlight=function(gData,scale,isReversed,sortHighlightLast){if(!scale.isHighlightColorScale){return}gData.forEach(function(g,idx,orgArr){var v=scale.getOrderByColor(g.marker.color);g.__sortIdx=v===0?idx:sortHighlightLast?orgArr.length+v:-v});gData.sort(function(a,b){return isReversed?b.__sortIdx-a.__sortIdx:a.__sortIdx-b.__sortIdx})};PlotlyGraphGenerator._removeRowsForOrder=function(gData){gData.forEach(function(g){if(g._orderRow){var x=[],y=[],text=[],customdata=[],size=[],errhigh=[],errlow=[];g._orderRow.forEach(function(v,idx){if(!v){if(g.x&&idx<g.x.length){x.push(g.x[idx])}if(g.y&&idx<g.y.length){y.push(g.y[idx])}if(g.text&&idx<g.text.length){text.push(g.text[idx])}if(g.customdata&&idx<g.customdata.length){customdata.push(g.customdata[idx])}if(g.marker&&g.marker.size&&Array.isArray(g.marker.size)&&idx<g.marker.size.length){size.push(g.marker.size[idx])}if(g.error_y&&g.error_y.array&&idx<g.error_y.array.length){errhigh.push(g.g.error_y.array[idx])}if(g.error_y&&g.error_y.arrayminus&&idx<g.error_y.arrayminus.length){errlow.push(g.g.error_y.arrayminus[idx])}}});g.x=x;g.y=y;g.text=text;g.customdata=customdata;if(g.marker&&g.marker.size&&Array.isArray(g.marker.size)){g.marker.size=size}if(g.error_y&&g.error_y.array){g.error_y.array=errhigh}if(g.error_y&&g.error_y.arrayminus){g.error_y.arrayminus=errlow}}})};PlotlyGraphGenerator._unsyncAxis=function(gData,axis,existOrderRowOnAxis){var vaxis=axis==="x"?"y":"x",i,facets=[];gData.forEach(function(g){if(!facets[g.facet]){facets[g.facet]=[]}if(typeof facets[g.facet].push!=="function"){throw new Error("Error happened during the chart generation: ["+g.facet+"], ["+typeof facets[g.facet].push+"]")}facets[g.facet].push(g)});Object.keys(facets).forEach(function(facetName){var groups=facets[facetName];var hash={};groups.forEach(function(g){if(g[axis]&&g[axis].length>0){g[axis].forEach(function(t,idx){if(!VizUtil.isEmpty(g[vaxis][idx])){hash[t]=true}})}});groups.forEach(function(g){i=0;if(g[axis]&&g[axis].length>0){while(i<g[axis].length){if(!hash[g[axis][i]]&&(existOrderRowOnAxis||(!g._orderRow||i<g._orderRow.length&&g._orderRow[i]===false))){g[axis].splice(i,1);if(g[vaxis]&&isArray(g[vaxis])&&i<g[vaxis].length){g[vaxis].splice(i,1)}if(g.text&&isArray(g.text)&&i<g.text.length){g.text.splice(i,1)}if(g.marker&&g.marker.size&&isArray(g.marker.size)&&i<g.marker.size.length){g.marker.size.splice(i,1)}if(g.customdata&&isArray(g.customdata)&&i<g.customdata.length){g.customdata.splice(i,1)}if(g.error_y&&g.error_y.array&&isArray(g.error_y.array)&&i<g.error_y.array.length){g.error_y.array.splice(i,1)}if(g.error_y&&g.error_y.arrayminus&&isArray(g.error_y.arrayminus)&&i<g.error_y.arrayminus.length){g.error_y.arrayminus.splice(i,1)}}else{i++}}}})})};PlotlyGraphGenerator._createOrderControlLayer=function(data,viz){var xarr=[],yarr=[];data.forEach(function(d){xarr.push(d[viz.x.validLabel]);yarr.push(d[viz.y.validLabel])});xarr=makeArrayUnique(xarr);yarr=makeArrayUnique(yarr);var xext=[],yext=[];xarr.forEach(function(xval){yarr.forEach(function(yval){xext.push(xval);yext.push(yval)})});var zeroext=xext.map(function(){return 0});var nullext=xext.map(function(){return null});var layer={mode:"markers",name:"",showlegend:false,x:xext,y:yext,marker:{size:zeroext},hoverinfo:"skip"};return layer};var useOverlayMode=function(x,color,facet,marker){return!x&&!color||!x&&color&&marker==="violin"||x&&color&&x.name===color.name||x&&!color&&facet||color&&facet&&color.name===facet.name};var calculateRange=function(gData,targetProp,axisScale,showZero,isDate,marker,valueOnPlotProp,isFacet,barstyle,color,isMultiY,rangeTarget,topMarginRatio,bottomMarginRatio){if(targetProp==="x"&&/^(line|area|bar)$/.test(marker)){return null}rangeTarget=rangeTarget||"all";var dataArr=[];gData.forEach(function(d){if(rangeTarget==="y1"&&d.use2ndAxis){return}else if(rangeTarget==="y2"&&!d.use2ndAxis){return}if(d[targetProp]){dataArr=dataArr.concat(d[targetProp])}if(targetProp==="y"&&d.error_y&&d.error_y.array&&d.error_y.array.length===d[targetProp].length){d[targetProp].forEach(function(v,idx){dataArr.push(v+d.error_y.array[idx]);if(d.error_y.arrayminus){dataArr.push(v-d.error_y.arrayminus[idx])}else{dataArr.push(v-d.error_y.array[idx])}})}});if(isDate){dataArr=dataArr.map(function(d){return Date.parse(d)})}if(showZero&&!isDate){dataArr.push(0)}var ext=d3.extent(dataArr);if(!ext||ext.length!==2||typeof ext[0]!=="number"||typeof ext[1]!=="number"){return null}var _topMarginRatio=.17;var _bottomMarginRatio=.17;if(targetProp!=="x"&&/^(bar|errbar)$/.test(marker)){_bottomMarginRatio=.04}if(targetProp!=="x"&&/^(area|line)$/.test(marker)){_topMarginRatio=.04;_bottomMarginRatio=.04}if(valueOnPlotProp==="bottom"){_bottomMarginRatio=.2}if(topMarginRatio){_topMarginRatio=topMarginRatio}if(bottomMarginRatio){_bottomMarginRatio=bottomMarginRatio}var dataRange=Math.abs(ext[1]-ext[0]);ext[0]=ext[0]-dataRange*_bottomMarginRatio;ext[1]=ext[1]+dataRange*_topMarginRatio;if(axisScale==="log"){ext[0]=Math.log10(Math.max(0,ext[0]));ext[1]=Math.log10(Math.max(0,ext[1]))}return ext};PlotlyGraphGenerator._flattenData=function(nestData,key){var flattened=d3.nest().key(function(d){return d[key]===null?NA_LABEL:d[key]}).entries(nestData);var orderedKeys=VizUtil.distinct(nestData.map(function(d){return d[key]===null?NA_LABEL:d[key]}));var hash={};flattened.forEach(function(d){hash[d.key]=d});var sorted=[];orderedKeys.forEach(function(d){if(hash[d]){sorted.push(hash[d])}});return sorted};PlotlyGraphGenerator._flattenDataByFacet=function(viz,nestData){if(viz.facet){var newData=[];nestData.forEach(function(g){var n=PlotlyGraphGenerator._flattenData(g.values,viz.facet.label);n.forEach(function(t){t.facet=t.key;t.key=g.key;if(g.ycolname){t.ycolname=g.ycolname}if(g.winfunc){t.winfunc=g.winfunc}if(g.yOp){t.yOp=g.yOp}if(g.use2ndAxis){t.use2ndAxis=g.use2ndAxis}});newData=newData.concat(n)});return newData}else{return nestData}};var convertCoefByTimeUnit=function(coef,aggfunc,type){if(type==="Date"||type.indexOf("POSIXct")>-1){if(type.indexOf("POSIXct")>-1){coef=coef*(24*60*60)}switch(aggfunc){case"rtoyear":case"year":coef=coef*365.25;break;case"rtohalfyear":case"halfyear":coef=coef*(365.25/2);break;case"rtoq":case"quarter":coef=coef*(365.25/4);break;case"rtobimon":case"bimon":coef=coef*(365.25/6);break;case"rtomon":case"mon":case"monname":coef=coef*(365.25/12);break;case"rtoweek":case"week":coef=coef*7;break;case"rtohour":case"hour":coef=coef/24;break;case"rtomin":case"minute":coef=coef/(24*60);break;case"rtosec":case"second":coef=coef/(24*60*60)}}return coef};PlotlyGraphGenerator._convertCoefByTimeUnit=convertCoefByTimeUnit;var convertToStackedAreas=function(gData){var facets={};gData.forEach(function(g){if(!facets[g.facet]){facets[g.facet]=[];g.fill="tozeroy"}else{g.fill="tonexty"}facets[g.facet].push(g)});Object.keys(facets).forEach(function(key){convertToStackedYValue(facets[key])})};var formatValue=VizUtil.valueFormatterGenerator(2,true,true);var constructFacetData=function(viz,gData,layout,defaultColor,gRangeLayerData,gTrendLineLayerData,gTrendLineRangeLayerData,colsOn2ndAxis,gRefLineLayerData,gRefLineUpperRangeLayerData,gRefLineLowerRangeLayerData,gVRefLineLayerData,gVRefLineConfIntLayerData){if(viz.facet){var marker=viz.marker;var ys=VizUtil.getOptions(viz,"y");var isMultiY=ys.length>1;var numY=0;ys.forEach(function(_y){if(_y){numY++}});var xAxisShowTitle=viz.xAxisShowTitle!=="off";var yAxisShowTitle=viz.yAxisShowTitle!=="off";var y2AxisShowTitle=viz.y2AxisShowTitle!=="off";var isColorContinuous=viz.color&&VizUtil.isContinuousValue(viz.color,marker,"color");var userXAxisRange=PlotlyGraphGenerator.getAxisRange(viz.xAxisRange);var userYAxisRange=PlotlyGraphGenerator.getAxisRange(viz.yAxisRange);var userY2AxisRange=PlotlyGraphGenerator.getAxisRange(viz.y2AxisRange);var xValuePrefix="",y1ValuePrefix="",y2ValuePrefix="",xValueSuffix="",y1ValueSuffix="",y2ValueSuffix="";if(viz.x){xValuePrefix=VizUtil.getValuePrefix(viz.xAxisNumberFormatting,viz.xAxisCurrencySymbol,viz.marker);xValueSuffix=VizUtil.getValueSuffix(null,viz.x.func,viz.xAxisNumberFormatting,viz.marker)}if(viz.y){y1ValuePrefix=VizUtil.getValuePrefix(viz.yAxisNumberFormatting,viz.yAxisCurrencySymbol,viz.marker);y1ValueSuffix=VizUtil.getValueSuffix(viz.yWindowFunc,viz.y.func,viz.yAxisNumberFormatting,viz.marker)}y2ValuePrefix=VizUtil.getValuePrefix(viz.y2AxisNumberFormatting,viz.y2AxisCurrencySymbol,viz.marker);if(colsOn2ndAxis&&colsOn2ndAxis.length>0){ys.forEach(function(y,idx){if(y2ValueSuffix){return}if(viz["y"+idx+"Use2ndAxis"]){y2ValueSuffix=y&&VizUtil.getValueSuffix(viz["y"+idx+"WindowFunc"],y.func,viz.y2AxisNumberFormatting,viz.marker)}})}xValuePrefix=viz.xAxisValuePrefix||xValuePrefix;xValueSuffix=viz.xAxisValueSuffix||xValueSuffix;y1ValuePrefix=viz.y1AxisValuePrefix||y1ValuePrefix;y1ValueSuffix=viz.y1AxisValueSuffix||y1ValueSuffix;y2ValuePrefix=viz.y2AxisValuePrefix||y2ValuePrefix;y2ValueSuffix=viz.y2AxisValueSuffix||y2ValueSuffix;var xTickFormat=viz.xAxisNumDecimalDigits?",."+viz.xAxisNumDecimalDigits+"f":viz.xAxisTickFormat;var yTickFormat=viz.y1AxisNumDecimalDigits?",."+viz.y1AxisNumDecimalDigits+"f":viz.yAxisTickFormat;var y2TickFormat=viz.y2AxisNumDecimalDigits?",."+viz.y2AxisNumDecimalDigits+"f":viz.y2AxisTickFormat;var fvalues0=gData.map(function(g){return g.facet});var fvalues=[];fvalues0.forEach(function(v,idx){if(fvalues0.indexOf(v)===idx){fvalues.push(v)}});var ncols=viz.numFacetColumns||"auto";if(ncols==="auto"){if(viz._canvasWidth){var _facetWidth=viz._canvasWidth;ncols=1;while(_facetWidth>VizUtil.MAX_FACET_WIDTH){ncols++;_facetWidth=viz._canvasWidth/ncols}}else{ncols=VizUtil.DEFAULT_FACET_SIZE}if(fvalues.length<ncols){ncols=fvalues.length}}var nrows=Math.ceil(fvalues.length/ncols);var X_AXIS_AREA_HEIGHT=80;var X_AXIS_AREA_HEIGHT_PLUS_MARGIN=X_AXIS_AREA_HEIGHT+10;var Y_AXIS_AREA_WIDTH=40;if(viz.facetSyncYAxis==="off"&&gData.filter(function(g){return g.use2ndAxis}).length>0){Y_AXIS_AREA_WIDTH*=2}var facetW=(layout.width-layout.margin.l)/ncols;if(viz.facetSqueezePlots!=="on"&&nrows>2){layout.height=Math.max(layout.height,(facetW+X_AXIS_AREA_HEIGHT)*nrows+layout.margin.t)}var facetY=(layout.height-layout.margin.t)/nrows;var xdomain=[],ydomain=[],i;for(i=0;i<ncols;i++){xdomain.push(i)}for(i=0;i<nrows;i++){ydomain.push(i)}var paddingRatio=Y_AXIS_AREA_WIDTH/facetW;var xscale=d3.scale.ordinal().domain(xdomain).rangeBands([0,100],paddingRatio,0);var xrange=xscale.range();var xrangeBand=xscale.rangeBand();xrangeBand=Math.max(xrangeBand,1);paddingRatio=X_AXIS_AREA_HEIGHT_PLUS_MARGIN/facetY;var yscale=d3.scale.ordinal().domain(ydomain).rangeBands([0,100],paddingRatio,0);var yrange=yscale.range().reverse();var yrangeBand=yscale.rangeBand();yrangeBand=Math.max(yrangeBand,1);delete layout.xaxis;delete layout.yaxis;delete layout.yaxis2;delete layout.zaxis;if(marker==="area"){convertToStackedAreas(gData)}var syncXAxis=viz.facetSyncXAxis!=="off";if(!viz.facetSyncXAxis&&viz.facetEnableDataCompletion==="off"){syncXAxis=false}var syncYAxis=viz.facetSyncYAxis!=="off";if(!viz.facetSyncYAxis&&viz.facetEnableDataCompletion==="off"){syncYAxis=false}var gd=gData;if(gRangeLayerData){gd=gd.concat(gRangeLayerData)}if(gTrendLineLayerData){gd=gd.concat(gTrendLineLayerData)}if(gTrendLineRangeLayerData){gd=gd.concat(gTrendLineRangeLayerData)}if(gRefLineUpperRangeLayerData){gd=gd.concat(gRefLineUpperRangeLayerData)}if(gRefLineLowerRangeLayerData){gd=gd.concat(gRefLineLowerRangeLayerData)}if(gRefLineLayerData){gd=gd.concat(gRefLineLayerData)}if(gVRefLineConfIntLayerData){gd=gd.concat(gVRefLineConfIntLayerData)}if(gVRefLineLayerData){gd=gd.concat(gVRefLineLayerData)}var includeZeroOnXAxis=/^(scatter|bubble)$/.test(marker)&&viz.xAxisIncludeZero==="on";var xAxisRange=syncXAxis?calculateRange(gData,"x",viz.xAxisScale,includeZeroOnXAxis,viz.x&&VizUtil.returnsDateValue(viz.x),marker,viz.yValueOnPlot,true,viz.barstyle,viz.color,isMultiY):null;var includeZeroOnYAxis=/^(scatter|bubble)$/.test(marker)&&viz.yAxisIncludeZero==="on"||/^(bar|line)$/.test(marker)&&viz.yAxisIncludeZero!=="off";var yAxisRange=syncYAxis?calculateRange(gd,"y",viz.yAxisScale,includeZeroOnYAxis,false,marker,viz.yValueOnPlot,null,null,null,null,"y1"):null;var includeZeroOnY2Axis=/^(scatter|bubble)$/.test(marker)&&viz.y2AxisIncludeZero==="on"||/^(bar|line)$/.test(marker)&&viz.y2AxisIncludeZero!=="off";var y2AxisRange=syncYAxis?calculateRange(gd,"y",viz.y2AxisScale,includeZeroOnY2Axis,false,marker,viz.yValueOnPlot,null,null,null,null,"y2"):null;var xAxisTitleFontSize=viz.facetTitleFontSize||viz.xAxisTitleFontSize||(marker!=="pie"&&ncols>6||marker==="pie"&&ncols>2?12:13);var yAxisTitleFontSize=viz.yAxisTitleFontSize||13;var y2AxisTitleFontSize=viz.y2AxisTitleFontSize||13;var yAxisTitle=viz.yAxisTitle;if(!yAxisTitle){if(marker==="hist"){yAxisTitle=VizUtil.FREQ_COL_LABEL}else if(viz.y){yAxisTitle=viz.y.name===VizUtil.NUMROWS_COL_NAME?VizUtil.NUMROWS_COL_LABEL:viz.y.name}else{yAxisTitle=""}}var y2AxisTitle=viz.y2AxisTitle;if(!y2AxisTitle){if(marker==="hist"){y2AxisTitle=VizUtil.FREQ_COL_LABEL}else if(colsOn2ndAxis&&colsOn2ndAxis.length>0){y2AxisTitle=colsOn2ndAxis[0].name===VizUtil.NUMROWS_COL_NAME?VizUtil.NUMROWS_COL_LABEL:colsOn2ndAxis[0].name}else{y2AxisTitle=""}}var xAxisTickFontSize=viz.xAxisTickFontSize||10;var yAxisTickFontSize=viz.yAxisTickFontSize||10;var y2AxisTickFontSize=viz.y2AxisTickFontSize||10;var facetShowZeroLine=viz.facetShowZeroLine!=="off";var arr=[],reflineHash={},vreflineHash={};gData.forEach(function(g,gidx){var idx=fvalues.indexOf(g.facet);var xidx=idx%ncols;var yidx=Math.floor(idx/ncols);var x=xrange[xidx];var y=yrange[yidx];var axisIdx=idx*2+1;var xaxisIdx=axisIdx;var yaxisIdx=axisIdx+(g.use2ndAxis?1:0);var legendgroup=g.name+(g.yOp||"");g.legendgroup=legendgroup;if(arr.indexOf(legendgroup)===-1){arr.push(legendgroup)}else{g.showlegend=false}layout["xaxis"+xaxisIdx]={domain:[x/100,(x+xrangeBand)/100],anchor:"y"+yaxisIdx,title:xAxisShowTitle?g.facet:"",titlefont:{size:xAxisTitleFontSize},tickfont:{size:xAxisTickFontSize},tickprefix:xValuePrefix,ticksuffix:xValueSuffix,zeroline:facetShowZeroLine,showticklabels:true,zerolinecolor:VizUtil.ZERO_LINE_COLOR};if(viz.axisAutoMargin!=="off"){layout["xaxis"+xaxisIdx].automargin=true}if(marker==="heatmap"){layout["xaxis"+xaxisIdx].type="category";if(viz.xAxisPosition==="top"){layout["xaxis"+xaxisIdx].side="top"}}if(viz.xAxisDirection&&VizUtil.isAxisDirectionEnabled(marker)){layout["xaxis"+xaxisIdx].autorange=viz.xAxisDirection}if(/^(bar|errbar|bubble)$/.test(marker)&&viz.x&&(VizUtil.returnsCharacterValue(viz.x)||viz.x.func==="ascategory")){layout["xaxis"+xaxisIdx].type="category"}if(/^(scatter|bubble)$/.test(marker)&&viz.xAxisScale){layout["xaxis"+xaxisIdx].type=viz.xAxisScale}if(viz.x&&VizUtil.returnsDateValue(viz.x)){layout["xaxis"+xaxisIdx].type="date"}if(VizUtil.isPostFilterSupported(viz)&&viz.xPostFilterType){layout["xaxis"+xaxisIdx].type="category"}if(xAxisRange){layout["xaxis"+xaxisIdx].range=xAxisRange;if(userXAxisRange){layout["xaxis"+xaxisIdx].range=userXAxisRange}if(viz.xAxisTickStep&&viz.x&&VizUtil.returnsNumericValue(viz.x)){layout["xaxis"+xaxisIdx].dtick=viz.xAxisTickStep}}if(viz.showXGridLines&&viz.showXGridLines!=="default"){layout["xaxis"+xaxisIdx].showgrid=viz.showXGridLines==="on"}if(!viz.x){layout["xaxis"+xaxisIdx].zeroline=false}if(viz.showXZeroLine&&viz.showXZeroLine!=="default"){layout["xaxis"+xaxisIdx].zeroline=viz.showXZeroLine==="on"}if(!viz.x){layout["xaxis"+xaxisIdx].showticklabels=false}else if(VizUtil.returnsCharacterValue(viz.x)||viz.x.func==="ascategory"){layout["xaxis"+xaxisIdx].type="category"}if(g.use2ndAxis){layout["yaxis"+yaxisIdx]={domain:[y/100,(y+yrangeBand)/100],anchor:"x"+xaxisIdx,title:xidx===ncols-1&&yidx===0&&y2AxisShowTitle?y2AxisTitle:null,titlefont:{size:y2AxisTitleFontSize},tickfont:{size:y2AxisTickFontSize},showticklabels:xidx===ncols-1||!syncYAxis,zeroline:facetShowZeroLine,zerolinecolor:VizUtil.ZERO_LINE_COLOR,tickprefix:y2ValuePrefix,ticksuffix:y2ValueSuffix,side:"right",overlaying:"y"+(yaxisIdx-1)};if(viz.axisAutoMargin!=="off"){layout["yaxis"+yaxisIdx].automargin=true}if(y2TickFormat){layout["yaxis"+yaxisIdx].tickformat=y2TickFormat}if(y2AxisRange){layout["yaxis"+yaxisIdx].range=y2AxisRange}if(userY2AxisRange){layout["yaxis"+yaxisIdx].range=userY2AxisRange}if(viz.y2AxisTickStep&&viz.y&&VizUtil.returnsNumericValue(viz.y)){layout["yaxis"+yaxisIdx].dtick=viz.y2AxisTickStep}layout["yaxis"+yaxisIdx].showgrid=viz.showY2GridLines==="on";layout["yaxis"+yaxisIdx].zeroline=viz.showY2ZeroLine==="on";if(/^(bar|errbar|bubble)$/.test(marker)&&viz.y&&(VizUtil.returnsCharacterValue(viz.y)||viz.y.func==="ascategory")){layout["yaxis"+yaxisIdx].type="category"}if(VizUtil.returnsDateValue(colsOn2ndAxis[0])){layout["yaxis"+yaxisIdx].type="date"}if(viz.y2AxisDirection&&VizUtil.isAxisDirectionEnabled(marker)){
layout["yaxis"+yaxisIdx].autorange=viz.y2AxisDirection}}else{layout["yaxis"+yaxisIdx]={domain:[y/100,(y+yrangeBand)/100],anchor:"x"+xaxisIdx,title:xidx===0&&yidx===0&&yAxisShowTitle?yAxisTitle:null,titlefont:{size:yAxisTitleFontSize},tickfont:{size:yAxisTickFontSize},showticklabels:xidx===0||!syncYAxis,zeroline:facetShowZeroLine,zerolinecolor:VizUtil.ZERO_LINE_COLOR,ticksuffix:y1ValueSuffix,tickprefix:y1ValuePrefix};if(viz.axisAutoMargin!=="off"){layout["yaxis"+yaxisIdx].automargin=true}if(yTickFormat){layout["yaxis"+yaxisIdx].tickformat=yTickFormat}if(yAxisRange){layout["yaxis"+yaxisIdx].range=yAxisRange}if(userYAxisRange){layout["yaxis"+yaxisIdx].range=userYAxisRange}if(viz.yAxisTickStep&&viz.y&&VizUtil.returnsNumericValue(viz.y)){layout["yaxis"+yaxisIdx].dtick=viz.yAxisTickStep}if(viz.showYGridLines&&viz.showYGridLines!=="default"){layout["yaxis"+yaxisIdx].showgrid=viz.showYGridLines==="on"}if(viz.showYZeroLine&&viz.showYZeroLine!=="default"){layout["yaxis"+yaxisIdx].zeroline=viz.showYZeroLine==="on"}if(marker==="heatmap"){if(xidx!==0){layout["yaxis"+yaxisIdx].ticklen=0}layout["yaxis"+yaxisIdx].type="category"}if(/^(bar|errbar|bubble)$/.test(marker)&&viz.y&&(VizUtil.returnsCharacterValue(viz.y)||viz.y.func==="ascategory")){layout["yaxis"+yaxisIdx].type="category"}if(viz.yAxisDirection&&VizUtil.isAxisDirectionEnabled(marker)){layout["yaxis"+yaxisIdx].autorange=viz.yAxisDirection}}if(/^(scatter|bar|errbar|hist|bubble|line|area)$/.test(marker)&&viz.yAxisScale){layout["yaxis"+yaxisIdx].type=viz.yAxisScale}if(viz.y&&VizUtil.returnsDateValue(viz.y)){layout["yaxis"+yaxisIdx].type="date"}g.xaxis="x"+xaxisIdx;g.yaxis="y"+yaxisIdx;if(!viz.color&&!isMultiY){if(!g.marker){g.marker={}}g.marker.color=defaultColor||"rgb(31, 119, 180)"}if(gRangeLayerData&&gRangeLayerData.length>0){gRangeLayerData[gidx].xaxis="x"+xaxisIdx;gRangeLayerData[gidx].yaxis="y"+yaxisIdx;gRangeLayerData[gidx].legendgroup="lg"+g.name;g.legendgroup="lg"+g.name;if(!g.x||g.x.length===0){gRangeLayerData[gidx].x=[];gRangeLayerData[gidx].y=[]}}if(gTrendLineLayerData&&gTrendLineLayerData.length>0){gTrendLineLayerData[gidx].xaxis="x"+xaxisIdx;gTrendLineLayerData[gidx].yaxis="y"+yaxisIdx;gTrendLineLayerData[gidx].legendgroup="lg"+g.name;g.legendgroup="lg"+g.name;if((!g.x||g.x.length===0)&&!isColorContinuous){gTrendLineLayerData[gidx].x=[];gTrendLineLayerData[gidx].y=[]}}if(gTrendLineRangeLayerData&&gTrendLineRangeLayerData.length>0){gTrendLineRangeLayerData[gidx].xaxis="x"+xaxisIdx;gTrendLineRangeLayerData[gidx].yaxis="y"+yaxisIdx;gTrendLineRangeLayerData[gidx].legendgroup="lg"+g.name;g.legendgroup="lg"+g.name;if((!g.x||g.x.length===0)&&!isColorContinuous){gTrendLineRangeLayerData[gidx].x=[];gTrendLineRangeLayerData[gidx].y=[]}}if(gRefLineUpperRangeLayerData&&gRefLineUpperRangeLayerData.length>0&&gRefLineUpperRangeLayerData[gidx]){gRefLineUpperRangeLayerData[gidx].xaxis="x"+xaxisIdx;gRefLineUpperRangeLayerData[gidx].yaxis="y"+yaxisIdx;gRefLineUpperRangeLayerData[gidx].legendgroup="refline"+g.name;gRefLineUpperRangeLayerData[gidx].visible=!reflineHash["x"+xaxisIdx+"y"+yaxisIdx+(gRefLineUpperRangeLayerData[gidx].customdata.yOp||"")];if(!g.x||g.x.length===0){gRefLineUpperRangeLayerData[gidx].x=[];gRefLineUpperRangeLayerData[gidx].y=[]}}if(gRefLineLowerRangeLayerData&&gRefLineLowerRangeLayerData.length>0&&gRefLineLowerRangeLayerData[gidx]){gRefLineLowerRangeLayerData[gidx].xaxis="x"+xaxisIdx;gRefLineLowerRangeLayerData[gidx].yaxis="y"+yaxisIdx;gRefLineLowerRangeLayerData[gidx].legendgroup="refline"+g.name;gRefLineLowerRangeLayerData[gidx].visible=!reflineHash["x"+xaxisIdx+"y"+yaxisIdx+(gRefLineLowerRangeLayerData[gidx].customdata.yOp||"")];if(!g.x||g.x.length===0){gRefLineLowerRangeLayerData[gidx].x=[];gRefLineLowerRangeLayerData[gidx].y=[]}}if(gRefLineLayerData&&gRefLineLayerData.length>0&&gRefLineLayerData[gidx]){gRefLineLayerData[gidx].xaxis="x"+xaxisIdx;gRefLineLayerData[gidx].yaxis="y"+yaxisIdx;gRefLineLayerData[gidx].legendgroup="refline"+g.name;if(!g.x||g.x.length===0){gRefLineLayerData[gidx].x=[];gRefLineLayerData[gidx].y=[]}if(isAllNull(gRefLineLayerData[gidx].y)){gRefLineLayerData[gidx].visible=false}else{gRefLineLayerData[gidx].visible=!reflineHash["x"+xaxisIdx+"y"+yaxisIdx+(gRefLineLayerData[gidx].customdata.yOp||"")];reflineHash["x"+xaxisIdx+"y"+yaxisIdx+(gRefLineLayerData[gidx].customdata.yOp||"")]=true}}if(gVRefLineLayerData&&gVRefLineLayerData.length>0){gVRefLineLayerData[gidx].xaxis="x"+xaxisIdx;gVRefLineLayerData[gidx].yaxis="y"+yaxisIdx;if(!g.x||g.x.length===0){gVRefLineLayerData[gidx].x=[];gVRefLineLayerData[gidx].y=[]}if(isAllNull(gVRefLineLayerData[gidx].x)){gVRefLineLayerData[gidx].visible=false}else{gVRefLineLayerData[gidx].visible=!vreflineHash["x"+xaxisIdx+"y"+yaxisIdx];vreflineHash["x"+xaxisIdx+"y"+yaxisIdx]=true}}if(gVRefLineConfIntLayerData&&gVRefLineConfIntLayerData.length>0){gVRefLineConfIntLayerData[gidx].xaxis="x"+xaxisIdx;gVRefLineConfIntLayerData[gidx].yaxis="y"+yaxisIdx;if(!g.x||g.x.length===0){gVRefLineConfIntLayerData[gidx].x=[];gVRefLineConfIntLayerData[gidx].y=[]}}});if(/^(bar|line|area)$/.test(viz.marker)&&viz.facet&&!syncXAxis){var h={};gData.forEach(function(g){if(!h[g.facet]){h[g.facet]=[]}h[g.facet].push(g)});Object.keys(h).forEach(function(key){var i=0,group=h[key];while(i<group[0].y.length){var allzero=true,allnull=true,isOrderRow=group[0]._orderRow&&i<group[0]._orderRow.length&&group[0]._orderRow[i]===true;group.forEach(function(d){allzero=d.y[i]===0&&allzero;allnull=d.y[i]===null&&allnull});if(allzero||allnull){if(isOrderRow&&viz.marker==="line"){group.forEach(function(d){d.x[i]=null});i++;return}group.forEach(function(d){d.y.splice(i,1);if(d.x&&isArray(d.x)&&i<d.x.length){d.x.splice(i,1)}if(d.text&&isArray(d.text)&&i<d.text.length){d.text.splice(i,1)}if(d.marker.size&&isArray(d.marker.size)&&i<d.marker.size.length){d.marker.size.splice(i,1)}if(d.customdata&&isArray(d.customdata)&&i<d.customdata.length){d.customdata.splice(i,1)}if(d.error_y&&d.error_y.array&&isArray(d.error_y.array)&&i<d.error_y.array.length){d.error_y.array.splice(i,1)}if(d.error_y&&d.error_y.arrayminus&&isArray(d.error_y.arrayminus)&&i<d.error_y.arrayminus.length){d.error_y.arrayminus.splice(i,1)}})}else{i++}}})}if(/^(scatter)$/.test(viz.marker)&&viz.facet){var scatterLineGroupedByLabel=viz.yMarkerShape==="line"&&!!viz.label;var xAxisDataTypeDetection=viz.xAxisDataTypeDetection==="on";if(!syncXAxis){PlotlyGraphGenerator._unsyncAxis(gData,"x",VizUtil.returnsCharacterValue(viz.x)&&!scatterLineGroupedByLabel&&!xAxisDataTypeDetection)}if(!syncYAxis&&viz.y){PlotlyGraphGenerator._unsyncAxis(gData,"y",VizUtil.returnsCharacterValue(viz.y)&&!scatterLineGroupedByLabel)}}if(/^(bubble)$/.test(viz.marker)&&!!viz.facet&&!!viz["xPostFilterType"]){if(!syncXAxis){PlotlyGraphGenerator._unsyncAxis(gData,"x",VizUtil.returnsCharacterValue(viz.x))}}if(layout.showlegend!==false){layout.showlegend=numY>1||!!viz.color}}return{layout:layout,gData:gData}};PlotlyGraphGenerator._constructFacetData=constructFacetData;PlotlyGraphGenerator.reverseColorOrder=function(gData){var len=gData.length,i;var colors=gData.map(function(g){return g.fillcolor?g.fillcolor:g.marker.color});var colorBuckets=[];var lastc=null;for(i=0;i<len;i++){if(lastc!==colors[i]){colorBuckets.push(colors[i]);lastc=colors[i]}}lastc=null;var newc=null;for(i=0;i<len;i++){if(lastc!==colors[i]){newc=colorBuckets.pop();lastc=colors[i]}if(gData[i].fillcolor){gData[i].fillcolor=newc}else{gData[i].marker.color=newc}}return gData};PlotlyGraphGenerator._switchOrientation=function(gData,layout){var x;gData.forEach(function(data){x=data.x;data.x=data.y;data.y=x;x=data.xaxis;data.xaxis=data.yaxis?data.yaxis.replace("y","x"):null;data.yaxis=x?x.replace("y","x"):null;if(data.xaxis===null){delete data.xaxis}if(data.yaxis===null){delete data.yaxis}if(data.orientation&&data.orientation==="h"){delete data.orientation}else{data.orientation="h"}});x=layout.xaxis;layout.xaxis=layout.yaxis;layout.yaxis=x;layout.yaxis.autorange="reversed";layout.yaxis.ticksuffix=" ";if(layout.yaxis2){layout.xaxis2=layout.yaxis2;layout.xaxis2.overlaying="x";layout.xaxis2.side="top";delete layout.yaxis2}if(layout.annotations){layout.annotations.forEach(function(data){x=data.x;data.x=data.y;data.y=x;data.xanchor="left";data.yanchor="middle"})}};PlotlyGraphGenerator._addCustomBalloon=function(elem,onShowDetailCallback,onKeepThisCallback,onExcludeCallback){if(!onShowDetailCallback&&!onKeepThisCallback&&!onExcludeCallback){return}var traces={};var handler=function(data){var $balloon=$("#viz-balloon");if($balloon.length===0){$balloon=$('<div id="viz-balloon"/>');$(elem).append($balloon)}else{$balloon.empty()}var isMultiSelect=data.event.ctrlKey||data.event.metaKey;var cdata;var $row;var $head=$('<div class="balloon-header"></div>');$balloon.append($head);var $htable=$('<div class="balloon-header-table"></div>');$head.append($htable);var $hrow=$('<div class="balloon-header-table-row"></div>');$htable.append($hrow);var $body=$('<div class="balloon-body"></div>');var $table=$('<div class="balloon-body-table"></div>');$body.append($table);$balloon.append($body);if(data.points&&data.points.length>0){var isPie=false,isBoxplot=false,isLine=false,isArea=false,isHeatmap=false,v,colors;cdata=data.points[0].customdata;if(data.points&&data.points[0]&&data.points[0].data&&data.points[0].data.type==="pie"){var idx=data.points[0].data.labels.indexOf(data.points[0].label);cdata=data.points[0].data.customdata[idx];colors=data.points[0].data.marker.colors;isPie=true}if(cdata){isBoxplot=data.points[0].data&&data.points[0].data.type==="box";isHeatmap=data.points[0].data&&/^(heatmap|contour)$/.test(data.points[0].data.type);isLine=data.points[0].data&&/^lines/.test(data.points[0].data.mode);isArea=data.points[0].data&&/^(tonexty|tozeroy)$/.test(data.points[0].data.fill);isLine=isArea?false:isLine;var t,tIndex,tColor,tSize,tData,dIndex,isSelectedItemClicked=false;dIndex=isHeatmap?data.points[0].pointNumber.toString():data.points[0].pointNumber;tIndex=data.points[0].fullData.index;if(!isMultiSelect){Object.keys(traces).forEach(function(key){t=traces[key];isSelectedItemClicked=!!t.data[dIndex];if(t.isLine){Plotly.restyle(elem,{mode:"lines",marker:{color:t.color,size:0}},t.traceIndex)}else if(t.isArea){Plotly.restyle(elem,{mode:"none",marker:{size:0}},t.traceIndex)}else{Plotly.restyle(elem,{marker:{color:t.color,line:{width:0},size:t.size}},t.traceIndex)}});traces={}}t=traces[tIndex];if(t){t.data[dIndex]=!t.data[dIndex]?cdata:false}else{tColor=isPie?data.points[0].color:isLine?data.points[0].fullData.line.color:isArea?data.points[0].data.fillcolor:data.points[0].data.marker?data.points[0].data.marker.color:null;tSize=data&&data.points&&data.points[0].data&&data.points[0].data.marker?data.points[0].data.marker.size:null;tData=isPie?data.points[0].data.values:data.points[0].data.y;tData=tData.map(function(d,idx){return idx===dIndex&&!isSelectedItemClicked?cdata:false});if(isHeatmap){tData[dIndex]=!isSelectedItemClicked?cdata:false}t={traceIndex:tIndex,data:tData,color:tColor,isLine:isLine,isArea:isArea,isBoxplot:isBoxplot,isHeatmap:isHeatmap,size:tSize};traces[t.traceIndex]=t}var cdatalist=[];Object.keys(traces).forEach(function(key){t=traces[key];if(isHeatmap){cdatalist=cdatalist.concat(Object.keys(t.data).map(function(k){return t.data[k]}).filter(function(d){return!!d}))}else{cdatalist=cdatalist.concat(t.data.filter(function(d){return!!d}))}if(isBoxplot){}else if(isLine){Plotly.restyle(elem,{mode:"lines+markers",marker:{color:t.color,size:t.data.map(function(d){return d?10:0})}},t.traceIndex)}else if(isArea){Plotly.restyle(elem,{mode:"lines+markers",marker:{color:t.color,size:t.data.map(function(d){return d?10:0})}},t.traceIndex)}else if(isHeatmap){}else{v={marker:{line:{color:"#000000",width:t.data.map(function(d){return d?3:0})}}};if(t.color){v.marker.color=t.color}if(t.size){v.marker.size=t.size}if(isPie&&colors){v.marker.colors=colors}Plotly.restyle(elem,v,t.traceIndex)}});var _hash={};cdata.forEach(function(d){if(!_hash[d.name+d.value]){$row=$('<div class="balloon-body-table-row"></div>');$row.append('<div class="balloon-body-table-cell label-cell">'+d.name+"</div>");$row.append('<div class="balloon-body-table-cell value-cell">'+d.value+"</div>");$table.append($row);_hash[d.name+d.value]=true}});$balloon.css({position:"absolute",left:data.event.offsetX+"px",top:data.event.offsetY-Object.keys(_hash).length*20+"px"});$balloon.on("click",function(){$balloon.hide()});if(isSelectedItemClicked){$balloon.hide()}else{$balloon.show();$balloon.focus()}if(onKeepThisCallback){var $keepOnly=$('<div class="balloon-header-item"><i class="fal fa-check"/> '+VizUtil.getMessage(PlotlyGraphGenerator._lang,"Keep Only")+"</div>");$keepOnly.on("click",function(){onKeepThisCallback(cdatalist)});$hrow.append($keepOnly)}if(onExcludeCallback){var $exclude=$('<div class="balloon-header-item"><i class="fal fa-times"/> '+VizUtil.getMessage(PlotlyGraphGenerator._lang,"Exclude")+"</div>");$exclude.on("click",function(){onExcludeCallback(cdatalist)});$hrow.append($exclude)}if(onShowDetailCallback){var $showDetail=$('<div class="balloon-header-item"><i class="fal fa-table" style="padding-right:3px"/>'+VizUtil.getMessage(PlotlyGraphGenerator._lang,"Show Detail")+"</div>");$showDetail.on("click",function(){onShowDetailCallback(cdatalist)});$hrow.append($showDetail)}$hrow.append($('<div class="balloon-header-close-btn"><i class="fal fa-times"/></div>'));if(cdatalist.length>1){$head.append($('<div style="padding:0px 10px 3px"><b>'+cdatalist.length+"</b> "+VizUtil.getMessage(PlotlyGraphGenerator._lang,"items selected")+"</div>"))}}else{$balloon.hide()}}};var cancelHandler=function(){var $balloon=$("#viz-balloon");$balloon.hide();var t;Object.keys(traces).forEach(function(key){t=traces[key];if(t.isLine){Plotly.restyle(elem,{mode:"lines",marker:{color:t.color,size:0}},t.traceIndex)}else if(t.isArea){Plotly.restyle(elem,{mode:"none",marker:{size:0}},t.traceIndex)}else{Plotly.restyle(elem,{marker:{color:t.color,line:{width:0},size:t.size}},t.traceIndex)}});traces={}};elem.on("plotly_click",handler);elem.on("plotly_doubleclick",cancelHandler)};PlotlyGraphGenerator.getAxisRange=function(rangeString){if(!rangeString){return null}var arr=rangeString.split(",");if(arr.length!==2){return null}arr[0]=parseFloat(arr[0]);arr[1]=parseFloat(arr[1]);if(isNaN(arr[0]||isNaN(arr[1]))){return null}return arr};PlotlyGraphGenerator._lang="en";PlotlyGraphGenerator._generateDensityPlotViz=function(viz){viz=JSON.parse(JSON.stringify(viz));viz.x={func:"none",isDate:false,isNumeric:true,label:viz.x.label,name:viz.x.name,type:"numeric",validLabel:viz.x.validLabel};viz.y={func:"none",isDate:false,isNumeric:true,label:".density",name:"Density",type:"numeric",validLabel:".density"};return viz};PlotlyGraphGenerator._generateScatterMatrixViz=function(viz){if(!viz.scatterMatrixColumns){return viz}viz=JSON.parse(JSON.stringify(viz));var colnames=null;try{colnames=JSON.parse(viz.scatterMatrixColumns)}catch(e){colnames=viz.scatterMatrixColumns.split(",")}colnames=colnames.map(function(col){return col.name||col});colnames.sort(function(a,b){return a.localeCompare(b)});colnames.forEach(function(colname,idx){colname=colname.trim();var opId="y"+(idx===0?"":idx);viz[opId]={func:"none",isDate:false,isNumeric:true,label:"sm"+idx,name:colname,type:"numeric",validLabel:"sm"+idx}});return viz};PlotlyGraphGenerator.render=function(viz,data,targetElem,renderType,onLoadCallback,onErrorCallback,onShowDetailCallback,onKeepThisCallback,onExcludeCallback,onBeforeRenderingCallback,lang){if(lang){PlotlyGraphGenerator._lang=lang}try{PlotlyGraphGenerator._render(viz,data,targetElem,onShowDetailCallback,onKeepThisCallback,onExcludeCallback,onBeforeRenderingCallback)}catch(e){if(onErrorCallback&&typeof onErrorCallback==="function"){onErrorCallback(e,viz)}if(targetElem){VizUtil.renderNoData(targetElem,"Graph rendering failed.")}console.error(e)}finally{if(onLoadCallback&&typeof onLoadCallback==="function"){onLoadCallback()}}};PlotlyGraphGenerator._render=function(viz,data,targetElem,onShowDetailCallback,onKeepThisCallback,onExcludeCallback,onBeforeRenderingCallback){data=VizUtil.convertColumnarData(data);if(targetElem&&targetElem.childNodes.length>0){d3.select(targetElem.querySelector("svg")).remove();$(targetElem).empty()}if(targetElem&&(!data||data.length===0)){VizUtil.renderNoData(targetElem);return}if(viz.marker==="densityplot"){viz=PlotlyGraphGenerator._generateDensityPlotViz(viz)}else if(viz.marker==="scattermatrix"){viz=PlotlyGraphGenerator._generateScatterMatrixViz(viz)}var marker=viz.marker?viz.marker:null;var isHistogram=marker==="hist",isBoxplot=marker==="boxplot",isHeatmap=/^(heatmap|contour)$/.test(marker);var x=viz.x?viz.x.label:null,y=viz.y?viz.y.label:null,z=viz.z?viz.z.label:null,size=viz.size?viz.size.label:null,color=viz.color?viz.color.label:null,isColorContinuous=viz.color&&VizUtil.isContinuousValue(viz.color,marker,"color"),colorbucket=viz.colorbucket?viz.colorbucket.label:null,groupby=viz.groupby?viz.groupby.label:null,label=viz.label?viz.label.label:null,label2=viz.label2?viz.label2.label:null,label3=viz.label3?viz.label3.label:null,enableLabel2=!!viz.enableLabel2,facet=viz.facet?viz.facet.label:null,orderRow="..is.order.row",orientation=viz.orientation?viz.orientation:"vertical",barstyle=viz.barstyle?viz.barstyle:"stack",pieHole=!isNaN(viz.pieHole)?parseInt(viz.pieHole)/100:0,barPadding=viz.barPadding||(marker==="hist"?"0":null),opacity=viz.fillOpacity||VizUtil.getDefaultOpacity(viz)||null,sortTarget=viz.sortTarget?viz.sortTarget:"",sortOrder=viz.sortOrder?viz.sortOrder:"desc",labelOnPlot=viz.labelOnPlot?viz.labelOnPlot:"off",labelOnPlotHAlign=viz.labelOnPlotHAlign||"right",labelOnPlotVAlign=viz.labelOnPlotVAlign||"middle",errbarGraph=viz.errbarGraph||"bar",mapmode=viz.mapmode?viz.mapmode:"USA-states",marginLeft=viz.marginLeft,marginRight=viz.marginRight,marginTop=viz.marginTop,marginBottom=viz.marginBottom,title=viz.title,xAxisTitle=viz.xAxisTitle,xAxisPosition=viz.xAxisPosition||"bottom",yAxisTitle=viz.yAxisTitle,y2AxisTitle=viz.y2AxisTitle,zAxisTitle=viz.zAxisTitle,xAxisShowTitle=viz.xAxisShowTitle!=="off",yAxisShowTitle=viz.yAxisShowTitle!=="off",y2AxisShowTitle=viz.y2AxisShowTitle!=="off",zAxisShowTitle=viz.zAxisShowTitle!=="off",circleMaxSize=viz.circleMaxSize||VizUtil.DEFAULT_MAX_CIRCLE_DIAMETER[marker],circleMinSize=viz.circleMinSize||VizUtil.DEFAULT_MIN_CIRCLE_DIAMETER[marker],legendShowFuncName=viz.legendShowFuncName!=="off",legendShowAxisName=viz.legendShowAxisName!=="off",yValueOnPlot=viz.yValueOnPlot||"none",disableDecimalFormatting=!!viz.disableDecimalFormatting,numDecimalDigits=!viz.numDecimalDigits?null:parseInt(viz.numDecimalDigits),numDecimalDigitsForFilter=numDecimalDigits===null?2:numDecimalDigits,useThousandSeparator=viz.useThousandSeparator!=="off",userXAxisRange=PlotlyGraphGenerator.getAxisRange(viz.xAxisRange),userYAxisRange=PlotlyGraphGenerator.getAxisRange(viz.yAxisRange),userY2AxisRange=PlotlyGraphGenerator.getAxisRange(viz.y2AxisRange),userZAxisRange=PlotlyGraphGenerator.getAxisRange(viz.zAxisRange),formatXValue=null,formatY1Value=null,formatY2Value=null,formatZValue=null,i,l;if(isNaN(pieHole)){pieHole=0}var ys=VizUtil.getOptions(viz,"y");var isMultiY=ys.length>1;var numY=0;ys.forEach(function(_y){if(_y){numY++}});var colsOn2ndAxis=[];var allowMultiYAndColor=viz.allowMultiYAndColor==="on";if(isHistogram){y=VizUtil.FREQ_COL_LABEL;if(!color){opacity=viz.fillOpacity||null}}formatValue=VizUtil.valueFormatterGenerator(disableDecimalFormatting?null:numDecimalDigits||2,useThousandSeparator,!numDecimalDigits);formatXValue=!viz.xAxisNumDecimalDigits?formatValue:VizUtil.valueFormatterGenerator(viz.xAxisNumDecimalDigits,useThousandSeparator,false);formatY1Value=!viz.y1AxisNumDecimalDigits?formatValue:VizUtil.valueFormatterGenerator(viz.y1AxisNumDecimalDigits,useThousandSeparator,false);formatY2Value=!viz.y2AxisNumDecimalDigits?formatValue:VizUtil.valueFormatterGenerator(viz.y2AxisNumDecimalDigits,useThousandSeparator,false);formatZValue=!viz.zAxisNumDecimalDigits?formatValue:VizUtil.valueFormatterGenerator(viz.zAxisNumDecimalDigits,useThousandSeparator,false);if(isHeatmap){if(viz.x&&viz.y&&!viz.color){color='"count(*)"'}}else if(marker==="choropleth"&&!viz.color){color='"count(*)"'}else if(/^(bar|line|area)$/.test(marker)){if(viz.x&&!viz.y||viz.color&&!viz.y){y='"count(*)"'}}var nestData;var gData=[];var gRangeLayerData=[];var gTrendLineLayerData=[];var gTrendLineRangeLayerData=[];var gRefLineLayerData=[];var gRefLineUpperRangeLayerData=[];var gRefLineLowerRangeLayerData=[];var gVRefLineLayerData=[];var gVRefLineConfIntLayerData=[];var sortTargetCol=viz[sortTarget]?viz[sortTarget].label:"";var sortTargetGbysumCol=sortTargetCol?sortTargetCol+".gbysum":"";var direction=sortOrder==="desc"?1:-1;var valueSortFunc=function(a,b){if(a[sortTargetGbysumCol]!==undefined&&b[sortTargetGbysumCol]!==undefined){return(b[sortTargetGbysumCol]-a[sortTargetGbysumCol])*direction}else{return(b[sortTargetCol]-a[sortTargetCol])*direction}};if(colorbucket){VizUtil.formatColorBucketData(data,VizUtil.applyColorBucketAfterSummarize(marker)?colorbucket:color,formatValue)}var xDataRange=null;if(/^(scatter|line|bubble)$/.test(marker)&&viz.x&&VizUtil.returnsNumericValue(viz.x)&&viz.x.func!=="ascategory"){var _xval=[];var _ycol=null;ys.forEach(function(d){if(!!d&&!_ycol){_ycol=d}});data.forEach(function(d){if(!VizUtil.isEmpty(d[viz.x.label])&&!VizUtil.isEmpty(d[_ycol.label])){_xval.push(d[viz.x.label])}});xDataRange=d3.extent(_xval);var _rangeMargin=Math.abs(xDataRange[1]-xDataRange[0])*.1;xDataRange[0]-=_rangeMargin;xDataRange[1]+=_rangeMargin}var colorScale=null;var numberOfItemsInColor=-1;var useHighlightScale=viz.enableHighlight==="on"&&color&&!isColorContinuous;if(/^(heatmap|contour)$/.test(marker)){if(facet){nestData=d3.nest().key(function(d){return VizUtil.isEmpty(d[facet])?NA_LABEL:d[facet]}).key(function(d){return(VizUtil.isEmpty(d[y])?NA_LABEL:d[y])+(marker==="heatmap"?"\n":"")}).key(function(d){return(VizUtil.isEmpty(d[x])?NA_LABEL:d[x])+(marker==="heatmap"?"\n":"")}).entries(data);var orderedKeys=VizUtil.distinct(data.map(function(d){return VizUtil.isEmpty(d[facet])?NA_LABEL:d[facet]}));var hash={};nestData.forEach(function(d){hash[d.key]=d});var sorted=[];orderedKeys.forEach(function(d){if(hash[d]){sorted.push(hash[d])}});nestData=sorted}else{nestData=[{key:"",values:d3.nest().key(function(d){return(VizUtil.isEmpty(d[y])?NA_LABEL:d[y])+(marker==="heatmap"?"\n":"")}).key(function(d){return(VizUtil.isEmpty(d[x])?NA_LABEL:d[x])+(marker==="heatmap"?"\n":"")}).entries(data)}]}}else if(viz.color){var colorcol=color;if(colorbucket&&VizUtil.applyColorBucketAfterSummarize(marker)){colorcol=colorbucket}nestData=PlotlyGraphGenerator._flattenData(data,colorcol);if(viz.y){nestData.forEach(function(d){d.winfunc=viz.yWindowFunc})}if(isMultiY&&allowMultiYAndColor){ys.forEach(function(_y,_idx){if(_y&&_idx>0){var winfunc=viz["y"+(_idx===0?"":_idx)+"WindowFunc"];var funcLabel=!winfunc||winfunc==="none"?null:VizUtil.WINDOW_FUNCTION_OPTIONS_HASH[winfunc];if(!funcLabel){funcLabel=VizUtil.AGGREGATION_FUNCTION_OPTIONS_HASH[_y.func]}var yOp="y"+(_idx===0?"":_idx);nestData.unshift({key:_y.type===VizUtil.TYPE_NUMROWS?VizUtil.NUMROWS_COL_LABEL:_y.name+(funcLabel&&legendShowFuncName?" ("+funcLabel+")":""),ycolname:_y.label,winfunc:winfunc,yOp:yOp,values:data.filter(function(d){return!(d[".resp"]&&d[".resp"]!==_y.label)})})}})}colorScale=nestData.length<=10?d3.scale.category10():d3.scale.category20();numberOfItemsInColor=nestData.length;if(viz&&viz.reverseColorPaletteOrder==="on"){var colors=colorScale.range().slice();colors.reverse();colorScale=d3.scale.ordinal().range(colors)}nestData=PlotlyGraphGenerator._flattenDataByFacet(viz,nestData)}else{if(isMultiY){nestData=[];ys.forEach(function(_y,_idx){if(_y){var yOp="y"+(_idx===0?"":_idx);var winfunc=viz[yOp+"WindowFunc"];var funcLabel=!winfunc||winfunc==="none"?null:VizUtil.WINDOW_FUNCTION_OPTIONS_HASH[winfunc];if(!funcLabel){funcLabel=VizUtil.AGGREGATION_FUNCTION_OPTIONS_HASH[_y.func]}var use2ndAxis=viz[yOp+"Use2ndAxis"]==="on"&&VizUtil.isDualYSupported(marker,viz.barstyle);if(use2ndAxis){colsOn2ndAxis.push(_y)}nestData.push({key:_y.type===VizUtil.TYPE_NUMROWS?VizUtil.NUMROWS_COL_LABEL:_y.name+(funcLabel&&legendShowFuncName?" ("+funcLabel+")":""),ycolname:_y.label,winfunc:winfunc,use2ndAxis:use2ndAxis,yOp:yOp,values:data.filter(function(d){return!(d[".resp"]&&d[".resp"]!==_y.label)})})}});if(allowMultiYAndColor){nestData.reverse()}if(legendShowAxisName&&colsOn2ndAxis&&colsOn2ndAxis.length>0){nestData.forEach(function(d){d.key+=" ("+(d.use2ndAxis?"y2":"y1")+")"})}}else{nestData=[{key:y,winfunc:viz.yWindowFunc,values:data}]}colorScale=nestData.length<10?d3.scale.category10():d3.scale.category20();numberOfItemsInColor=nestData.length;nestData=PlotlyGraphGenerator._flattenDataByFacet(viz,nestData)}var xValuePrefix="",y1ValuePrefix="",y2ValuePrefix="",zValuePrefix="",xValueSuffix="",y1ValueSuffix="",y2ValueSuffix="",zValueSuffix="",sizeValuePrefix="",sizeValueSuffix="",label1ValuePrefix="",label1ValueSuffix="",label2ValuePrefix="",label2ValueSuffix="",label3ValuePrefix="",label3ValueSuffix="",colorValuePrefix="",colorValueSuffix="";if(viz.x){xValuePrefix=VizUtil.getValuePrefix(viz.xAxisNumberFormatting,viz.xAxisCurrencySymbol,viz.marker);xValueSuffix=VizUtil.getValueSuffix(null,viz.x.func,viz.xAxisNumberFormatting,viz.marker)}if(viz.y){y1ValuePrefix=VizUtil.getValuePrefix(viz.yAxisNumberFormatting,viz.yAxisCurrencySymbol,viz.marker);y1ValueSuffix=VizUtil.getValueSuffix(viz.yWindowFunc,viz.y.func,viz.yAxisNumberFormatting,viz.marker)}y2ValuePrefix=VizUtil.getValuePrefix(viz.y2AxisNumberFormatting,viz.y2AxisCurrencySymbol,viz.marker);if(colsOn2ndAxis&&colsOn2ndAxis.length>0){ys.forEach(function(y,idx){if(y2ValueSuffix){return}if(viz["y"+idx+"Use2ndAxis"]&&y){y2ValueSuffix=VizUtil.getValueSuffix(viz["y"+idx+"WindowFunc"],y.func,viz.y2AxisNumberFormatting,viz.marker)}})}if(viz.z){zValuePrefix=VizUtil.getValuePrefix(viz.zAxisNumberFormatting,viz.zAxisCurrencySymbol,viz.marker);zValueSuffix=VizUtil.getValueSuffix(null,null,viz.zAxisNumberFormatting,viz.marker)}if(viz.color){colorValuePrefix=VizUtil.getValuePrefix(viz.colorNumberFormatting,viz.colorCurrencySymbol,viz.marker);colorValueSuffix=VizUtil.getValueSuffix(viz.colorWindowFunc,viz.color.func,viz.colorNumberFormatting,viz.marker)}if(viz.size){sizeValuePrefix=VizUtil.getValuePrefix(viz.sizeNumberFormatting,viz.sizeCurrencySymbol,viz.marker);sizeValueSuffix=VizUtil.getValueSuffix(viz.sizeWindowFunc,viz.size.func,viz.sizeNumberFormatting,viz.marker)}if(viz.label){label1ValuePrefix=VizUtil.getValuePrefix(viz.label1NumberFormatting,viz.label1CurrencySymbol,viz.marker);label1ValueSuffix=VizUtil.getValueSuffix(viz.label1WindowFunc,viz.label.func,viz.label1NumberFormatting,viz.marker)}if(viz.label2){label2ValuePrefix=VizUtil.getValuePrefix(viz.label2NumberFormatting,viz.label2CurrencySymbol,viz.marker);label2ValueSuffix=VizUtil.getValueSuffix(viz.label2WindowFunc,viz.label2.func,viz.label2NumberFormatting,viz.marker)}if(viz.label3){label3ValuePrefix=VizUtil.getValuePrefix(viz.label3NumberFormatting,viz.label3CurrencySymbol,viz.marker);label3ValueSuffix=VizUtil.getValueSuffix(viz.label3WindowFunc,viz.label3.func,viz.label3NumberFormatting,viz.marker)}xValuePrefix=viz.xAxisValuePrefix||xValuePrefix;xValueSuffix=viz.xAxisValueSuffix||xValueSuffix;y1ValuePrefix=viz.y1AxisValuePrefix||y1ValuePrefix;y1ValueSuffix=viz.y1AxisValueSuffix||y1ValueSuffix;y2ValuePrefix=viz.y2AxisValuePrefix||y2ValuePrefix;y2ValueSuffix=viz.y2AxisValueSuffix||y2ValueSuffix;colorValuePrefix=viz.colorAxisValuePrefix||colorValuePrefix;colorValueSuffix=viz.colorAxisValueSuffix||colorValueSuffix;sizeValuePrefix=viz.sizeAxisValuePrefix||sizeValuePrefix;sizeValueSuffix=viz.sizeAxisValueSuffix||sizeValueSuffix;label1ValuePrefix=viz.label1AxisValuePrefix||label1ValuePrefix;label1ValueSuffix=viz.label1AxisValueSuffix||label1ValueSuffix;label2ValuePrefix=viz.label2AxisValuePrefix||label2ValuePrefix;label2ValueSuffix=viz.label2AxisValueSuffix||label2ValueSuffix;label3ValuePrefix=viz.label3AxisValuePrefix||label3ValuePrefix;label3ValueSuffix=viz.label3AxisValueSuffix||label3ValueSuffix;var formatTrendLineValueHash={};var formatRefLineValueHash={};var formatVRefLineValueHash={};ys.forEach(function(y,idx){var yOp="y"+(idx===0?"":idx);var use2ndAxis=viz[yOp+"Use2ndAxis"]==="on"&&VizUtil.isDualYSupported(marker,viz.barstyle);formatTrendLineValueHash[yOp]=VizUtil.valueFormatterGenerator(viz[yOp+"TrendLineNumDecimalDigits"]||null,useThousandSeparator,false);formatRefLineValueHash[yOp]={formatter:!viz[yOp+"RefLineNumDecimalDigits"]?use2ndAxis?formatY2Value:formatY1Value:VizUtil.valueFormatterGenerator(viz[yOp+"RefLineNumDecimalDigits"],useThousandSeparator,false),prefix:use2ndAxis?y2ValuePrefix:y1ValuePrefix,suffix:use2ndAxis?y2ValueSuffix:y1ValueSuffix}});formatVRefLineValueHash.x={formatter:!viz["xRefLineNumDecimalDigits"]?formatXValue:VizUtil.valueFormatterGenerator(viz["xRefLineNumDecimalDigits"],useThousandSeparator,false),prefix:xValuePrefix,suffix:xValueSuffix};var reverseColorPaletteOrderOp=viz.reverseColorPaletteOrder||viz.reverseColorPalleteOrder||"off";var colorarr,categColorPalette=viz.categColorPalette||viz.colorPallete10,customCategColorPaletteOp=viz.customCategColorPalette||viz.customColorPallete10;if(customCategColorPaletteOp&&customCategColorPaletteOp.length>0&&categColorPalette==="custom"){colorarr=customCategColorPaletteOp.match(VizUtil.COLOR_PALETTE_REGEX).slice();for(i=0;i<colorarr.length;i++){if(VizUtil.hexToRgb(colorarr[i])===null){colorarr[i]="#CCCCCC"}}if(reverseColorPaletteOrderOp==="on"){colorarr.reverse()}colorScale=d3.scale.ordinal().range(colorarr)}else if(categColorPalette&&categColorPalette!=="default"&&VizUtil.CATEG_COLOR_PALETTES_HASH[categColorPalette]){var ncolors=numberOfItemsInColor?Math.min(numberOfItemsInColor,10):-1;if(numberOfItemsInColor>0&&VizUtil.colorbrewer[categColorPalette]&&VizUtil.colorbrewer[categColorPalette][ncolors]){colorarr=VizUtil.colorbrewer[categColorPalette][ncolors].slice()}else{colorarr=VizUtil.CATEG_COLOR_PALETTES_HASH[categColorPalette].color.slice()}if(reverseColorPaletteOrderOp==="on"){colorarr.reverse()}colorScale=d3.scale.ordinal().range(colorarr)}if(useHighlightScale){colorScale=VizUtil.generateHighlightColorScale(viz.highlightDefaultColor||"#DCDEE0",viz.highlightValues||[])}var quantColorPaletteOp=viz.quantColorPalette||viz.colorPallete||(/^(heatmap|contour)$/.test(marker)?"RdBu":VizUtil.getDefaultColorPalette(VizUtil.getBucketType("color",viz))||"Blues");if(!VizUtil.QUANT_COLOR_PALETTES_HASH[quantColorPaletteOp]){quantColorPaletteOp=/^(heatmap|contour)$/.test(marker)?"RdBu":"Blues"}var reverseColorPaletteOrderOp=viz.reverseColorPaletteOrder||viz.reverseColorPalleteOrder||"off";var quantColorPalette=VizUtil.QUANT_COLOR_PALETTES_HASH[quantColorPaletteOp].color.slice();if(!/^(heatmap|contour)$/.test(marker)){var bucketType=VizUtil.getBucketType("color",viz);if(/^(bucket_kmeans|bucket_equal_width|bucket_equal_freq|bucket_custom)$/.test(bucketType)){var numBuckets=bucketType==="bucket_kmeans"?viz.colorBucketKmeansNumOfBuckets:viz.colorBucketNumOfBuckets;if(bucketType==="bucket_custom"){var customBucketAttrs=VizUtil.constructCustomBucketAttributes(viz.colorBucketCuttingPoints,viz.colorBucketLabels,viz.colorBucketIncludeOutsideRange!=="off",viz.colorBucketIncludeRightEdge!=="off",viz.colorBucketIncludeLowest!=="off",10);numBuckets=customBucketAttrs.expectedNumberOfLabels}if(numBuckets&&VizUtil.colorbrewer[quantColorPaletteOp]&&VizUtil.colorbrewer[quantColorPaletteOp][numBuckets]){quantColorPalette=VizUtil.colorbrewer[quantColorPaletteOp][numBuckets].slice()}}}if(reverseColorPaletteOrderOp==="on"){quantColorPalette.reverse()}if(colorbucket){colorScale=d3.scale.ordinal().range(quantColorPalette)}var _text;var _data;if(isBoxplot){nestData.forEach(function(d){var datum={x:[],y:[],text:[],customdata:[],marker:{}};if(opacity){datum.opacity=opacity}
if(facet){datum.facet=d.facet}d.values.forEach(function(v){_data=[];var xval=x?v[x]:d.key;datum.x=datum.x.concat(xval,xval,xval,xval,xval,xval,xval);if(x){_data.push({type:"x",name:viz.x.name,validName:viz.x.validName,rawValue:xval,value:xval,func:viz.x.func,datatype:viz.x.type,filter:true})}if(color){datum.name=v[color];if(facet){datum.offsetgroup=v[color]}if(VizUtil.isEmpty(datum.name)){datum.name=NA_LABEL}datum.marker.color=colorScale(v[color]);_data.push({type:"color",name:viz.color.name,validName:viz.color.validName,rawValue:v[color],value:v[color],func:viz.color.func,datatype:viz.color.type,filter:true})}if(facet){_data.push({type:"facet",name:viz.facet.name,validName:viz.facet.validName,rawValue:v[facet],value:v[facet],func:viz.facet.func,datatype:viz.facet.type,filter:true})}datum.y=datum.y.concat([v[1],v[2],v[2],v[3],v[4],v[4],v[5]]);_data.push({type:"y",name:viz.y.name,validName:viz.y.validName,rawValue:[v[1],v[2],v[3],v[4],v[5]],value:["Min: "+v[1],"1Q: "+v[2],"Median: "+v[3],"3Q: "+v[4],"Max: "+v[5]].join(", "),func:viz.y.func,datatype:viz.y.type,filter:false});datum.customdata.push(_data)});if(!datum.marker.color){datum.marker.color=colorScale("a")}gData.push(datum)})}else if(/^(scattermatrix)$/.test(marker)){var datum={type:"splom",dimensions:[],text:[],customdata:[],hovermode:"text",hoverlabel:{bgcolor:[]},marker:{size:circleMinSize,color:[]}};if(opacity){datum.marker.opacity=opacity}if(color){datum.marker.color=[]}ys.forEach(function(y){if(y){datum.dimensions.push({label:y.name,values:[],_validLabel:y.validLabel})}});var htext,_range,_colorRange,_scaleFunc,_colorScale=[];if(color){_range=colorScale.range();_colorRange=_range.map(function(x,idx){return idx*.01});_scaleFunc=d3.scale.ordinal().range(_colorRange);_range.forEach(function(x,idx){_colorScale.push([idx*.01,x]);_colorScale.push([(idx+1)*.01,x])});var _lastItem=_colorScale[_colorScale.length-1];_colorScale.push([_lastItem[0],_lastItem[1]]);_colorScale.push([1,_lastItem[1]])}else{_range=colorScale.range();_colorScale=[[0,_range[0]],[1,_range[0]]]}datum.marker.colorscale=_colorScale;data[data.length-1].forEach(function(x){htext=[];if(color){datum.marker.color.push(_scaleFunc(x[viz.color.validLabel]));htext.push(viz.color.name+": "+formatValue(x[viz.color.validLabel]));datum.hoverlabel.bgcolor.push(colorScale(x[viz.color.validLabel]))}else{datum.marker.color.push(0);datum.hoverlabel.bgcolor.push(colorScale("a"))}datum.dimensions.forEach(function(d){d.values.push(x[d._validLabel]);htext.push(d.label+": "+formatValue(x[d._validLabel]))});datum.text.push(htext.join("<br>"))});datum.marker.color.push(1);if(viz.facetShowDiagonalPlots!=="on"){datum.diagonal={visible:false}}if(viz.facetShowLowerHalfPlots==="off"){datum.showlowerhalf=false}if(viz.facetShowUpperHalfPlots==="off"){datum.showupperhalf=false}gData.push(datum)}else if(/^(heatmap|contour)$/.test(marker)){if(!color){if(targetElem){VizUtil.renderNoData(targetElem,"Color is not assigned.")}else{console.log("Color column is not defined in heatmap. Exiting.")}return}nestData.forEach(function(item){var groupData=item.values;var group={x:[],y:[],z:[],text:[],customdata:[],marker:{}};if(opacity){group.opacity=opacity}if(facet){group.facet=item.key}group.x=groupData[0].values.map(function(d){return d.key});group.y=groupData.map(function(d){return d.key});group.z=groupData.map(function(d){return d.values.map(function(d2){return d2.values[0][color]})});group.text=groupData.map(function(datax){return datax.values.map(function(datay){_text=[];_text.push(viz.x.name+": "+formatValue(datay.values[0][x]));if(viz.y){_text.push(viz.y.name+": "+formatValue(datay.values[0][y]))}_text.push((viz.color&&viz.color.type===VizUtil.TYPE_NUMROWS?VizUtil.NUMROWS_COL_LABEL:viz.color.name)+": "+(VizUtil.isEmpty(datay.values[0][color])?NA_LABEL:formatValue(datay.values[0][color])));return _text.join("<br>")})});group.customdata=groupData.map(function(datax){return datax.values.map(function(datay){_data=[];_data.push({type:"x",name:viz.x.name,validName:viz.x.validName,rawValue:datay.values[0][x],value:formatValue(datay.values[0][x]),func:viz.x.func,datatype:viz.x.type,filter:true});if(viz.y){_data.push({type:"y",name:viz.y.name,validName:viz.y.validName,rawValue:datay.values[0][y],value:formatValue(datay.values[0][y]),func:viz.y.func,datatype:viz.y.type,filter:true})}_data.push({type:"color",name:viz.color&&viz.color.type===VizUtil.TYPE_NUMROWS?VizUtil.NUMROWS_COL_LABEL:viz.color.name,validName:viz.color&&viz.color.type===VizUtil.TYPE_NUMROWS?VizUtil.NUMROWS_COL_NAME:viz.color.validName,rawValue:VizUtil.isEmpty(datay.values[0][color])?NA_LABEL:datay.values[0][color],value:VizUtil.isEmpty(datay.values[0][color])?NA_LABEL:formatValue(datay.values[0][color]),func:viz.color.func,datatype:viz.color.type,filter:false});if(viz.facet){_data.push({type:"facet",name:viz.facet.name,validName:viz.facet.validName,rawValue:datay.values[0][facet],value:formatValue(datay.values[0][facet]),func:viz.facet.func,datatype:viz.facet.type,filter:true})}return _data})});if(!group.y||group.y[0]==="undefined"){group.y=[" "]}group.colorscale=[[0,quantColorPalette[0]],[.25,quantColorPalette[1]],[.5,quantColorPalette[2]],[.75,quantColorPalette[3]],[1,quantColorPalette[4]]];gData.push(group)})}else{var FITTED_COLUMN="predicted_value";var CONF_HIGH_COLUMN="conf_high";var CONF_LOW_COLUMN="conf_low";var REFLINE_COLUMN="refline";var REFLINE_RANGE_COLUMN="refrange";var _color=color;var rangeLegendgroup=1;var trendLineLegendgroup=1;var trendLineRangeLegendgroup=1;var reflineHash={};var vreflineHash={};nestData.forEach(function(d){var group={name:d.key,marker:{line:{width:0}},line:{},customdata:[]};if(color&&facet&&marker==="violin"){group.offsetgroup=group.name}if(d.yOp){group.yOp=d.yOp}var range={x:[],hi:[],low:[]};var trendLineRange={x:[],hi:[],low:[]};var trendLineGroup={x:[],y:[],text:[],hoverinfo:"text",mode:"lines",showlegend:false};if(!color&&y&&!isMultiY){if(marker==="bubble"){group.name=viz.groupby?viz.groupby.type===VizUtil.TYPE_ROWID?VizUtil.ROWID_COL_LABEL:viz.groupby.name:viz.y?viz.y.name:""}else if(marker==="hist"){group.name=viz.x?viz.x.name:""}else{group.name=viz.y.type===VizUtil.TYPE_NUMROWS?VizUtil.NUMROWS_COL_LABEL:viz.y.name}}if(group.name==="null"){group.name=NA_LABEL}if(facet){group.facet=d.facet}if(/^(bar|errbar)$/.test(marker)&&viz.x&&!VizUtil.returnsNumericValue(viz.x)&&!VizUtil.returnsDateValue(viz.x)&&sortTarget&&sortTargetCol&&(!viz._desktopVersion||VizUtil.compareVersionStr(viz._desktopVersion,"5.3.2.1")<0)){d.values.sort(valueSortFunc)}var yop=d.yOp||"y",xop="x";var reflineEnabled=!!viz[yop+"ReflineType"]&&viz[yop+"ReflineType"]!=="none"&&/^(bar|line|scatter|bubble)$/.test(marker);var reflineRangeEnabled=!!viz[yop+"ReflineRangeType"]&&viz[yop+"ReflineRangeType"]!=="none"&&/^(bar|line|scatter|bubble)$/.test(marker);var vReflineEnabled=!!viz[xop+"ReflineType"]&&viz[xop+"ReflineType"]!=="none"&&/^(line|scatter|bubble|hist|densityplot)$/.test(marker);trendLineGroup.line={width:viz[yop+"TrendLineWidth"]||1,dash:viz[yop+"TrendLineType"]||"dot"};if(/^(scatter|line|bar)$/.test(marker)&&viz[yop+"MarkerShape"]){var markerSize=viz[yop+"MarkerSize"];var markerStyle=viz[yop+"MarkerLineStyle"];var markerOpacity=viz[yop+"FillOpacity"];switch(viz[yop+"MarkerShape"]){case"circle":group.type="scatter";group.mode="markers";if(/^(bar|line)$/.test(marker)&&markerSize){group.marker.size=markerSize}if(allowMultiYAndColor&&viz.multiYAndColorOpacity){group.marker.opacity=parseFloat(viz.multiYAndColorOpacity)}if(!VizUtil.isEmpty(markerOpacity)){group.marker.opacity=parseFloat(markerOpacity)}break;case"bar":group.type="bar";group.mode=null;if(!VizUtil.isEmpty(markerOpacity)){group.opacity=parseFloat(markerOpacity)}break;case"line":group.type="scatter";group.mode="lines";if(markerSize){group.line.width=markerSize}if(markerStyle){group.line.dash=markerStyle}group.opacity=opacity;if(!VizUtil.isEmpty(markerOpacity)){group.opacity=parseFloat(markerOpacity)}break;case"line+circle":var markerCircleSize=viz[yop+"MarkerCircleSize"];group.type="scatter";group.mode="lines+markers";if(/^(bar|line)$/.test(marker)&&markerCircleSize){group.marker.size=markerCircleSize}if(markerSize){group.line.width=markerSize}if(markerStyle){group.line.dash=markerStyle}group.opacity=opacity;if(!VizUtil.isEmpty(markerOpacity)){group.opacity=parseFloat(markerOpacity)}break;case"default":if(marker==="line"){if(markerSize){group.line.width=markerSize}if(markerStyle){group.line.dash=markerStyle}group.opacity=opacity;if(!VizUtil.isEmpty(markerOpacity)){group.opacity=parseFloat(markerOpacity)}}else{if(!VizUtil.isEmpty(markerOpacity)){group.marker.opacity=parseFloat(markerOpacity)}}break}}if(marker==="line"&&!viz[yop+"MarkerShape"]&&viz[yop+"MarkerSize"]){group.line.width=viz[yop+"MarkerSize"]}if(marker==="bubble"){group.type="scatter";group.mode="markers"}if(d.use2ndAxis){group.use2ndAxis=d.use2ndAxis;group.yaxis="y2"}var histRange=null;if(marker==="hist"&&d.values&&d.values.length>1){histRange=Math.abs(d.values[d.values.length-1][x]-d.values[d.values.length-2][x])/2}var _y=isMultiY?d.ycolname:y;var _xDateParser=null,_xDateFormatter=null,xHoverFormatter=null;if(viz.x&&VizUtil.returnsDateValue(viz.x)&&viz.xHoverFormat){_xDateParser=d3.time.format("%Y-%m-%d").parse;_xDateFormatter=d3.time.format(viz.xHoverFormat);xHoverFormatter=function(datestr){if(!datestr){return null}return _xDateFormatter(_xDateParser(datestr))}}d.values.forEach(function(v){_text=new VizUtil.BalloonItemList;_data=new VizUtil.BalloonItemList;if(marker==="scatter"&&allowMultiYAndColor){if(VizUtil.isUndefined(v[_y])&&!VizUtil.isUndefined(v[y])){_y=y}}if(marker!=="scatter"||!VizUtil.isUndefined(v[x])&&!VizUtil.isUndefined(v[_y])){if(groupby){_text.add((viz.groupby.balloonDisplayName||(viz.groupby.type===VizUtil.TYPE_ROWID?VizUtil.ROWID_COL_LABEL:viz.groupby.name))+": "+formatValue(v[groupby]),marker,"groupby",false);_data.add({type:"groupby",name:viz.groupby.balloonDisplayName||(viz.groupby.type===VizUtil.TYPE_ROWID?VizUtil.ROWID_COL_LABEL:viz.groupby.name),validName:viz.groupby.type===VizUtil.TYPE_ROWID?VizUtil.ROWID_COL_NAME:viz.groupby.validName,rawValue:v[groupby],value:formatValue(v[groupby]),func:viz.groupby.func,datatype:viz.groupby.type,filter:viz.groupby.type!==VizUtil.TYPE_ROWID},marker,"groupby",false,viz.groupby.balloonPosition,viz.groupby.balloonPositionIndex)}if(facet){_data.add({type:"facet",name:viz.facet.balloonDisplayName||viz.facet.name,validName:viz.facet.validName,rawValue:v[facet],value:formatValue(v[facet]),func:viz.facet.func,datatype:viz.facet.type,filter:true},marker,"facet",false,viz.facet.balloonPosition,viz.facet.balloonPositionIndex)}if(color){_text.add((viz.color.balloonDisplayName||(viz.color.type===VizUtil.TYPE_NUMROWS?VizUtil.NUMROWS_COL_LABEL:viz.color.name))+": "+(marker==="scatter"&&VizUtil.isEmpty(v[color])?NA_LABEL:colorValuePrefix+formatValue(v[color])+colorValueSuffix),marker,"color",VizUtil.returnsNumericValue(viz.color)&&viz.color.func!=="ascategory",viz.color.balloonPosition,viz.color.balloonPositionIndex);_data.add({type:"color",name:viz.color.balloonDisplayName||(viz.color.type===VizUtil.TYPE_NUMROWS?VizUtil.NUMROWS_COL_LABEL:viz.color.name),validName:viz.color&&viz.color.type===VizUtil.TYPE_NUMROWS?VizUtil.NUMROWS_COL_NAME:viz.color.validName,rawValue:marker==="scatter"&&VizUtil.isEmpty(v[color])?NA_LABEL:v[color],value:marker==="scatter"&&VizUtil.isEmpty(v[color])?NA_LABEL:colorValuePrefix+formatValue(v[color])+colorValueSuffix,func:viz.color.func,datatype:viz.color.type,filter:!(/^(scatter|bubble)$/.test(marker)&&VizUtil.returnsNumericValue(viz.color))},marker,"color",VizUtil.returnsNumericValue(viz.color)&&viz.color.func!=="ascategory",viz.color.balloonPosition,viz.color.balloonPositionIndex)}if(size){if(!group.marker.size)group.marker.size=[];group.marker.size.push(v[size]);_text.add((viz.size.balloonDisplayName||(viz.size&&viz.size.type===VizUtil.TYPE_NUMROWS?VizUtil.NUMROWS_COL_LABEL:viz.size.name))+": "+sizeValuePrefix+formatValue(v[size])+sizeValueSuffix,marker,"size",true,viz.size.balloonPosition,viz.size.balloonPositionIndex);_data.add({type:"size",name:viz.size.balloonDisplayName||(viz.size&&viz.size.type===VizUtil.TYPE_NUMROWS?VizUtil.NUMROWS_COL_LABEL:viz.size.name),validName:viz.size&&viz.size.type===VizUtil.TYPE_NUMROWS?VizUtil.NUMROWS_COL_NAME:viz.size.validName,rawValue:v[size],value:sizeValuePrefix+formatValue(v[size])+sizeValueSuffix,func:viz.size.func,datatype:viz.size.type,filter:false},marker,"size",true,viz.size.balloonPosition,viz.size.balloonPositionIndex)}else if(/^(scatter)$/.test(marker)){if(v.hasOwnProperty("..size")){if(!group.marker.size)group.marker.size=[];group.marker.size.push(!!v["..size"]?1:null)}}else if(marker==="bubble"){if(v.hasOwnProperty("..is.order.row")){if(!group.marker.size)group.marker.size=[];group.marker.size.push(v["..is.order.row"]==="TRUE"?null:1)}}if(label){if(!group._label)group._label=[];group._label.push(v[label]);if(!viz.hideLabel&&!allowMultiYAndColor&&viz.xAxisDataTypeDetection!=="on"){_text.add((viz.label.balloonDisplayName||viz.label.name)+": "+label1ValuePrefix+formatValue(v[label])+label1ValueSuffix,marker,"label",false,viz.label.balloonPosition,viz.label.balloonPositionIndex);_data.add({type:"x",name:viz.label.balloonDisplayName||viz.label.name,validName:viz.label.validName,rawValue:v[label],value:label1ValuePrefix+formatValue(v[label])+label1ValueSuffix,func:viz.label.func,datatype:viz.label.type,filter:false},marker,"label",false,viz.label.balloonPosition,viz.label.balloonPositionIndex)}}if(label2&&(allowMultiYAndColor||enableLabel2)){if(!(viz.hideLabel2||viz.hideEmptyLabel2&&VizUtil.isEmpty(v[label2]))){_text.add((viz.label2.balloonDisplayName||viz.label2.name)+": "+label2ValuePrefix+formatValue(v[label2])+label2ValueSuffix,marker,"label2",false,viz.label2.balloonPosition,viz.label2.balloonPositionIndex);_data.add({type:"x",name:viz.label2.balloonDisplayName||viz.label2.name,validName:viz.label2.validName,rawValue:v[label2],value:label2ValuePrefix+formatValue(v[label2])+label2ValueSuffix,func:viz.label2.func,datatype:viz.label2.type,filter:false},marker,"label2",false,viz.label2.balloonPosition,viz.label2.balloonPositionIndex)}}if(label3){_text.add((viz.label3.balloonDisplayName||viz.label3.name)+": "+label3ValuePrefix+formatValue(v[label3])+label3ValueSuffix,marker,"label3",false,viz.label3.balloonPosition,viz.label3.balloonPositionIndex);_data.add({type:"x",name:viz.label3.balloonDisplayName||viz.label3.name,validName:viz.label3.validName,rawValue:v[label3],value:label3ValuePrefix+formatValue(v[label3])+label3ValueSuffix,func:viz.label3.func,datatype:viz.label3.type,filter:false},marker,"label3",false,viz.label3.balloonPosition,viz.label3.balloonPositionIndex)}if(x){if(!group.x)group.x=[];group.x.push(v[x]);if(histRange){_text.add((viz.x.balloonDisplayName||viz.x.name)+": "+formatValue(v[x]-histRange)+" - "+formatValue(v[x]+histRange),marker,"x",true,viz.x.balloonPosition);_data.add({type:"x",name:viz.x.balloonDisplayName||viz.x.name,validName:viz.x.validName,rawValue:v[x],value:formatValue(v[x]-histRange)+" - "+formatValue(v[x]+histRange),func:viz.x.func,datatype:viz.x.type,filter:true,histRange:histRange},marker,"x",true,viz.x.balloonPosition,viz.x.balloonPositionIndex)}else{var _val=!xHoverFormatter?xValuePrefix+formatXValue(v[x])+xValueSuffix:xHoverFormatter(v[x]);_text.add((viz.x.balloonDisplayName||(viz.x.type===VizUtil.TYPE_NUMROWS?VizUtil.NUMROWS_COL_LABEL:viz.x.name))+": "+_val,marker,"x",VizUtil.returnsNumericValue(viz.x)&&viz.x.func!=="ascategory",viz.x.balloonPosition,viz.x.balloonPositionIndex);_data.add({type:"x",name:viz.x.balloonDisplayName||(viz.x.type===VizUtil.TYPE_NUMROWS?VizUtil.NUMROWS_COL_LABEL:viz.x.name),validName:viz.x&&viz.x.type===VizUtil.TYPE_NUMROWS?VizUtil.NUMROWS_COL_NAME:viz.x.validName,rawValue:v[x],value:_val,func:marker==="scatter"&&viz.x.isNumeric?"round":viz.x.func,datatype:viz.x.type,filter:!(marker==="bubble"&&VizUtil.returnsNumericValue(viz.x)&&viz.x.func!=="ascategory"),numDecimalDigits:numDecimalDigitsForFilter},marker,"x",VizUtil.returnsNumericValue(viz.x)&&viz.x.func!=="ascategory",viz.x.balloonPosition,viz.x.balloonPositionIndex)}}if(_y){if(!group.y)group.y=[];if(!group.ygbysum)group.ygbysum=[];var ycol="y";var errLow=viz.yErrLow||viz.errLow;var errHigh=viz.yErrHigh||viz.errHigh;var errHighLowEnabled=viz.yErrHighLowEnabled||viz.errHighLowEnabled;var errBarWidth=viz.yErrBarWidth||viz.errBarWidth;if(isMultiY){if(!viz.color)_color=d.ycolname;ycol=d.yOp;errLow=viz[d.yOp+"ErrLow"];errHigh=viz[d.yOp+"ErrHigh"];errHighLowEnabled=viz[d.yOp+"ErrHighLowEnabled"];errBarWidth=viz[d.yOp+"ErrBarWidth"]}group.y.push(v[_y]);if(!VizUtil.isUndefined(v[_y+".gbysum"])){group.ygbysum.push(v[_y+".gbysum"])}if(!VizUtil.isUndefined(v[_y])){var winfunc=/(^ptotal$|^pof)/.test(d.winfunc)?" ("+VizUtil.WINDOW_FUNCTION_OPTIONS_HASH[d.winfunc]+")":"";var prefix=d.use2ndAxis?y2ValuePrefix:y1ValuePrefix;var suffix=d.use2ndAxis?y2ValueSuffix:y1ValueSuffix;var formatfunc=d.use2ndAxis?formatY2Value:formatY1Value;if(isMultiY){var _dispname=null,_coldef=null;if(!ycol){_coldef=viz.y;_dispname=_coldef.balloonDisplayName||(_coldef.type===VizUtil.TYPE_NUMROWS?VizUtil.NUMROWS_COL_LABEL:_coldef.name)}else{_coldef=viz[ycol];_dispname=_coldef.balloonDisplayName||group.name}_text.add(_dispname+winfunc+": "+prefix+formatfunc(v[_y])+suffix,marker,"y",VizUtil.returnsNumericValue(_coldef)&&_coldef.func!=="ascategory",_coldef.balloonPosition,_coldef.balloonPositionIndex);_data.add({type:"y",name:_dispname+winfunc,validName:_coldef.validName,rawValue:v[_y],value:prefix+formatfunc(v[_y])+suffix,func:marker==="scatter"&&_coldef.isNumeric?"round":_coldef.func,datatype:null,filter:marker==="scatter"||marker==="bubble"&&!(VizUtil.returnsNumericValue(viz.y)&&viz.y.func!=="ascategory"),numDecimalDigits:numDecimalDigitsForFilter},marker,"y",VizUtil.returnsNumericValue(_coldef)&&_coldef.func!=="ascategory",_coldef.balloonPosition,_coldef.balloonPositionIndex)}else{if(viz.y){if(!VizUtil.isUndefined(v[y+"eb"])){_text.add((viz.y.balloonDisplayName||(viz.y.type===VizUtil.TYPE_NUMROWS?VizUtil.NUMROWS_COL_LABEL:viz.y.name))+winfunc+": "+prefix+formatfunc(v[y])+suffix,marker,"eb",true,viz.y.balloonPosition,viz.y.balloonPositionIndex);_text.add("Range: ±"+prefix+formatfunc(v[y+"eb"])+suffix+" ("+prefix+formatfunc(v[y]-v[y+"eb"])+suffix+" - "+prefix+formatfunc(v[y]+v[y+"eb"])+suffix+")",marker,"eb",true,viz.y.balloonPosition,viz.y.balloonPositionIndex);_data.add({type:"y",name:(viz.y.balloonDisplayName||(viz.y.type===VizUtil.TYPE_NUMROWS?VizUtil.NUMROWS_COL_LABEL:viz.y.name))+winfunc,validName:viz.y.type===VizUtil.TYPE_NUMROWS?VizUtil.NUMROWS_COL_NAME:viz.y.validName,rawValue:v[y],value:prefix+formatfunc(v[y])+" ±"+formatfunc(v[y+"eb"])+suffix,func:marker==="scatter"&&viz.y.isNumeric?"round":viz[ycol].func,datatype:null,filter:marker==="scatter",numDecimalDigits:numDecimalDigitsForFilter},marker,"eb",true,viz.y.balloonPosition,viz.y.balloonPositionIndex)}else{_text.add((viz.y.balloonDisplayName||(viz.y.type===VizUtil.TYPE_NUMROWS?VizUtil.NUMROWS_COL_LABEL:viz.y.name))+winfunc+": "+prefix+formatfunc(v[y])+suffix,marker,"y",VizUtil.returnsNumericValue(viz.y)&&viz.y.func!=="ascategory",viz.y.balloonPosition,viz.y.balloonPositionIndex);_data.add({type:"y",name:(viz.y.balloonDisplayName||(viz.y.type===VizUtil.TYPE_NUMROWS?VizUtil.NUMROWS_COL_LABEL:viz.y.name))+winfunc,validName:viz.y.type===VizUtil.TYPE_NUMROWS?VizUtil.NUMROWS_COL_NAME:viz.y.validName,rawValue:v[y],value:prefix+formatfunc(v[y])+suffix,func:/^(scatter|violin)$/.test(marker)&&viz.y.isNumeric?"round":viz[ycol].func,datatype:null,filter:/^(scatter|violin)$/.test(marker)||marker==="bubble"&&!(VizUtil.returnsNumericValue(viz.y)&&viz.y.func!=="ascategory"),numDecimalDigits:numDecimalDigitsForFilter},marker,"y",VizUtil.returnsNumericValue(viz.y)&&viz.y.func!=="ascategory",viz.y.balloonPosition,viz.y.balloonPositionIndex)}}else{_text.add(y+winfunc+": "+prefix+formatfunc(v[y])+suffix,marker,"y",true,null,null);_data.add({type:"y",name:y+winfunc,validName:VizUtil.NUMROWS_COL_NAME,rawValue:v[y],value:prefix+formatfunc(v[y])+suffix,func:"sum",datatype:null,filter:marker==="scatter"||marker==="bubble"&&!(VizUtil.returnsNumericValue(viz.y)&&viz.y.func!=="ascategory"),numDecimalDigits:numDecimalDigitsForFilter},marker,"y",true,null,null)}}}if(reflineEnabled){if(!group.refline)group.refline={x:[],y:[]};group.refline.x.push(VizUtil.isEmpty(v[x])?null:v[x]);group.refline.y.push(VizUtil.isEmpty(v[_y+REFLINE_COLUMN])?null:v[_y+REFLINE_COLUMN]);if(reflineRangeEnabled){if(!group.refrange)group.refrange={x:[],y:[]};group.refrange.x.push(VizUtil.isEmpty(v[x])?null:v[x]);group.refrange.y.push(VizUtil.isEmpty(v[_y+REFLINE_RANGE_COLUMN])?null:v[_y+REFLINE_RANGE_COLUMN])}}if(vReflineEnabled){if(!group.vrefline)group.vrefline={x:[],y:[]};group.vrefline.x.push(VizUtil.isEmpty(v[x+REFLINE_COLUMN])?null:v[x+REFLINE_COLUMN]);group.vrefline.y.push(VizUtil.isEmpty(v[_y])?null:v[_y]);if(!group.vrefrange)group.vrefrange={x:[],y:[]};group.vrefrange.x.push(VizUtil.isEmpty(v[x+REFLINE_RANGE_COLUMN])?null:v[x+REFLINE_RANGE_COLUMN]);group.vrefrange.y.push(VizUtil.isEmpty(v[_y])?null:v[_y])}if(!VizUtil.isUndefined(v[y+"eb"])){if(!group.error_y){group.error_y={type:"data",array:[],visible:true,width:errBarWidth?errBarWidth:4}}group.error_y.array.push(v[y+"eb"])}else if(errHigh&&errLow&&viz[ycol].isNumeric&&errHighLowEnabled==="on"&&marker==="scatter"){if(!group.error_y){group.error_y={type:"data",symmetric:false,array:[],arrayminus:[],visible:true,width:errBarWidth?errBarWidth:4}}if(!VizUtil.isUndefined(v[errHigh.label])&&!VizUtil.isUndefined(v[errLow.label])){group.error_y.array.push(v[errHigh.label]===null?0:Math.abs(v[viz[ycol].label]-v[errHigh.label]));group.error_y.arrayminus.push(v[errLow.label]===null?0:Math.abs(v[viz[ycol].label]-v[errLow.label]));_text.add((errHigh.balloonDisplayName||errHigh.name)+": "+prefix+formatValue(v[errHigh.label])+suffix,marker,"errh",true,errHigh.balloonPosition,errHigh.balloonPositionIndex);_data.add({type:"errh",name:errHigh.balloonDisplayName||errHigh.name,validName:errHigh.validName,rawValue:v[errHigh.label],value:prefix+formatValue(v[errHigh.label])+suffix,func:null,datatype:null,filter:false},marker,"y",true,errHigh.balloonPosition,errHigh.balloonPositionIndex);_text.add((errLow.balloonDisplayName||errLow.name)+": "+prefix+formatValue(v[errLow.label])+suffix,marker,"errl",true,errLow.balloonPosition,errLow.balloonPositionIndex);_data.add({type:"errl",name:errLow.balloonDisplayName||errLow.name,validName:errLow.validName,rawValue:v[errLow.label],value:prefix+formatValue(v[errLow.label])+suffix,func:null,datatype:null,filter:false},marker,"y",true,errLow.balloonPosition,errLow.balloonPositionIndex)}}else if(y&&errHigh&&errLow&&errHighLowEnabled==="on"&&viz[ycol].isNumeric&&marker==="line"){if(!VizUtil.isUndefined(v[errHigh.label])&&!VizUtil.isUndefined(v[errLow.label])){if(v[_y]===null){}else{range.x.push(v[x]);range.hi.push(v[errHigh.label]===null?v[_y]:v[errHigh.label]);range.low.push(v[errLow.label]===null?v[_y]:v[errLow.label]);_text.add((errHigh.balloonDisplayName||errHigh.name)+": "+prefix+formatValue(v[errHigh.label])+suffix,marker,"errh",true,errHigh.balloonPosition,errHigh.balloonPositionIndex);_data.add({type:"errh",name:errHigh.balloonDisplayName||errHigh.name,validName:errHigh.validName,rawValue:v[errHigh.label],value:prefix+formatValue(v[errHigh.label])+suffix,func:null,datatype:null,filter:false},marker,"errh",true,errHigh.balloonPosition,errHigh.balloonPositionIndex);_text.add((errLow.balloonDisplayName||errLow.name)+": "+prefix+formatValue(v[errLow.label])+suffix,marker,"errl",true,errLow.balloonPosition,errLow.balloonPositionIndex);_data.add({type:"errl",name:errLow.balloonDisplayName||errLow.name,validName:errLow.validName,rawValue:v[errLow.label],value:prefix+formatValue(v[errLow.label])+suffix,func:null,datatype:null,filter:false},marker,"errl",true,errLow.balloonPosition,errLow.balloonPositionIndex)}}}}if(z){if(!group.z)group.z=[];group.z.push(v[z]);_text.add((viz.z.balloonDisplayName||viz.z.name)+": "+zValuePrefix+formatZValue(v[z])+zValueSuffix,marker,"z",VizUtil.returnsNumericValue(viz.z)&&viz.z.func!=="ascategory",viz.z.balloonPosition,viz.z.balloonPositionIndex);_data.add({type:"z",name:viz.z.balloonDisplayName||viz.z.name,validName:viz.z.validName,rawValue:v[z],value:zValuePrefix+formatZValue(v[z])+zValueSuffix,func:viz.z.func,datatype:viz.z.type,filter:false,numDecimalDigits:numDecimalDigitsForFilter},marker,"z",VizUtil.returnsNumericValue(viz.z)&&viz.z.func!=="ascategory",viz.z.balloonPosition,viz.z.balloonPositionIndex)}if(v[orderRow]!==undefined){if(!group._orderRow)group._orderRow=[];group._orderRow.push(!!v[orderRow])}if(marker==="errbar"){_text.add("Range Type: "+VizUtil.ERROR_BAR_TYPE_OPTIONS_HASH[viz.errbarType||"stderr"],marker,"stderr",true)}if(allowMultiYAndColor&&marker==="scatter"&&group.mode==="markers"){if(!group.text)group.text=[];if(viz.label2OnPlot==="on"&&!!label2&&group.type==="scatter"){group.text.push(v[label2])}else{group.text.push(_text.toArray().join("<br>"))}}else if(labelOnPlot==="on"&&label){if(!group.text)group.text=[];group.text.push(v[label])}else if(_text.toArray().length>0){if(!group.text)group.text=[];group.text.push(_text.toArray().join("<br>"))}group.customdata.push(_data.toArray());if(marker==="scatter"){if(!group.marker.opacity){group.marker.opacity=opacity}else if(viz.fillOpacity){group.marker.opacity=viz.fillOpacity}}else if(marker==="bubble"){group.marker.opacity=opacity}else{group.opacity=opacity}if(_color){if(!group.marker.color){group.marker.color=[]}if(isMultiY&&!viz.color){group.marker.color=colorScale(_color)}else{if(viz.color&&VizUtil.applyColorBucketAfterSummarize(marker)&&colorbucket){group.marker.color.push(colorScale(v[colorbucket]))}else{if(isMultiY&&allowMultiYAndColor&&viz.color&&d.ycolname){group.marker.color=colorScale(_color)}else{group.marker.color=colorScale(v[_color])}}}}}var yOp=d.yOp||"y";var trendLineOp=d.yOp?viz[d.yOp+"TrendLine"]:viz.yTrendLine||viz.trendLine;var formatTrendLineValue=formatTrendLineValueHash[d.yOp||"y"];var prefix=d.use2ndAxis?y2ValuePrefix:y1ValuePrefix;var suffix=d.use2ndAxis?y2ValueSuffix:y1ValueSuffix;var formatfunc=d.use2ndAxis?formatY2Value:formatY1Value;if(x&&trendLineOp&&trendLineOp!=="none"&&/^(scatter|line|bubble)$/.test(marker)){if(!VizUtil.isEmpty(v[FITTED_COLUMN])&&(!xDataRange||v[x]>=xDataRange[0]&&v[x]<=xDataRange[1])){trendLineGroup.x.push(v[x]);trendLineGroup.y.push(v[FITTED_COLUMN]);var xValue=(viz.x.balloonDisplayName||(viz.x.type===VizUtil.TYPE_NUMROWS?VizUtil.NUMROWS_COL_LABEL:viz.x.name))+": "+formatfunc(v[x]);var yValue=(viz[yOp].balloonDisplayName||(viz[yOp].type===VizUtil.TYPE_NUMROWS?VizUtil.NUMROWS_COL_LABEL:viz[yOp].name))+": "+prefix+formatfunc(v[FITTED_COLUMN])+suffix;switch(trendLineOp){case"lmfit":var t="";t+=xValue;t+="<br>"+yValue;if(v["cor.value"]){t+="<br>Correlation: "+formatTrendLineValue(v["cor.value"])}t+="<br>R Squared: "+formatTrendLineValue(v.r_squared);if(v.coef){var coef=convertCoefByTimeUnit(v.coef,viz.x.func,viz.x.type);t+="<br>Coefficient: "+formatTrendLineValue(coef)}t+="<br>P-Value: "+formatTrendLineValue(v.p_value);trendLineGroup.text.push(t);break;case"gamfit":trendLineGroup.text.push(xValue+"<br>"+yValue+"<br>R Squared: "+formatTrendLineValue(v.r_squared)+"<br>Deviance Explained: "+formatTrendLineValue(v.deviance_explained)+"<br>GCV: "+formatTrendLineValue(v.gcv)+"<br>Scale Est.: "+formatTrendLineValue(v.scale_est));break;case"loessfit":trendLineGroup.text.push(xValue+"<br>"+yValue+"<br>Equivalent Number of Parameters: "+formatTrendLineValue(v.enp)+"<br>Residual Standard Error: "+formatTrendLineValue(v.residual_std_error)+"<br>Trace of Smoother Matrix: "+formatTrendLineValue(v.trace_of_smoother_matrix));break}}var withRange=d.yOp?viz[d.yOp+"TrendLineWithRange"]:viz.yTrendLineWithRange||viz.trendLineWithRange;if(withRange!=="off"){if(!VizUtil.isEmpty(v[CONF_HIGH_COLUMN])&&!VizUtil.isEmpty(v[CONF_LOW_COLUMN])&&(!xDataRange||v[x]>=xDataRange[0]&&v[x]<=xDataRange[1])){trendLineRange.x.push(v[x]);trendLineRange.hi.push(v[CONF_HIGH_COLUMN]);trendLineRange.low.push(v[CONF_LOW_COLUMN])}}}});if(group.marker.color&&Array.isArray(group.marker.color)&&marker==="choropleth"){group.marker.colorscale=[[0,quantColorPalette[0]],[.25,quantColorPalette[1]],[.5,quantColorPalette[2]],[.75,quantColorPalette[3]],[1,quantColorPalette[4]]]}if(!group.marker.color){group.marker.color=colorScale("a")}if(marker==="errbar"){if(errbarGraph==="bar"){group.error_y.color="#4d4d4d"}else if(errbarGraph==="marker"){group.error_y.color=group.marker.color}}else if(marker==="scatter"&&group.error_y){if(!viz[yop+"MarkerShape"]||/^(circle|default)$/.test(viz[yop+"MarkerShape"])){group.error_y.color=group.marker.color}else{group.error_y.color="#4d4d4d"}}if(viz.hideNullFromLegend==="on"&&group.name==="null"){group.showlegend=false}if(!group.textfont){group.textfont={}}if(viz[yop+"SyncTextColor"]==="on"&&group.marker.color&&typeof group.marker.color==="string"){group.textfont.color=group.marker.color}if(!!viz[yop+"LabelFontSize"]){group.textfont.size=viz[yop+"LabelFontSize"]}if(viz.allowMultiYAndColor&&group.name===NA_LABEL&&isAllNull(group.y)){group.showlegend=false}gData.push(group);if(reflineEnabled&&group.x&&!VizUtil.isUndefined(group.refline)){var reflineLabel=(viz[yop]?viz[yop].type===VizUtil.TYPE_NUMROWS?VizUtil.NUMROWS_COL_LABEL:viz[yop].name:"")+" ("+(VizUtil.REFERENCE_LINE_OPTIONS_HASH[viz[yop+"ReflineType"]]||VizUtil.REFERENCE_LINE_OPTIONS[0].label)+")";if(viz[yop+"ReflineLabel"]){reflineLabel=viz[yop+"ReflineLabel"]}var reflineGroup=viz[yop+"ReflineGroup"]||"all";var reflineColor=viz[yop+"ReflineColor"]&&viz[yop+"ReflineColor"]!=="default"?viz[yop+"ReflineColor"]:isMultiY?group.marker.color:"#53585F";var reflineWidth=viz[yop+"ReflineWidth"]||2;var reflineLength=viz[yop+"ReflineLength"]||12;var reflineStyle=viz[yop+"ReflineStyle"]||"dot";var reflineHideFromLegend=viz[yop+"ReflineHideFromLegend"]===true||viz[yop+"ReflineShowInLegend"]==="off";var errorbarRange=group.refline.x.map(function(){return 0});var reflineOnEachXDataPoint=/^(xaxis|xaxis\+facet)$/.test(reflineGroup)&&marker==="scatter"&&!VizUtil.returnsNumericValue(viz.x);if(reflineRangeEnabled){var reflineRangeType=viz[yop+"ReflineRangeType"];var reflineRangeLabel=VizUtil.REFERENCE_LINE_RANGE_TYPE_OPTIONS_HASH[reflineRangeType];var upperYValues=group.refline.y.map(function(v,idx){return VizUtil.isEmpty(v)?null:v+group.refrange.y[idx]});var upperYLabels=upperYValues.map(function(v){return reflineRangeLabel+": "+v});var lowerYValues=group.refline.y.map(function(v,idx){return VizUtil.isEmpty(v)?null:v-group.refrange.y[idx]});var lowerYLabels=lowerYValues.map(function(v){return reflineRangeLabel+": "+v});var lowerRangeLayer=null,upperRangeLayer=null;if(reflineOnEachXDataPoint){upperRangeLayer={name:reflineRangeLabel,x:group.refline.x,y:group.refline.y.map(function(v,idx){return VizUtil.isEmpty(v)?null:v+group.refrange.y[idx]}),error_y:{type:"data",array:errorbarRange,visible:true,width:reflineLength,thickness:reflineWidth,color:_setOpacity(reflineColor,.4)},type:"scatter",mode:"markers",showlegend:false,marker:{size:1,color:_setOpacity(reflineColor,.4),symbol:"line-ew-open"},hoverinfo:"text",text:upperYLabels,customdata:{type:viz[yop+"ReflineType"],yOp:yop}};lowerRangeLayer={name:reflineRangeLabel,x:group.refline.x,y:group.refline.y.map(function(v,idx){return VizUtil.isEmpty(v)?null:v-group.refrange.y[idx]}),error_y:{type:"data",array:errorbarRange,visible:true,width:reflineLength,thickness:reflineWidth,color:_setOpacity(reflineColor,.4)},type:"scatter",mode:"markers",showlegend:false,marker:{size:1,color:_setOpacity(reflineColor,.4),symbol:"line-ew-open"},hoverinfo:"text",text:lowerYLabels,customdata:{type:viz[yop+"ReflineType"],yOp:yop}}}else{upperRangeLayer={x:group.refline.x,y:upperYValues,line:{color:_setOpacity(reflineColor,.4),width:reflineWidth,
dash:reflineStyle},name:reflineRangeLabel,legendgroup:"refline"+yop,showlegend:false,visible:!reflineHash[yop],mode:"lines",text:upperYLabels,hoverinfo:"text",customdata:{type:viz[yop+"ReflineType"],yOp:yop}};lowerRangeLayer={x:group.refline.x,y:lowerYValues,line:{color:_setOpacity(reflineColor,.4),width:reflineWidth,dash:reflineStyle},name:reflineRangeLabel,legendgroup:"refline"+yop,showlegend:false,visible:!reflineHash[yop],mode:"lines",text:lowerYLabels,hoverinfo:"text",customdata:{type:viz[yop+"ReflineType"],yOp:yop}}}gRefLineUpperRangeLayerData.push(upperRangeLayer);gRefLineLowerRangeLayerData.push(lowerRangeLayer)}else{gRefLineUpperRangeLayerData.push({x:[],y:[],customdata:{}});gRefLineLowerRangeLayerData.push({x:[],y:[],customdata:{}})}var reflineLineGroup=null;var formatRefLineValue=formatRefLineValueHash[yop].formatter;var refLineValuePrefix=formatRefLineValueHash[yop].prefix;var refLineValueSuffix=formatRefLineValueHash[yop].suffix;if(reflineOnEachXDataPoint){reflineLineGroup={name:reflineLabel,x:group.refline.x,y:group.refline.y,error_y:{type:"data",array:errorbarRange,visible:true,width:reflineLength,thickness:reflineWidth,color:reflineColor},type:"scatter",mode:"markers",legendgroup:"refline"+yop,showlegend:!reflineHash[yop],visible:!reflineHash[yop],marker:{size:12,color:reflineColor,symbol:"line-ew-open"},hoverinfo:"text",text:group.refline.y.map(function(v){return(reflineLabel?reflineLabel+": ":"")+refLineValuePrefix+formatRefLineValue(v)+refLineValueSuffix}),customdata:{type:viz[yop+"ReflineType"],yOp:yop}}}else{reflineLineGroup={x:group.refline.x,y:group.refline.y,line:{color:reflineColor,width:reflineWidth,dash:reflineStyle},name:reflineLabel,legendgroup:"refline"+yop,showlegend:!reflineHash[yop],visible:!reflineHash[yop],mode:"lines",hoverinfo:"text",text:group.refline.y.map(function(v){return(reflineLabel?reflineLabel+": ":"")+refLineValuePrefix+formatRefLineValue(v)+refLineValueSuffix}),customdata:{type:viz[yop+"ReflineType"],yOp:yop}}}if(group.yaxis){reflineLineGroup.yaxis=group.yaxis}if(reflineHideFromLegend){reflineLineGroup.showlegend=false}if(viz[yop+"ReflineType"]==="diagonal"){recalculateDiagonalRefLineData(reflineLineGroup)}reflineHash[yop]=true;gRefLineLayerData.push(reflineLineGroup)}else{gRefLineLayerData.push({x:[],y:[],customdata:{}});gRefLineUpperRangeLayerData.push({x:[],y:[],customdata:{}});gRefLineLowerRangeLayerData.push({x:[],y:[],customdata:{}})}if(vReflineEnabled&&group.x&&!VizUtil.isUndefined(group.vrefline)){var vReflineLabel=(viz.x?viz.x.type===VizUtil.TYPE_NUMROWS?VizUtil.NUMROWS_COL_LABEL:viz.x.name:"")+" ("+(VizUtil.REFERENCE_LINE_OPTIONS_HASH[viz[xop+"ReflineType"]]||VizUtil.REFERENCE_LINE_OPTIONS[0].label)+")";if(viz[xop+"ReflineLabel"]){vReflineLabel=viz[xop+"ReflineLabel"]}var vReflineColor=viz[xop+"ReflineColor"]||"#53585F";var vReflineWidth=viz[xop+"ReflineWidth"]||2;var vReflineStyle=viz[xop+"ReflineStyle"]||"dot";var vReflineHideFromLegend=viz[xop+"ReflineHideFromLegend"]===true||viz[xop+"ReflineShowInLegend"]==="off";var formatVRefLineValue=formatVRefLineValueHash[xop].formatter;var vRefLineValuePrefix=formatVRefLineValueHash[xop].prefix;var vRefLineValueSuffix=formatVRefLineValueHash[xop].suffix;var vReflineGroup={x:group.vrefline.x,y:group.vrefline.y,line:{color:vReflineColor,width:vReflineWidth,dash:vReflineStyle},name:vReflineLabel,legendgroup:"vrefline",showlegend:!vreflineHash[xop],visible:!vreflineHash[xop],mode:"lines",hoverinfo:"text",text:group.vrefline.x.map(function(v){return(vReflineLabel?vReflineLabel+": ":"")+vRefLineValuePrefix+formatVRefLineValue(v)+vRefLineValueSuffix})};vreflineHash[xop]=true;if(vReflineHideFromLegend){vReflineGroup.showlegend=false}gVRefLineLayerData.push(vReflineGroup)}if(/^(line|scatter)$/.test(marker)&&!z&&range){var rangeGroup={x:[],y:[],fill:"tozerox",fillcolor:VizUtil.hexToRgba(isArray(group.marker.color)?quantColorPalette[quantColorPalette.length-1]:group.marker.color,.2),line:{color:"transparent"},name:group.name,showlegend:false,type:"scatter",hoverinfo:"none"};if(d.use2ndAxis){rangeGroup.use2ndAxis=d.use2ndAxis;rangeGroup.yaxis="y2"}var copyx=range.x?range.x.slice():group.x.slice();var copyx2=range.x?range.x.slice():group.x.slice();rangeGroup.x=copyx.concat(copyx2.reverse());rangeGroup.y=range.hi.concat(range.low.reverse());rangeGroup.x.push(copyx[0]);rangeGroup.y.push(range.hi[0]);gRangeLayerData.push(rangeGroup);rangeGroup.legendgroup="lg"+rangeLegendgroup;group.legendgroup="lg"+rangeLegendgroup;rangeLegendgroup++}if(/^(line|scatter|bubble)$/.test(marker)&&!z&&trendLineGroup){trendLineGroup.marker={color:isColorContinuous?quantColorPalette[quantColorPalette.length-1]:group.marker.color};if(d.use2ndAxis){trendLineGroup.use2ndAxis=d.use2ndAxis;trendLineGroup.yaxis="y2"}gTrendLineLayerData.push(trendLineGroup);trendLineGroup.legendgroup="lg"+trendLineLegendgroup;group.legendgroup="lg"+trendLineLegendgroup;trendLineLegendgroup++}if(/^(line|scatter|bubble)$/.test(marker)&&!z&&trendLineRange){var trendLineRangeGroup={x:[],y:[],fill:"tozerox",fillcolor:VizUtil.hexToRgba(isColorContinuous?quantColorPalette[quantColorPalette.length-1]:group.marker.color,.2),line:{color:"transparent"},name:group.name,showlegend:false,type:"scatter",hoverinfo:"none"};if(d.use2ndAxis){trendLineRangeGroup.use2ndAxis=d.use2ndAxis;trendLineRangeGroup.yaxis="y2"}var copyx=trendLineRange.x?trendLineRange.x.slice():group.x.slice();var copyx2=trendLineRange.x?trendLineRange.x.slice():group.x.slice();trendLineRangeGroup.x=copyx.concat(copyx2.reverse());trendLineRangeGroup.y=trendLineRange.hi.concat(trendLineRange.low.reverse());trendLineRangeGroup.x.push(copyx[0]);trendLineRangeGroup.y.push(trendLineRange.hi[0]);trendLineRangeGroup.hoverinfo="skip";gTrendLineRangeLayerData.push(trendLineRangeGroup);trendLineRangeGroup.legendgroup="lg"+trendLineRangeLegendgroup;trendLineRangeLegendgroup++}})}var divElem=null;if(targetElem){var divElem=document.createElement("div");divElem.style.width="100%";divElem.style.height="100%";targetElem.appendChild(divElem);viz._canvasWidth=$(targetElem).width();viz._canvasHeight=$(targetElem).height()}var _bottom=VizUtil.MIN_MARGIN,_left=VizUtil.MIN_MARGIN,_top=title?40:10,_right=colsOn2ndAxis.length>0?VizUtil.MIN_MARGIN+10:15,_v;_v=parseInt(marginTop);if(!isNaN(_v)){_top=_v}_v=parseInt(marginBottom);if(!isNaN(_v)){_bottom=_v}_v=parseInt(marginLeft);if(!isNaN(_v)){_left=_v}_v=parseInt(marginRight);if(!isNaN(_v)){_right=_v}if(/^(scatter|bubble)$/.test(marker)&&gData.length>0&&gData[0].marker.size&&gData[0].marker.size.length>0){var _exts=gData.map(function(d){if(!d.marker.size){return[]}return d3.extent(d.marker.size)});var _ext=d3.extent(d3.merge(_exts));var _scale=d3.scale.linear().domain(_ext).range([circleMinSize,circleMaxSize]);gData.forEach(function(d){if(!d.marker.size){return}d.marker.size_org=d.marker.size;d.marker.size=d.marker.size_org.map(function(sz){return sz===null?null:_scale(sz)})})}var layout={font:{family:'"Helvetica Neue", Arial, Helvetica, "ヒラギノ角ゴ Pro W3", "Hiragino Kaku Gothic Pro", "ヒラギノ角ゴシック","Hiragino Sans", "Hiragino Kaku Gothic", "Meiryo UI", "メイリオ", Meiryo, "ＭＳ Ｐゴシック", "MS PGothic", sans-serif'},margin:{t:_top,b:_bottom,l:_left,r:_right},legend:{traceorder:"normal",font:{}},titlefont:{},hovermode:viz.hoverMode||VizUtil.getDefaultHoverMode(marker),xaxis:{zerolinecolor:VizUtil.ZERO_LINE_COLOR,titlefont:{},tickfont:{}},yaxis:{zerolinecolor:VizUtil.ZERO_LINE_COLOR,titlefont:{},tickfont:{}},zaxis:{zerolinecolor:VizUtil.ZERO_LINE_COLOR,titlefont:{},tickfont:{}},paper_bgcolor:viz.backgroundColor||"rgba(255,255,255,1)",plot_bgcolor:viz.backgroundColor||"rgba(255,255,255,1)",scene:{xaxis:{titlefont:{},tickfont:{}},yaxis:{titlefont:{},tickfont:{}},yaxis2:{titlefont:{},tickfont:{}},zaxis:{titlefont:{},tickfont:{}}}};var xTickFormat=viz.xAxisNumDecimalDigits?",."+viz.xAxisNumDecimalDigits+"f":viz.xAxisTickFormat;var yTickFormat=viz.y1AxisNumDecimalDigits?",."+viz.y1AxisNumDecimalDigits+"f":viz.yAxisTickFormat;var y2TickFormat=viz.y2AxisNumDecimalDigits?",."+viz.y2AxisNumDecimalDigits+"f":viz.y2AxisTickFormat;var zTickFormat=viz.zAxisNumDecimalDigits?",."+viz.zAxisNumDecimalDigits+"f":viz.zAxisTickFormat;if(xTickFormat){layout.xaxis.tickformat=layout.scene.xaxis.tickformat=xTickFormat}if(yTickFormat){layout.yaxis.tickformat=layout.scene.yaxis.tickformat=yTickFormat}if(y2TickFormat){if(!layout.yaxis2){layout.yaxis2={}}if(!layout.scene.yaxis2){layout.scene.yaxis2={}}layout.yaxis2.tickformat=layout.scene.yaxis2.tickformat=y2TickFormat}if(zTickFormat){layout.zaxis.tickformat=layout.scene.zaxis.tickformat=zTickFormat}if(marker==="heatmap"){if(xAxisPosition==="top"){layout.xaxis.side="top"}}if(VizUtil.isAxisDirectionEnabled(marker)){if(viz.xAxisDirection){layout.xaxis.autorange=viz.xAxisDirection}if(viz.yAxisDirection){layout.yaxis.autorange=viz.yAxisDirection}if(viz.y2AxisDirection){if(!layout.yaxis2){layout.yaxis2={}}layout.yaxis2.autorange=viz.y2AxisDirection}if(viz.zAxisDirection){layout.zaxis.autorange=viz.zAxisDirection}}if(viz.x){layout.xaxis.title=layout.scene.xaxis.title=viz.x.name}if(viz.y){layout.yaxis.title=layout.scene.yaxis.title=viz.y.name}if(viz.z){layout.zaxis.title=layout.scene.zaxis.title=viz.z.name}if(y===VizUtil.FREQ_COL_LABEL){layout.yaxis.title=y}if(viz.x&&viz.x.type===VizUtil.TYPE_NUMROWS){layout.xaxis.title=VizUtil.NUMROWS_COL_LABEL}if(viz.y&&viz.y.type===VizUtil.TYPE_NUMROWS){layout.yaxis.title=VizUtil.NUMROWS_COL_LABEL}if(!isMultiY&&viz.yWindowFunc&&/^(bar|line|area)$/.test(marker)){var _funclabel=VizUtil.WINDOW_FUNCTION_OPTIONS_HASH[viz.yWindowFunc];if(_funclabel&&viz.yWindowFunc!=="none"&&legendShowFuncName){layout.yaxis.title+=" ("+_funclabel+")"}}layout.xaxis.tickprefix=layout.scene.xaxis.tickprefix=xValuePrefix;layout.xaxis.ticksuffix=layout.scene.xaxis.ticksuffix=xValueSuffix;layout.yaxis.tickprefix=layout.scene.yaxis.tickprefix=y1ValuePrefix;layout.yaxis.ticksuffix=layout.scene.yaxis.ticksuffix=y1ValueSuffix;layout.zaxis.tickprefix=layout.scene.zaxis.tickprefix=zValuePrefix;layout.zaxis.ticksuffix=layout.scene.zaxis.ticksuffix=zValueSuffix;if(/^(scatter|bubble)$/.test(marker)&&viz.xAxisScale){layout.xaxis.type=layout.scene.xaxis.type=viz.xAxisScale}if(viz.x&&VizUtil.returnsDateValue(viz.x)){layout.xaxis.type=layout.scene.xaxis.type="date"}if(/^(scatter|bar|errbar|hist|bubble|line|area)$/.test(marker)&&viz.yAxisScale){layout.yaxis.type=layout.scene.yaxis.type=viz.yAxisScale}if(viz.y&&VizUtil.returnsDateValue(viz.y)){layout.yaxis.type=layout.scene.yaxis.type="date"}if(/^(scatter)$/.test(marker)&&viz.zAxisScale){layout.zaxis.type=layout.scene.zaxis.type=viz.zAxisScale}if(viz.z&&VizUtil.returnsDateValue(viz.z)){layout.zaxis.type=layout.scene.zaxis.type="date"}if(xAxisTitle){layout.xaxis.title=layout.scene.xaxis.title=xAxisTitle}if(yAxisTitle){layout.yaxis.title=layout.scene.yaxis.title=yAxisTitle}if(zAxisTitle){layout.zaxis.title=layout.scene.zaxis.title=zAxisTitle}if(!xAxisShowTitle){layout.xaxis.title=layout.scene.xaxis.title=""}if(!yAxisShowTitle){layout.yaxis.title=layout.scene.yaxis.title=""}if(!zAxisShowTitle){layout.zaxis.title=layout.scene.zaxis.title=""}layout.xaxis.titlefont.size=layout.scene.xaxis.titlefont.size=viz.xAxisTitleFontSize||13;layout.yaxis.titlefont.size=layout.scene.yaxis.titlefont.size=viz.yAxisTitleFontSize||13;layout.zaxis.titlefont.size=layout.scene.zaxis.titlefont.size=viz.zAxisTitleFontSize||13;if(viz.xAxisTickFontSize){layout.xaxis.tickfont.size=layout.scene.xaxis.tickfont.size=viz.xAxisTickFontSize}if(viz.yAxisTickFontSize){layout.yaxis.tickfont.size=layout.scene.yaxis.tickfont.size=viz.yAxisTickFontSize}if(viz.zAxisTickFontSize){layout.zaxis.tickfont.size=layout.scene.zaxis.tickfont.size=viz.zAxisTickFontSize}if(viz.axisAutoMargin!=="off"){layout.xaxis.automargin=true;layout.yaxis.automargin=true}if(viz.showXGridLines&&viz.showXGridLines!=="default"){layout.xaxis.showgrid=layout.scene.xaxis.showgrid=viz.showXGridLines==="on"}if(viz.showYGridLines&&viz.showYGridLines!=="default"){layout.yaxis.showgrid=layout.scene.yaxis.showgrid=viz.showYGridLines==="on"}if(viz.showZGridLines&&viz.showZGridLines!=="default"){layout.zaxis.showgrid=layout.scene.zaxis.showgrid=viz.showZGridLines==="on"}if(!viz.x){layout.xaxis.zeroline=layout.scene.xaxis.zeroline=false}if(viz.showXZeroLine&&viz.showXZeroLine!=="default"){layout.xaxis.zeroline=layout.scene.xaxis.zeroline=viz.showXZeroLine==="on"}if(viz.showYZeroLine&&viz.showYZeroLine!=="default"){layout.yaxis.zeroline=layout.scene.yaxis.zeroline=viz.showYZeroLine==="on"}if(viz.showZZeroLine&&viz.showZZeroLine!=="default"){layout.zaxis.zeroline=layout.scene.zaxis.zeroline=viz.showZZeroLine==="on"}if(viz.xAxisTickStep&&viz.x&&VizUtil.returnsNumericValue(viz.x)){layout.xaxis.dtick=layout.scene.xaxis.dtick=viz.xAxisTickStep}if(userXAxisRange){layout.xaxis.range=layout.scene.xaxis.range=userXAxisRange}if(viz.yAxisTickStep&&viz.y&&VizUtil.returnsNumericValue(viz.y)){layout.yaxis.dtick=layout.scene.yaxis.dtick=viz.yAxisTickStep}if(userYAxisRange){layout.yaxis.range=layout.scene.yaxis.range=userYAxisRange}if(viz.zAxisTickStep&&viz.z&&VizUtil.returnsNumericValue(viz.z)){layout.zaxis.dtick=layout.scene.zaxis.dtick=viz.zAxisTickStep}if(userZAxisRange){layout.zaxis.range=layout.scene.zaxis.range=userZAxisRange}if(VizUtil.isPostFilterSupported(viz)&&viz.xPostFilterType){layout.xaxis.type="category"}if(colsOn2ndAxis.length>0){if(!layout.yaxis2){layout.yaxis2={}}layout.yaxis2.zerolinecolor=VizUtil.ZERO_LINE_COLOR;layout.yaxis2.titlefont={};layout.yaxis2.tickfont={};layout.yaxis2.side="right";layout.yaxis2.overlaying="y";if(viz.axisAutoMargin!=="off"){layout.yaxis2.automargin=true}var _col=colsOn2ndAxis[0];if(y2AxisTitle){layout.yaxis2.title=layout.scene.yaxis2.title=y2AxisTitle}else{layout.yaxis2.title=_col.name;if(_col.label===VizUtil.FREQ_COL_LABEL){layout.yaxis2.title=_col.label}if(_col.type===VizUtil.TYPE_NUMROWS){layout.yaxis2.title=VizUtil.NUMROWS_COL_LABEL}}if(!y2AxisShowTitle){layout.yaxis2.title=""}if(/^(scatter|bar|errbar|hist|bubble|area|line)$/.test(marker)&&viz.y2AxisScale){layout.yaxis2.type=layout.scene.yaxis2.type=viz.y2AxisScale}if(VizUtil.returnsDateValue(_col)){layout.yaxis2.type=layout.scene.yaxis2.type="date"}layout.yaxis2.tickprefix=y2ValuePrefix;layout.yaxis2.ticksuffix=y2ValueSuffix;if(viz.y2AxisTitleFontSize){layout.yaxis2.titlefont.size=viz.y2AxisTitleFontSize}if(viz.y2AxisTickFontSize){layout.yaxis2.tickfont.size=viz.y2AxisTickFontSize}layout.yaxis2.showgrid=viz.showY2GridLines==="on";layout.yaxis2.zeroline=viz.showY2ZeroLine==="on";if(viz.y2AxisTickStep&&viz.y&&VizUtil.returnsNumericValue(viz.y)){layout.yaxis2.dtick=viz.y2AxisTickStep}if(userY2AxisRange){layout.yaxis2.range=userY2AxisRange}}if(viz.legendFontSize){layout.legend.font.size=viz.legendFontSize}if(title){layout.title=title}if(viz.titleFontSize){layout.titlefont.size=viz.titleFontSize}if(viz.width){layout.width=viz.width}if(viz.height){layout.height=viz.height}var config={displayModeBar:false};switch(viz.legendLocation){case"top":layout.legend.orientation="h";layout.legend.y=viz.plotlyLegendPosY||1;layout.legend.x=viz.plotlyLegendPosX||.5;layout.legend.xanchor="center";layout.legend.yanchor="bottom";if(isMultiY||color){layout.margin.t+=18}break;case"bottom":layout.legend.orientation="h";layout.legend.y=viz.plotlyLegendPosY||-.12;layout.legend.x=viz.plotlyLegendPosX||.5;layout.legend.xanchor="center";break;case"left":layout.legend.orientation="v";layout.legend.y=viz.plotlyLegendPosY||1.04;layout.legend.x=viz.plotlyLegendPosX||-.2;break;case"none":layout.showlegend=false;break;default:if(viz.plotlyLegendPosX){layout.legend.x=viz.plotlyLegendPosX}if(viz.plotlyLegendPosY){layout.legend.y=viz.plotlyLegendPosY}break}if(viz.hoverLabelBgColorBrightnessRatio){gData.forEach(function(g){if(!g.hoverlabel){g.hoverlabel={}}if(g.marker.color){g.hoverlabel.bgcolor=_adjustColor(g.marker.color,viz.hoverLabelBgColorBrightnessRatio)}})}var annotationContext=null,gDataFiltered;switch(marker){case"scatter":layout.barmode="group";if(viz.x&&(VizUtil.returnsCharacterValue(viz.x)||viz.x.func==="ascategory")){layout.xaxis.type="category"}if(viz.y&&(VizUtil.returnsCharacterValue(viz.y)||viz.y.func==="ascategory")){layout.yaxis.type="category"}if(allowMultiYAndColor){layout.legend.traceorder="reversed"}gData=gData.map(function(datum){datum.mode=datum.mode||"markers";datum.hoverinfo="text";if(allowMultiYAndColor){datum._multiYAndColor=true;if(viz.multiYAndColorHideNA&&datum.name===NA_LABEL){datum.showlegend=false}}if(allowMultiYAndColor&&datum.mode==="markers"&&datum.type==="scatter"){if(viz.label2OnPlot==="on"&&label2){datum.mode+="+text";datum.textposition=labelOnPlotVAlign+" "+labelOnPlotHAlign;datum.hoverinfo="x+y+z";if(viz.yValueOnPlotFontSize){if(!datum.textfont){datum.textfont={}}datum.textfont.size=viz.yValueOnPlotFontSize}}}else{if(labelOnPlot==="on"&&label){datum.mode+="+text";datum.textposition=labelOnPlotVAlign+" "+labelOnPlotHAlign;datum.hoverinfo="x+y+z";if(viz.yValueOnPlotFontSize){if(!datum.textfont){datum.textfont={}}datum.textfont.size=viz.yValueOnPlotFontSize}}}if(datum.marker){datum.marker.sizemode="diameter";datum.marker.sizemin=circleMinSize/2;if(!datum.marker.size){datum.marker.size=circleMinSize}}if(datum.z){datum.type="scatter3d"}if(datum.name==="null"){datum.visible=false;datum.showlegend=false}return datum});if(facet){constructFacetData(viz,gData,layout,colorarr&&colorarr.length>0?colorarr[0]:null,gRangeLayerData,gTrendLineLayerData,gTrendLineRangeLayerData,colsOn2ndAxis,gRefLineLayerData,gRefLineUpperRangeLayerData,gRefLineLowerRangeLayerData,gVRefLineLayerData,gVRefLineConfIntLayerData)}else{if(viz.xAxisIncludeZero==="on"&&!layout.xaxis.range){layout.xaxis.range=layout.scene.xaxis.range=calculateRange(gData.concat(gRangeLayerData).concat(gTrendLineLayerData).concat(gTrendLineRangeLayerData).concat(gRefLineLayerData).concat(gRefLineUpperRangeLayerData).concat(gRefLineLowerRangeLayerData),"x",viz.xAxisScale,true,false,marker,yValueOnPlot,false,barstyle,color,isMultiY,"x")}if(viz.yAxisIncludeZero==="on"&&!layout.yaxis.range){layout.yaxis.range=layout.scene.yaxis.range=calculateRange(gData.concat(gRangeLayerData).concat(gTrendLineLayerData).concat(gTrendLineRangeLayerData).concat(gRefLineLayerData).concat(gRefLineUpperRangeLayerData).concat(gRefLineLowerRangeLayerData),"y",viz.yAxisScale,true,false,marker,yValueOnPlot,false,barstyle,color,isMultiY,"y1")}if(viz.y2AxisIncludeZero==="on"&&!!layout.y2axis&&!layout.y2axis.range&&colsOn2ndAxis.length>0){if(!layout.y2axis){layout.y2axis={}}layout.y2axis.range=calculateRange(gData.concat(gRangeLayerData).concat(gTrendLineLayerData).concat(gTrendLineRangeLayerData).concat(gRefLineLayerData).concat(gRefLineUpperRangeLayerData).concat(gRefLineLowerRangeLayerData),"y",viz.y2AxisScale,true,false,marker,yValueOnPlot,false,barstyle,color,isMultiY,"y2")}if(viz.zAxisIncludeZero==="on"&&!layout.zaxis.range){layout.zaxis.range=layout.scene.zaxis.range=calculateRange(gData.concat(gRangeLayerData).concat(gTrendLineLayerData).concat(gTrendLineRangeLayerData).concat(gRefLineLayerData).concat(gRefLineUpperRangeLayerData).concat(gRefLineLowerRangeLayerData),"z",viz.zAxisScale,true,false,marker,yValueOnPlot,false,barstyle,color,isMultiY,"z")}}if(viz.xAxisDataTypeDetection==="on"){gData.forEach(function(datum,idx){if(datum._label&&datum._label.length>0&&datum._label.indexOf("line")!==-1){datum.mode="lines";if(datum.xaxis){delete layout[datum.xaxis.replace("x","xaxis")].type}else{delete layout.xaxis.type}if(!VizUtil.isEmpty(viz.xAxisDataTypeDetectionLineRefLineConst)||viz.xAxisDataTypeDetectionSupressLineRefLine==="on"){if(gRefLineLayerData&&gRefLineLayerData.length>idx&&gRefLineLayerData[idx].y){gRefLineLayerData[idx].y=gRefLineLayerData[idx].y.map(function(v){if(viz.xAxisDataTypeDetectionSupressLineRefLine==="on"){return null}else{return VizUtil.isEmpty(v)?v:viz.xAxisDataTypeDetectionLineRefLineConst}});gRefLineLayerData[idx].x.sort(function(a,b){return parseFloat(a)-parseFloat(b)})}}}})}if(viz.clusterCircles&&/^(line|fill)$/.test(viz.clusterCircles)){layout.shapes=[];gData.forEach(function(datum){var cx=[],cy=[];if(datum&&datum.y){datum.y.forEach(function(yval,index){if(!VizUtil.isEmpty(yval)){cy.push(yval);cx.push(datum.x[index])}})}if(cx.length>0){var xext=d3.extent(cx);var yext=d3.extent(cy);var shape={type:"circle",xref:datum.xaxis?datum.xaxis:"x",yref:datum.yaxis?datum.yaxis:"y",x0:xext[0],y0:yext[0],x1:xext[1],y1:yext[1]};var colorValue=datum.marker.color||"#0000FF";if(Array.isArray(colorValue)){colorValue=colorValue.length>0?colorValue[0]:"#0000FF"}if(viz.clusterCircles==="line"){shape.line={color:VizUtil.hexToRgba(colorValue,.8),width:1}}else if(viz.clusterCircles==="fill"){shape.fillcolor=VizUtil.hexToRgba(colorValue,.2);shape.line={color:VizUtil.hexToRgba(colorValue,.2),width:1}}layout.shapes.push(shape)}})}if(marker==="scatter"&&!isMultiY&&viz.xAxisDataTypeDetection!=="on"){gRefLineUpperRangeLayerData=consolidateRefLines(gRefLineUpperRangeLayerData);gRefLineLowerRangeLayerData=consolidateRefLines(gRefLineLowerRangeLayerData);gRefLineLayerData=consolidateRefLines(gRefLineLayerData);gVRefLineLayerData=consolidateRefLines(gVRefLineLayerData)}gRefLineUpperRangeLayerData=gRefLineUpperRangeLayerData.filter(function(d){return d.x.length>0&&d.y.length>0});gRefLineLowerRangeLayerData=gRefLineLowerRangeLayerData.filter(function(d){return d.x.length>0&&d.y.length>0});gRefLineLayerData=gRefLineLayerData.filter(function(d){return d.x.length>0&&d.y.length>0&&d.visible!==false});gVRefLineConfIntLayerData=gVRefLineConfIntLayerData.filter(function(d){return d.x.length>0&&d.y.length>0});gVRefLineLayerData=gVRefLineLayerData.filter(function(d){return d.x.length>0&&d.y.length>0&&d.visible!==false});recalculateRefLineData(viz,gRefLineLayerData,layout,formatRefLineValueHash);recalculateRefLineData(viz,gRefLineUpperRangeLayerData,layout,formatRefLineValueHash);recalculateRefLineData(viz,gRefLineLowerRangeLayerData,layout,formatRefLineValueHash);recalculateVRefLineData(viz,gVRefLineLayerData,layout,formatVRefLineValueHash);layout.showlegend=!(!viz.color&&numY<2&&gRefLineLayerData.filter(function(g){return g.showlegend}).length===0&&gVRefLineLayerData.filter(function(g){return g.showlegend}).length===0);if(viz.legendLocation==="none"){layout.showlegend=false}if(label&&viz.xAxisDataTypeDetection!=="on"&&viz.scatterSplitLineByLabel==="on"){PlotlyGraphGenerator._convertGraphDataForScatterLineGroupedByLabel(gData)}else{gData.forEach(function(g){if(g.mode==="lines"){var cx=[],cy=[],ctxt=[];if(g&&g.y){g.y.forEach(function(yval,index){if(!VizUtil.isEmpty(yval)&&!VizUtil.isEmpty(g.x[index])){cy.push(yval);cx.push(g.x[index]);if(g.text){ctxt.push(g.text[index])}}})}g.x=cx;g.y=cy;if(ctxt.length>0){g.text=ctxt}}})}if(useHighlightScale){PlotlyGraphGenerator._sortGraphDataByHighlight(gData,colorScale,true);layout.legend.traceorder="reversed"}if(viz.reverseGraphLayerOrder||allowMultiYAndColor){gData.reverse()}if(VizUtil.returnsCharacterValue(viz.x)&&viz.y&&VizUtil.returnsCharacterValue(viz.y)){PlotlyGraphGenerator._removeRowsForOrder(gData);gData.unshift(PlotlyGraphGenerator._createOrderControlLayer(data,viz))}gDataFiltered=[].concat(gData).concat(gTrendLineRangeLayerData.filter(function(d){return d.x.length>0&&d.y.length>0})).concat(gVRefLineConfIntLayerData.filter(function(d){return d.x.length>0&&d.y.length>0})).concat(gRangeLayerData.filter(function(d){return d.x.length>0&&d.y.length>0})).concat(gRefLineUpperRangeLayerData.filter(function(d){return d.x.length>0&&d.y.length>0})).concat(gRefLineLowerRangeLayerData.filter(function(d){return d.x.length>0&&d.y.length>0})).concat(gRefLineLayerData.filter(function(d){return d.x.length>0&&d.y.length>0&&d.visible!==false})).concat(gVRefLineLayerData.filter(function(d){return d.x.length>0&&d.y.length>0&&d.visible!==false})).concat(gTrendLineLayerData.filter(function(d){return d.x.length>0&&d.y.length>0}));if(!!onBeforeRenderingCallback&&typeof onBeforeRenderingCallback==="function"){onBeforeRenderingCallback({marker:marker,gData:gDataFiltered,layout:layout,config:config})}if(divElem){Plotly.newPlot(divElem,gDataFiltered,layout,config);PlotlyGraphGenerator._addCustomBalloon(divElem,onShowDetailCallback,onKeepThisCallback,onExcludeCallback)}break;case"hist":case"bar":case"errbar":if(!viz.x){layout.xaxis.showticklabels=false}else{if(viz.x.func==="aschar"||!viz.x.isNumeric&&!viz.x.isDate){layout.xaxis.type="category"}else if(/^(bar|errbar)$/.test(marker)){if(viz.xAxisAutomaticNumOfTicks!=="off"){}else{layout.xaxis.nticks=countNumberOfBars(gData)+1}}}if(barPadding){layout.bargap=barPadding}if(marker==="hist"){barstyle="overlay"}if(marker==="errbar"){layout.barmode="group";if(viz.x&&viz.color&&viz.x.name===viz.color.name){layout.barmode="stack"}gData=gData.map(function(datum){datum.type=errbarGraph==="bar"?"bar":"scatter";datum.mode=errbarGraph==="bar"?null:"markers";datum.hoverinfo="text";return datum})}else{layout.barmode=barstyle;gData=gData.map(function(datum){if(!datum.type){datum.type="bar"}datum.hoverinfo="text";return datum})}if(facet){constructFacetData(viz,gData,layout,colorarr&&colorarr.length>0?colorarr[0]:null,null,null,null,colsOn2ndAxis,gRefLineLayerData,gRefLineUpperRangeLayerData,gRefLineLowerRangeLayerData,gVRefLineLayerData,gVRefLineConfIntLayerData);if(!x){gData.forEach(function(g){if(!g.x){g.x=g.y.map(function(){return"x"})}})}var syncYAxis=viz.facetSyncYAxis!=="off";if(!viz.facetSyncYAxis&&viz.facetEnableDataCompletion==="off"){syncYAxis=false}if(marker==="bar"&&barstyle==="stack"&&color&&syncYAxis){var _arr=[];nestData.forEach(function(d){var gbysums=d.values.map(function(v){return v[y+".gbysum"]!==undefined?v[y+".gbysum"]:v[y]});_arr=_arr.concat(gbysums)});_arr.push(0);var _facetColorStackYRange=d3.extent(_arr);if(viz.yAxisScale==="log"){_facetColorStackYRange[0]=Math.log10(Math.max(0,_facetColorStackYRange[0]));_facetColorStackYRange[1]=Math.log10(Math.max(0,_facetColorStackYRange[1]))}Object.keys(layout).forEach(function(key){if(/^yaxis/.test(key)){layout[key].range=_facetColorStackYRange}})}}else{if(yValueOnPlot!=="none"&&/^(bar|hist)$/.test(marker)){if(barstyle==="stack"){gData=calculateStackedYValue(gData)}annotationContext=[];var numOfTraces=gData.length;var pivot=Math.floor(numOfTraces/2);var delta=.8/numOfTraces;var dateX,offset;gData.forEach(function(group,gidx){if(marker==="bar"&&barstyle==="group"&&viz.color&&(!viz.x||viz.x&&viz.x.name!==viz.color.name)||marker==="bar"&&barstyle==="group"&&numY>1){if(x){var allUnique=isAllUnique(group.x);var xidx=-1;annotationContext=annotationContext.concat(group.x.map(function(xval,idx){if(group._orderRow&&group._orderRow[idx]){return null}else{xidx++}offset=gidx-pivot;if(numOfTraces%2===0){offset+=.5}var xValue=xidx+offset*delta;if(VizUtil.returnsNumericValue(viz.x)&&viz.x.func!=="ascategory"){xValue=xval+offset*delta}else if(VizUtil.returnsDateValue(viz.x)){dateX=Date.parse(xval.indexOf(" ")===-1?xval+" 00:00:00":xval);var datefunc=allUnique?"":viz.x.func;switch(datefunc){case"rtoyear":xValue=dateX+offset*delta*31536e6;break;case"rtoq":xValue=dateX+offset*delta*7776e6;break;case"rtomon":xValue=dateX+offset*delta*2592e6;break;case"rtoweek":xValue=dateX+offset*delta*6048e5;break;case"rtoday":xValue=dateX+offset*delta*864e5;break;case"rtohour":xValue=dateX+offset*delta*36e5;break;case"rtomin":xValue=dateX+offset*delta*6e5;break;case"rtosec":xValue=dateX+offset*delta*1e3;break;default:xValue=dateX+offset*delta;break}}var yValue=group.stacky?group.stacky[idx]:group.y[idx];return{x:xValue,y:yValue,text:y1ValuePrefix+formatValue(group.y[idx])+y1ValueSuffix,xanchor:"center",yanchor:yValueOnPlot,showarrow:false}}).filter(function(x){return x!==null}))}else{offset=gidx-pivot;if(numOfTraces%2===0){offset+=.5}var xValue=0+offset*delta;annotationContext=annotationContext.concat([{x:xValue,y:group.stacky?group.stacky[0]:group.y[0],text:group.y[0]===0?"":y1ValuePrefix+formatValue(group.y[0])+y1ValueSuffix,xanchor:"center",yanchor:yValueOnPlot,showarrow:false}])}}else{if(viz.x){annotationContext=annotationContext.concat(group.x.map(function(xval,idx){return{x:xval,y:group.stacky?group.stacky[idx]:group.y[idx],text:group.y[idx]===0?"":y1ValuePrefix+formatValue(group.y[idx])+y1ValueSuffix,xanchor:"center",yanchor:yValueOnPlot,showarrow:false}}))}else{annotationContext=annotationContext.concat([{x:0,y:group.stacky?group.stacky[0]:group.y[0],text:group.y[0]===0?"":y1ValuePrefix+formatValue(group.y[0])+y1ValueSuffix,xanchor:"center",yanchor:yValueOnPlot,showarrow:false}])}}});if(viz.yValueOnPlotFontSize){annotationContext.forEach(function(ctx){ctx.font={size:viz.yValueOnPlotFontSize}})}layout.annotations=annotationContext}if(marker==="bar"){if(viz.yAxisIncludeZero!=="off"&&/^(circle|line)$/.test(viz.yMarkerShape)){if(layout.yaxis.range){layout.yaxis.range=d3.extent(layout.yaxis.range.concat([0]))}else{layout.yaxis.range=calculateRange(gData,"y",viz.yAxisScale,true,false,marker,null,null,null,null,null,"y1",.04,.04)}if(userYAxisRange&&viz.y&&VizUtil.returnsNumericValue(viz.y)){layout.yaxis.range=userYAxisRange}}if(colsOn2ndAxis&&colsOn2ndAxis.length>0&&viz.y2AxisIncludeZero!=="off"&&/^(circle|line)$/.test(viz.y1MarkerShape)){if(layout.yaxis2.range){layout.yaxis2.range=d3.extent(layout.yaxis2.range.concat([0]))}else{layout.yaxis2.range=calculateRange(gData,"y",viz.yAxisScale,true,false,marker,null,null,null,null,null,"y2",.04,.04)}if(userY2AxisRange&&viz.y&&VizUtil.returnsNumericValue(viz.y)){layout.yaxis2.range=userY2AxisRange}}}}if(marker==="bar"&&barstyle==="stack"&&viz.orientation!=="horizontal"&&color){layout.legend.traceorder="reversed";if(!useHighlightScale&&!(colorbucket&&viz.colorBucketType==="bucket_outlier"&&viz.colorStackDirection!=="normal")){PlotlyGraphGenerator.reverseColorOrder(gData)}}if(barstyle==="group"&&gData.filter(function(g){return g.use2ndAxis&&!/^(lines|markers)$/.test(g.mode)}).length>0){var gDualYedData=[];gData.forEach(function(g){if(g.use2ndAxis){gDualYedData.push({x:[g.x&&g.x.length>0?g.x[0]:0],y:[0],type:"bar",hoverinfo:"none",showlegend:false,yaxis:getCorrespondingYAxis(g.yaxis,!!facet),xaxis:g.xaxis});gDualYedData.push(g)}else{gDualYedData.push(g);gDualYedData.push({x:[g.x&&g.x.length>0?g.x[0]:0],y:[0],type:"bar",hoverinfo:"none",showlegend:false,yaxis:getCorrespondingYAxis(g.yaxis,!!facet),xaxis:g.xaxis})}});gData=gDualYedData}if(orientation==="horizontal"&&marker==="bar"){PlotlyGraphGenerator._switchOrientation(gData,layout)}if(marker==="hist"){viz.y=VizUtil.NUMROWS_COL_TEMPLATE;gVRefLineLayerData=consolidateRefLines(gVRefLineLayerData)}if(marker==="bar"&&!isMultiY){gRefLineUpperRangeLayerData=consolidateRefLines(gRefLineUpperRangeLayerData);gRefLineLowerRangeLayerData=consolidateRefLines(gRefLineLowerRangeLayerData);gRefLineLayerData=consolidateRefLines(gRefLineLayerData);gVRefLineLayerData=consolidateRefLines(gVRefLineLayerData)}gRefLineUpperRangeLayerData=gRefLineUpperRangeLayerData.filter(function(d){return d.x.length>0&&d.y.length>0});gRefLineLowerRangeLayerData=gRefLineLowerRangeLayerData.filter(function(d){return d.x.length>0&&d.y.length>0});gRefLineLayerData=gRefLineLayerData.filter(function(d){return d.x.length>0&&d.y.length>0&&d.visible!==false});gVRefLineConfIntLayerData=gVRefLineConfIntLayerData.filter(function(d){return d.x.length>0&&d.y.length>0});gVRefLineLayerData=gVRefLineLayerData.filter(function(d){return d.x.length>0&&d.y.length>0&&d.visible!==false});recalculateRefLineData(viz,gRefLineLayerData,layout,formatRefLineValueHash);recalculateRefLineData(viz,gRefLineUpperRangeLayerData,layout,formatRefLineValueHash);recalculateRefLineData(viz,gRefLineLowerRangeLayerData,layout,formatRefLineValueHash);recalculateVRefLineData(viz,gVRefLineLayerData,layout,formatVRefLineValueHash);layout.showlegend=!(!viz.color&&numY<2&&gRefLineLayerData.filter(function(g){return g.showlegend}).length===0&&gVRefLineLayerData.filter(function(g){return g.showlegend}).length===0);if(orientation==="horizontal"&&marker==="bar"){gRefLineLayerData.forEach(function(g){if(g.x&&g.y){var x=g.x;g.x=g.y;g.y=x}})}
if(viz.legendLocation==="none"){layout.showlegend=false}if(useHighlightScale){if(marker==="bar"&&barstyle==="stack"){PlotlyGraphGenerator._sortGraphDataByHighlight(gData,colorScale,false,true)}else if(marker==="hist"){PlotlyGraphGenerator._sortGraphDataByHighlight(gData,colorScale,true);layout.legend.traceorder="reversed"}else{PlotlyGraphGenerator._sortGraphDataByHighlight(gData,colorScale,false)}}if(marker==="hist"){gData.forEach(function(g){if(g&&g.customdata){g.customdata.some(function(d){return d.some(function(op){if(op&&op.type==="x"&&!VizUtil.isEmpty(op.rawValue)&&!VizUtil.isEmpty(op.histRange)){op.includeEdge="both";return true}return false})})}})}gDataFiltered=[].concat(gData).concat(gRefLineUpperRangeLayerData.filter(function(d){return d.x.length>0&&d.y.length>0})).concat(gRefLineLowerRangeLayerData.filter(function(d){return d.x.length>0&&d.y.length>0})).concat(gRefLineLayerData.filter(function(d){return d.x.length>0&&d.y.length>0&&d.visible!==false})).concat(gVRefLineLayerData.filter(function(d){return d.x.length>0&&d.y.length>0&&d.visible!==false}));if(!!onBeforeRenderingCallback&&typeof onBeforeRenderingCallback==="function"){onBeforeRenderingCallback({marker:marker,gData:gDataFiltered,layout:layout,config:config})}if(divElem){if(marker==="hist"&&gData.filter(function(g){return g&&g.x&&g.x.indexOf("NA")===-1}).length===0){VizUtil.renderNoData(divElem,"Histogram is not generated because all the values for the X-Axis column are NA.");return}Plotly.newPlot(divElem,gDataFiltered,layout,config);PlotlyGraphGenerator._addCustomBalloon(divElem,onShowDetailCallback,onKeepThisCallback,onExcludeCallback)}break;case"line":case"bubble":case"densityplot":if(marker==="line"&&viz.x&&(VizUtil.returnsCharacterValue(viz.x)||viz.x.func==="ascategory")){layout.xaxis.type="category"}if(marker==="bubble"){if(viz.x&&(VizUtil.returnsCharacterValue(viz.x)||viz.x.func==="ascategory")){layout.xaxis.type="category"}if(viz.y&&(VizUtil.returnsCharacterValue(viz.y)||viz.y.func==="ascategory")){layout.yaxis.type="category"}}gData=gData.map(function(datum){datum.type=datum.type||"scatter";datum.mode=datum.mode||"lines";datum.hoverinfo="text";if(marker==="densityplot"){if(viz.fillLine==="on"){datum.fill="tozeroy";datum.fillcolor=VizUtil.hexToRgba(isArray(datum.marker.color)?quantColorPalette[quantColorPalette.length-1]:datum.marker.color,opacity);datum.marker.opacity=null}datum.opacity=null;if(!datum.line){datum.line={}}datum.line.shape="spline";datum.line.smoothing=.5}if(marker==="bubble"&&labelOnPlot==="on"&&label){datum.mode+="+text";datum.textposition=labelOnPlotVAlign+" "+labelOnPlotHAlign;datum.hoverinfo="x+y+z";if(viz.yValueOnPlotFontSize){datum.textfont={size:viz.yValueOnPlotFontSize}}}if(marker==="bubble"){datum.marker.sizemode="diameter";datum.marker.sizemin=circleMinSize/2;if(!datum.marker.size){datum.marker.size=circleMinSize}}return datum});if(facet){constructFacetData(viz,gData,layout,colorarr&&colorarr.length>0?colorarr[0]:null,gRangeLayerData,gTrendLineLayerData,gTrendLineRangeLayerData,colsOn2ndAxis,gRefLineLayerData,gRefLineUpperRangeLayerData,gRefLineLowerRangeLayerData,gVRefLineLayerData,gVRefLineConfIntLayerData)}else{if(/^(bubble)$/.test(marker)&&viz.xAxisIncludeZero==="on"){layout.xaxis.range=calculateRange(gData.concat(gRangeLayerData).concat(gTrendLineLayerData).concat(gTrendLineRangeLayerData).concat(gRefLineLayerData).concat(gRefLineUpperRangeLayerData).concat(gRefLineLowerRangeLayerData),"x",viz.xAxisScale,true,false,marker,yValueOnPlot,false,barstyle,color,isMultiY,"x")}var _includeZeroOnYAxis=/^(bubble)$/.test(marker)&&viz.yAxisIncludeZero==="on"||marker==="line"&&viz.yAxisIncludeZero!=="off";layout.yaxis.range=calculateRange(gData.concat(gRangeLayerData).concat(gTrendLineLayerData).concat(gTrendLineRangeLayerData).concat(gRefLineLayerData).concat(gRefLineUpperRangeLayerData).concat(gRefLineLowerRangeLayerData),"y",viz.yAxisScale,_includeZeroOnYAxis,false,marker,null,null,null,null,null,"y1");if(userYAxisRange&&viz.y&&VizUtil.returnsNumericValue(viz.y)){layout.yaxis.range=userYAxisRange}if(colsOn2ndAxis&&colsOn2ndAxis.length>0){var _includeZeroOnY2Axis=/^(bubble)$/.test(marker)&&viz.y2AxisIncludeZero==="on"||marker==="line"&&viz.y2AxisIncludeZero!=="off";layout.yaxis2.range=calculateRange(gData.concat(gRangeLayerData).concat(gTrendLineLayerData).concat(gTrendLineRangeLayerData).concat(gRefLineLayerData).concat(gRefLineUpperRangeLayerData).concat(gRefLineLowerRangeLayerData),"y",viz.y2AxisScale,_includeZeroOnY2Axis,false,marker,null,null,null,null,null,"y2");if(userY2AxisRange&&viz.y&&VizUtil.returnsNumericValue(viz.y)){layout.yaxis2.range=userY2AxisRange}}if(marker==="line"&&viz.x&&!viz.facet&&VizUtil.returnsDateValue(viz.x)&&viz.xAxisShowRangeSlider==="on"){layout.xaxis.type="date";layout.xaxis.rangeslider={range:calculateRange(gData.concat(gRangeLayerData).concat(gTrendLineLayerData).concat(gTrendLineRangeLayerData).concat(gRefLineLayerData).concat(gRefLineUpperRangeLayerData).concat(gRefLineLowerRangeLayerData),"x",viz.xAxisScale,true,false,marker,yValueOnPlot,false,barstyle,color,isMultiY,"x")}}if(yValueOnPlot!=="none"&&marker==="line"){annotationContext=[];gData.forEach(function(group){if(group.x){annotationContext=annotationContext.concat(group.x.map(function(x,idx){return{x:x,y:group.y[idx],xref:group.xaxis?group.xaxis:"x",yref:group.yaxis?group.yaxis:"x",text:group.y[idx]===0?"":y1ValuePrefix+formatValue(group.y[idx])+y1ValueSuffix,xanchor:"center",yanchor:yValueOnPlot,showarrow:false}}))}else if(group.y&&group.y.length>0){annotationContext=annotationContext.concat({x:0,y:group.y[0],xref:group.xaxis?group.xaxis:"x",yref:group.yaxis?group.yaxis:"x",text:group.y[0]===0?"":y1ValuePrefix+formatValue(group.y[0])+y1ValueSuffix,xanchor:"center",yanchor:yValueOnPlot,showarrow:false})}});if(viz.yValueOnPlotFontSize){annotationContext.forEach(function(ctx){ctx.font={size:viz.yValueOnPlotFontSize}})}layout.annotations=annotationContext}}if(/^(bubble|densityplot)$/.test(marker)){gRefLineUpperRangeLayerData=consolidateRefLines(gRefLineUpperRangeLayerData);gRefLineLowerRangeLayerData=consolidateRefLines(gRefLineLowerRangeLayerData);gRefLineLayerData=consolidateRefLines(gRefLineLayerData)}if(/^(line|bubble|densityplot)$/.test(marker)){gVRefLineLayerData=consolidateRefLines(gVRefLineLayerData)}gRefLineUpperRangeLayerData=gRefLineUpperRangeLayerData.filter(function(d){return d.x.length>0&&d.y.length>0});gRefLineLowerRangeLayerData=gRefLineLowerRangeLayerData.filter(function(d){return d.x.length>0&&d.y.length>0});gRefLineLayerData=gRefLineLayerData.filter(function(d){return d.x.length>0&&d.y.length>0&&d.visible!==false});gVRefLineConfIntLayerData=gVRefLineConfIntLayerData.filter(function(d){return d.x.length>0&&d.y.length>0});gVRefLineLayerData=gVRefLineLayerData.filter(function(d){return d.x.length>0&&d.y.length>0&&d.visible!==false});recalculateRefLineData(viz,gRefLineLayerData,layout,formatRefLineValueHash);recalculateRefLineData(viz,gRefLineUpperRangeLayerData,layout,formatRefLineValueHash);recalculateRefLineData(viz,gRefLineLowerRangeLayerData,layout,formatRefLineValueHash);recalculateVRefLineData(viz,gVRefLineLayerData,layout,formatVRefLineValueHash);layout.showlegend=!(!viz.color&&numY<2&&gRefLineLayerData.filter(function(g){return g.showlegend}).length===0&&gVRefLineLayerData.filter(function(g){return g.showlegend}).length===0);if(viz.legendLocation==="none"){layout.showlegend=false}PlotlyGraphGenerator._removeNAValues(gData,viz);if(marker==="line"&&viz.color&&(!viz.yCompleteInstruction||viz.yCompleteInstruction==="none")){gData.forEach(PlotlyGraphGenerator._removeNAValuesFromGraphData)}if(marker==="bubble"&&viz.color&&VizUtil.isContinuousValue(viz.color,marker,"color")){gData=gData.filter(function(g){return g.name!==NA_LABEL})}if(useHighlightScale){PlotlyGraphGenerator._sortGraphDataByHighlight(gData,colorScale,true);layout.legend.traceorder="reversed"}gDataFiltered=[].concat(gData).concat(gTrendLineRangeLayerData.filter(function(d){return d.x.length>0&&d.y.length>0})).concat(gVRefLineConfIntLayerData.filter(function(d){return d.x.length>0&&d.y.length>0})).concat(gRangeLayerData.filter(function(d){return d.x.length>0&&d.y.length>0})).concat(gRefLineUpperRangeLayerData.filter(function(d){return d.x.length>0&&d.y.length>0})).concat(gRefLineLowerRangeLayerData.filter(function(d){return d.x.length>0&&d.y.length>0})).concat(gRefLineLayerData.filter(function(d){return d.x.length>0&&d.y.length>0&&d.visible!==false})).concat(gVRefLineLayerData.filter(function(d){return d.x.length>0&&d.y.length>0&&d.visible!==false})).concat(gTrendLineLayerData.filter(function(d){return d.x.length>0&&d.y.length>0}));if(!!onBeforeRenderingCallback&&typeof onBeforeRenderingCallback==="function"){onBeforeRenderingCallback({marker:marker,gData:gDataFiltered,layout:layout,config:config})}if(marker==="bubble"){Object.keys(layout).forEach(function(key){if(/xaxis[1-9]/.test(key)&&layout[key].title===NA_LABEL){var name=key.replace("xaxis","x");gDataFiltered=gDataFiltered.filter(function(g){return g.xaxis!==name})}})}if(divElem){Plotly.newPlot(divElem,gDataFiltered,layout,config);if(marker!=="densityplot"){PlotlyGraphGenerator._addCustomBalloon(divElem,onShowDetailCallback,onKeepThisCallback,onExcludeCallback)}}break;case"area":if(viz.x&&(VizUtil.returnsCharacterValue(viz.x)||viz.x.func==="ascategory")){layout.xaxis.type="category"}gData=gData.map(function(datum,idx){datum.fill=idx===0?"tozeroy":"tonexty";datum.type="scatter";datum.mode="none";datum.hoverinfo="text";datum.fillcolor=VizUtil.hexToRgba(datum.marker.color||"#1f77b4",opacity||.68);if(datum.y&&isArray(datum.y)&&datum.text&&isArray(datum.text)){datum.y.forEach(function(yvalue,idx){if(yvalue===0){datum.text[idx]=null}})}return datum});if(facet){constructFacetData(viz,gData,layout,colorarr&&colorarr.length>0?colorarr[0]:null)}else{gData=convertToStackedYValue(gData);layout.yaxis.range=calculateRange(gData,"y",viz.yAxisScale,true,false,marker,null,null,null,null,null,"y1");if(userYAxisRange&&viz.y&&VizUtil.returnsNumericValue(viz.y)){layout.yaxis.range=userYAxisRange}if(yValueOnPlot!=="none"){annotationContext=[];gData.forEach(function(group){annotationContext=annotationContext.concat(group.x.map(function(x,idx){return{x:x,y:group.y[idx],xref:group.xaxis?group.xaxis:"x",yref:group.yaxis?group.yaxis:"x",text:group.origy[idx]===0?"":y1ValuePrefix+formatValue(group.origy[idx])+y1ValueSuffix,xanchor:"center",yanchor:yValueOnPlot,showarrow:false}}))});if(viz.yValueOnPlotFontSize){annotationContext.forEach(function(ctx){ctx.font={size:viz.yValueOnPlotFontSize}})}layout.annotations=annotationContext}}if(color&&viz.orientation!=="horizontal"){layout.legend.traceorder="reversed";if(!useHighlightScale&&!(colorbucket&&viz.colorBucketType==="bucket_outlier"&&viz.colorStackDirection!=="normal")){PlotlyGraphGenerator.reverseColorOrder(gData)}}if(!!onBeforeRenderingCallback&&typeof onBeforeRenderingCallback==="function"){onBeforeRenderingCallback({marker:marker,gData:gData,layout:layout,config:config})}if(divElem){Plotly.newPlot(divElem,gData,layout,config);PlotlyGraphGenerator._addCustomBalloon(divElem,onShowDetailCallback,onKeepThisCallback,onExcludeCallback)}break;case"pie":var _pieDataHash={},_pieDataList=[],_xaxis,_yaxis;if(facet){constructFacetData(viz,gData,layout,colorarr&&colorarr.length>0?colorarr[0]:null)}gData.forEach(function(d){var hashkey=(d.xaxis||"")+(d.yaxis||"");var pieData=_pieDataHash[hashkey];if(!pieData){pieData={values:[],_realvalues:[],labels:[],text:[],hovertext:[],customdata:[],type:"pie",textinfo:"text",textposition:[],hoverinfo:"text",marker:{colors:[]},sort:false,textfont:{},hole:pieHole,direction:"clockwise"};if(viz.plotAreaFontSize){pieData.textfont.size=viz.plotAreaFontSize}_pieDataHash[hashkey]=pieData;_pieDataList.push(pieData)}if(d.xaxis&&d.yaxis){_xaxis=layout[d.xaxis.replace(/^x/,"xaxis")];_yaxis=layout[d.yaxis.replace(/^y/,"yaxis")];pieData.domain={x:_xaxis.domain,y:_yaxis.domain};pieData._xref=d.xaxis;pieData._yref=d.yaxis;pieData._titleText=_xaxis.title;pieData._titleFontSize=_xaxis.titlefont?_xaxis.titlefont.size:null}i=d.y[d.y.length-1]||0;pieData._realvalues.push(i);if(i<0){i=Math.abs(i)}pieData.values.push(i);pieData.hovertext.push(d.text[d.text.length-1]);pieData.customdata.push(d.customdata[d.customdata.length-1]);pieData.labels.push(d.name);pieData.marker.colors.push(VizUtil.hexToRgba(d.marker.color,opacity||.8))});_pieDataList.forEach(function(d){d._summary=d._realvalues.reduce(function(acc,cur){return acc+cur});var sum=d.values.reduce(function(acc,cur){return acc+cur});d.pcts=d.values.map(function(v){return v/sum*100});d.text=d._realvalues.map(function(v,idx){var textinfo=[];if(viz.pieShowPercentages!=="off"){textinfo.push(formatValue(d.pcts[idx])+"%")}if(viz.pieShowValues==="on"){textinfo.push(formatValue(v))}if(viz.pieShowLabels==="on"){textinfo.push(d.labels[idx])}return textinfo.join("<br>")});d.hovertext=d.hovertext.map(function(v,idx){if(!v){return""}var arr=v.split("<br>");arr[0]+=" ("+formatValue(d.pcts[idx])+"%)";return arr.join("<br>")});d.textposition=d.pcts.map(function(v){return v<5?"none":"auto"})});if(!color){layout.showlegend=false;_pieDataList.forEach(function(d){d.labels[0]=viz.y.name})}Object.keys(layout).forEach(function(key){if(/^(xaxis|yaxis)/.test(key)){layout[key].showticklabels=false;layout[key].showline=false;layout[key].showgrid=false;layout[key].zeroline=false;layout[key].showspikes=false;layout[key].fixedrange=true;layout[key].nticks=0;if(/^yaxis/.test(key)||/^xaxis/.test(key)&&pieHole!==0){layout[key].visible=false;layout[key].title=""}}});delete layout.scene;if(pieHole!==0){layout.annotations=_pieDataList.map(function(d){var _title=xAxisShowTitle?d._titleText||(viz.y.name===VizUtil.NUMROWS_COL_NAME?VizUtil.NUMROWS_COL_LABEL:viz.y.name):"";return{font:{size:d._titleFontSize||(d.domain?12:14)},showarrow:false,text:_title+"<br>"+formatValue(d._summary),x:d.domain?d3.mean(d.domain.x):.5,y:d.domain?d3.mean(d.domain.y):.5,xref:"paper",yref:"paper",xanchor:"center",yanchor:"middle",align:"center"}})}gDataFiltered=_pieDataList.filter(function(d){var res=false;for(i=0,l=d.values.length;i<l;i++){if(typeof d.values[i]!=="undefined"&&d.values[i]!==null&&d.values[i]!==0){res=true;break}}return res});if(gDataFiltered.length===0&&targetElem){VizUtil.renderNoData(targetElem)}else{if(!!onBeforeRenderingCallback&&typeof onBeforeRenderingCallback==="function"){onBeforeRenderingCallback({marker:marker,gData:_pieDataList,layout:layout,config:config})}if(divElem){Plotly.newPlot(divElem,_pieDataList,layout,config);PlotlyGraphGenerator._addCustomBalloon(divElem,onShowDetailCallback,onKeepThisCallback,onExcludeCallback)}}break;case"boxplot":if(!viz.x){layout.yaxis.title=""}else{if(VizUtil.returnsCharacterValue(viz.x)||viz.x.func==="ascategory"){layout.xaxis.type="category"}}gData=gData.map(function(datum,idx){datum.type="box";if(!viz.x){datum.x=datum.x.map(function(){return viz.y.name})}datum.boxpoints=false;return datum});if(useOverlayMode(viz.x,viz.color,viz.facet,viz.marker)){layout.boxmode="overlay"}else{layout.boxmode="group"}if(viz.boxplotLayoutMode){layout.boxmode=viz.boxplotLayoutMode}if(facet){constructFacetData(viz,gData,layout)}if(useHighlightScale){PlotlyGraphGenerator._sortGraphDataByHighlight(gData,colorScale,false)}if(!!onBeforeRenderingCallback&&typeof onBeforeRenderingCallback==="function"){onBeforeRenderingCallback({marker:marker,gData:gData,layout:layout,config:config})}if(divElem){Plotly.newPlot(divElem,gData,layout,config)}break;case"violin":if(!viz.x){layout.yaxis.title=""}else{if(VizUtil.returnsCharacterValue(viz.x)||viz.x.func==="ascategory"){layout.xaxis.type="category"}}layout.hovermode="closest";if(useOverlayMode(viz.x,viz.color,viz.facet,viz.marker)){layout.violinmode="overlay"}else{layout.violinmode="group"}if(viz.violinLayoutMode){layout.violinmode=viz.violinLayoutMode}var vPoints=viz.violinShowAllPoints==="on"?"all":viz.includeOutlier==="on"?"outliers":"none";if(vPoints!=="all"){layout.violingap=.1;layout.violingroupgap=.1}if(vPoints==="none"){vPoints=false}var vShowBoxplot=viz.violinShowBoxplot!=="off";var vShowMeanLine=viz.violinShowMeanLine!=="off";var vJitter=viz.violinJitter?parseFloat(viz.violinJitter):null;var vPointOpacity=viz.violinPointOpacity?parseFloat(viz.violinPointOpacity):VizUtil.DEFAULT_VIOLIN_POINT_OPACITY;gData=gData.map(function(datum,idx){datum.type="violin";datum.box={visible:vShowBoxplot};datum.meanline={visible:vShowMeanLine};datum.points=vPoints;if(vJitter!==null){datum.jitter=vJitter}if(!datum.marker){datum.marker={}}datum.marker.opacity=vPointOpacity;return datum});if(facet){constructFacetData(viz,gData,layout)}if(useHighlightScale){PlotlyGraphGenerator._sortGraphDataByHighlight(gData,colorScale,false)}if(!!onBeforeRenderingCallback&&typeof onBeforeRenderingCallback==="function"){onBeforeRenderingCallback({marker:marker,gData:gData,layout:layout,config:config})}if(divElem){Plotly.newPlot(divElem,gData,layout,config)}break;case"scattermatrix":var xAxisTemplate={showline:false,zeroline:false,showgrid:true,titlefont:{size:layout.xaxis.titlefont.size},tickfont:{}};if(layout.xaxis.tickfont.size){xAxisTemplate.tickfont.size=layout.xaxis.tickfont.size}if(viz.showXGridLines&&viz.showXGridLines!=="default"){xAxisTemplate.showgrid=viz.showXGridLines==="on"}if(viz.showXZeroLine&&viz.showXZeroLine!=="default"){xAxisTemplate.zeroline=viz.showXZeroLine==="on"}var yAxisTemplate={showline:false,zeroline:false,showgrid:true,titlefont:{size:layout.yaxis.titlefont.size},tickfont:{}};if(layout.yaxis.tickfont.size){yAxisTemplate.tickfont.size=layout.yaxis.tickfont.size}if(viz.showYGridLines&&viz.showYGridLines!=="default"){yAxisTemplate.showgrid=viz.showYGridLines==="on"}if(viz.showYZeroLine&&viz.showYZeroLine!=="default"){yAxisTemplate.zeroline=viz.showYZeroLine==="on"}ys.forEach(function(y,idx){var axisName="axis"+(idx===0?"":idx+1);layout["x"+axisName]=JSON.parse(JSON.stringify(xAxisTemplate));layout["y"+axisName]=JSON.parse(JSON.stringify(yAxisTemplate))});layout.autosize=false;layout.hovermode="closest";layout.dragmode="select";if(viz.facetSqueezePlots==="off"){var facetWidth=viz.facetWidth?parseInt(viz.facetWidth):180;var facetHeight=viz.facetHeight?parseInt(viz.facetHeight):180;layout.width=facetWidth*ys.length;layout.height=facetHeight*ys.length}if(!!onBeforeRenderingCallback&&typeof onBeforeRenderingCallback==="function"){onBeforeRenderingCallback({marker:marker,gData:gData,layout:layout,config:config})}if(divElem){Plotly.newPlot(divElem,gData,layout,config)}break;case"heatmap":case"contour":layout.xaxis.zeroline=false;layout.xaxis.showgrid=false;layout.yaxis.zeroline=false;layout.yaxis.showgrid=false;if(marker==="heatmap"){layout.xaxis.type="category";layout.yaxis.type="category"}if(gData[0].y.length===1&&gData[0].y[0]===" "){layout.yaxis.ticklen=0}var colorBarRange=viz.colorBarRange?viz.colorBarRange.split(","):[];if(colorBarRange.length!==2||isNaN(colorBarRange[0])||isNaN(colorBarRange[0])){colorBarRange=null}var allDataRange=null;if(facet){constructFacetData(viz,gData,layout);allDataRange=[];data.forEach(function(d){allDataRange.push(d[color])});allDataRange=d3.extent(allDataRange)}else if(viz.colorSetZeroToCenter==="on"){allDataRange=[];data.forEach(function(d){allDataRange.push(d[color])});allDataRange=d3.extent(allDataRange)}if(viz.colorSetZeroToCenter==="on"){var absmin=Math.abs(allDataRange[0]);var absmax=Math.abs(allDataRange[1]);if(absmax>absmin){colorBarRange=[-absmax,absmax]}else{colorBarRange=[-absmin,absmin]}}gData=gData.map(function(datum,idx){datum.type=marker;datum.hoverinfo="text";datum.colorbar={len:viz.colorBarLength||.65};if(colorBarRange){datum.zmin=colorBarRange[0];datum.zmax=colorBarRange[1];datum.zauto=false}else if(facet){datum.zmin=allDataRange[0];datum.zmax=allDataRange[1];datum.zauto=false}if(facet){if(idx===0){datum.colorbar.len=layout.yaxis1.domain[1]-layout.yaxis1.domain[0];datum.colorbar.y=1;datum.colorbar.yanchor="top"}else{datum.showscale=false}}return datum});if(!!onBeforeRenderingCallback&&typeof onBeforeRenderingCallback==="function"){onBeforeRenderingCallback({marker:marker,gData:gData,layout:layout,config:config})}if(divElem){Plotly.newPlot(divElem,gData,layout,config);PlotlyGraphGenerator._addCustomBalloon(divElem,onShowDetailCallback,onKeepThisCallback,onExcludeCallback)}break;case"choropleth":gData=gData.map(function(datum){datum.type=marker;datum.hoverinfo="text";datum.z=datum.marker.color;datum.locations=datum.x;datum.locationmode=mapmode;datum.colorscale=datum.marker.colorscale;datum.showscale=false;datum.marker.line={color:"#ddd",width:.5};layout.margin={b:0,l:0,r:0,t:title?40:10,autoexpand:false,pad:0};switch(mapmode){case"USA-states":layout.geo={scope:"usa",showcoastlines:true,coastlinecolor:"#ccc",showcountries:true,countrycolor:"#ccc",showsubunits:true,subunitcolor:"#ccc",projection:{type:"albers usa"}};break;case"ISO-3":case"country names":layout.geo={showframe:false,showcoastlines:true,coastlinecolor:"#ccc",showcountries:true,countrycolor:"#ccc",projection:{type:"equirectangular"}};break}return datum});if(divElem){Plotly.newPlot(divElem,gData,layout,config)}break;default:console.error("No such graph type supported: "+marker);break}};PlotlyGraphGenerator.getRenderSvgFunction=function(viz,data,onLoadCallback){var func=function(props){viz.width=props.width;viz.height=props.height;var targetElem=props.elem;PlotlyGraphGenerator.render(viz,data,targetElem,"svg",onLoadCallback)};return func};if(typeof module==="object"&&module.exports)module.exports=PlotlyGraphGenerator;var MapGenerator=function(){};var mapBoxConfig={id:"mapbox.light",accessToken:"pk.eyJ1Ijoia3NvYnVlIiwiYSI6ImNpZjhra2MyaDIweWVyeWx6aTI4cnU1eHoifQ.tFW7BQvQXKjdhfWDA66IgQ"};var mapConfig={minCircleSize:5,maxCircleSize:15,lineWidth:3,selectedLineWidth:5,borderWidth:1,selectedBorderWidth:3,pointRadius:5,pointBorderWidth:0,selectedPointBorderWidth:3};var formatValue=VizUtil.valueFormatterGenerator(2,true,true);MapGenerator.createInfoBox=function(){var info=L.control();info.onAdd=function(){this._div=L.DomUtil.create("div","info info-box");this.update();return this._div};info.update=function(values){var html="";if(values){var boxstyle="";var title=null,labels=[],long,lat;values.forEach(function(v){switch(v.type){case"title":title=v;break;case"label":labels.push(v);break;case"long":long=v;break;case"lat":lat=v;break}});if(title){html+='<div class="info-box-title">'+title.value+"</div>"}html+='<div class="info-box-table">';labels=labels.filter(function(label){return!title||title.column.name!==label.column.name});var labelHash={};var filteredLabels=[];labels.forEach(function(label){if(!labelHash[label.column.name+label.column.func]){filteredLabels.push(label);labelHash[label.column.name+label.column.func]=true}});var labelCols=filteredLabels.map(function(label){return label.column.name});filteredLabels=filteredLabels.map(function(label){label.suffix="";if(labelCols.indexOf(label.column.name)!==labelCols.lastIndexOf(label.column.name)&&label.column.func!=="none"){label.suffix=" ("+VizUtil.AGGREGATION_FUNCTION_OPTIONS_HASH[label.column.func]+")"}return label});if(long){html+='<div class="info-box-value '+boxstyle+'">'+'  <div class="label-col">Longitude:</div>'+'  <div class="value-col">'+long.value+"</div>"+"</div>"}if(lat){html+='<div class="info-box-value '+boxstyle+'">'+'  <div class="label-col">Latitude:</div>'+'  <div class="value-col">'+lat.value+"</div>"+"</div>"}filteredLabels.forEach(function(label){html+='<div class="info-box-value '+boxstyle+'">'+'  <div class="label-col">'+(label.column.name===VizUtil.NUMROWS_COL_NAME?VizUtil.NUMROWS_COL_LABEL:label.column.name)+label.suffix+":</div>"+'  <div class="value-col">'+label.value+"</div>"+"</div>"});html+="</div>"}else{html="Hover over or click an area."}this._div.innerHTML=html};return info};MapGenerator.createLegend=function(colorData,catColorScale,colorOpacity,legendType){var uniqs=VizUtil.distinct(colorData);var legend=L.control({position:"bottomright"});if(catColorScale.isHighlightColorScale){uniqs.sort(function(a,b){return catColorScale.getOrderByValue(b)-catColorScale.getOrderByValue(a)})}legend.onAdd=function(){var div=L.DomUtil.create("div","info legend "+legendType);for(var i=0;i<uniqs.length;i++){div.innerHTML+='<div class="legend-row"><i style="background:'+catColorScale(uniqs[i])+"; opacity:"+colorOpacity+' "></i> '+(uniqs[i]||"NA")+"</div>"}return div};return legend};MapGenerator.createCatColorScale=function(viz,numUniqsOnColor){if(viz.enableHighlight==="on"&&viz.color&&!VizUtil.isContinuousValue(viz.color,viz.marker,"color")){return VizUtil.generateHighlightColorScale(viz.highlightDefaultColor||"#DCDEE0",viz.highlightValues||[])}var colorScale=numUniqsOnColor&&numUniqsOnColor>10?d3.scale.category20():d3.scale.category10(),colorarr;var reverseColorPaletteOrderOp=viz.reverseColorPaletteOrder||viz.reverseColorPalleteOrder||"off";if(viz.customCategColorPalette&&viz.customCategColorPalette.length>0&&viz.categColorPalette==="custom"){colorarr=viz.customCategColorPalette.match(VizUtil.COLOR_PALETTE_REGEX).slice();for(var i=0;i<colorarr.length;i++){if(VizUtil.hexToRgb(colorarr[i])===null){colorarr[i]="#CCCCCC"}}if(reverseColorPaletteOrderOp==="on"){colorarr.reverse()}colorScale=d3.scale.ordinal().range(colorarr)}else if(viz.categColorPalette&&viz.categColorPalette!=="default"&&VizUtil.CATEG_COLOR_PALETTES_HASH[viz.categColorPalette]){var ncolors=numUniqsOnColor?Math.min(numUniqsOnColor,10):-1;if(ncolors>0&&VizUtil.colorbrewer[viz.categColorPalette]&&VizUtil.colorbrewer[viz.categColorPalette][ncolors]){colorarr=VizUtil.colorbrewer[viz.categColorPalette][ncolors].slice()}else{colorarr=VizUtil.CATEG_COLOR_PALETTES_HASH[viz.categColorPalette].color.slice()}if(reverseColorPaletteOrderOp==="on"){colorarr.reverse()}colorScale=d3.scale.ordinal().range(colorarr)}else{if(reverseColorPaletteOrderOp==="on"){var colors=colorScale.range().slice();colors.reverse();return d3.scale.ordinal().range(colors)}}return colorScale};MapGenerator._moveHighlightedCirclesToBottom=function(circles,scale){if(!scale.isHighlightColorScale){return}circles.forEach(function(c,idx){var v=scale.getOrderByColor(c.options.fillColor);c.__sortIdx=v===0?idx:-v});circles.sort(function(a,b){return b.__sortIdx-a.__sortIdx})};MapGenerator.createQuantColorScale=function(viz){var bucketType=VizUtil.getBucketType("color",viz);var quantColorPaletteOp=viz.quantColorPalette||VizUtil.getDefaultColorPalette(bucketType)||"Blues";if(!VizUtil.QUANT_COLOR_PALETTES_HASH[quantColorPaletteOp]){quantColorPaletteOp="Blues"}var reverseColorPaletteOrderOp=viz.reverseColorPaletteOrder||"off";var quantColorPalette=VizUtil.QUANT_COLOR_PALETTES_HASH[quantColorPaletteOp].color.slice();if(/^(bucket_kmeans|bucket_equal_width|bucket_equal_freq|bucket_custom)$/.test(bucketType)){var numBuckets=bucketType==="bucket_kmeans"?viz.colorBucketKmeansNumOfBuckets:viz.colorBucketNumOfBuckets;if(bucketType==="bucket_custom"){var customBucketAttrs=VizUtil.constructCustomBucketAttributes(viz.colorBucketCuttingPoints,viz.colorBucketLabels,viz.colorBucketIncludeOutsideRange!=="off",viz.colorBucketIncludeRightEdge!=="off",viz.colorBucketIncludeLowest!=="off",10);numBuckets=customBucketAttrs.expectedNumberOfLabels}if(numBuckets&&VizUtil.colorbrewer[quantColorPaletteOp]&&VizUtil.colorbrewer[quantColorPaletteOp][numBuckets]){quantColorPalette=VizUtil.colorbrewer[quantColorPaletteOp][numBuckets].slice()}}if(reverseColorPaletteOrderOp==="on"){quantColorPalette.reverse()}return d3.scale.ordinal().range(quantColorPalette)};MapGenerator.noKeyMatch=function(data,keyCol,geojson,keyProp){var keycols=data.map(function(d){return d[keyCol]});var keyprops=geojson.features.map(function(feature){return feature.properties[keyProp]});var i,l;for(i=0,l=keycols.length;i<l;i++){if(keyprops.indexOf(keycols[i])!==-1){return false}}return true};MapGenerator.render=function(viz,data,elTarget,geoJSON,onLoadCallback,onErrorCallback,onZoomEndCallback,onMoveEndCallback,noThumbnail,onBeforeRenderingCallback){try{MapGenerator._render(viz,data,elTarget,geoJSON,onLoadCallback,onZoomEndCallback,onMoveEndCallback,noThumbnail,onBeforeRenderingCallback)}catch(e){if(onErrorCallback&&typeof onErrorCallback==="function"){onErrorCallback(e,viz)}if(elTarget){VizUtil.renderNoData(elTarget,"Graph rendering failed.")}console.error(e)}};MapGenerator._render=function(viz,data,elTarget,geoJSON,onLoadCallback,onZoomEndCallback,onMoveEndCallback,noThumbnail,onBeforeRenderingCallback){data=VizUtil.convertColumnarData(data);if(!!onBeforeRenderingCallback&&typeof onBeforeRenderingCallback==="function"){onBeforeRenderingCallback({marker:viz.marker,data:data})}if(!elTarget){return}while(elTarget.childNodes.length>0){elTarget.removeChild(elTarget.firstChild)}if(!data&&!geoJSON||data&&data.length===0){VizUtil.renderNoData(elTarget);if(onLoadCallback&&typeof onLoadCallback==="function"){onLoadCallback()}return}var colorValuePrefix="",colorValueSuffix="",sizeValuePrefix="",sizeValueSuffix="",label1ValuePrefix="",label1ValueSuffix="",label2ValuePrefix="",label2ValueSuffix="",label3ValuePrefix="",label3ValueSuffix="";if(viz.color){colorValuePrefix=VizUtil.getValuePrefix(viz.colorNumberFormatting,viz.colorCurrencySymbol,viz.marker);colorValueSuffix=VizUtil.getValueSuffix(viz.colorWindowFunc,viz.color.func,viz.colorNumberFormatting,viz.marker)}if(viz.size){sizeValuePrefix=VizUtil.getValuePrefix(viz.sizeNumberFormatting,viz.sizeCurrencySymbol,viz.marker);sizeValueSuffix=VizUtil.getValueSuffix(viz.sizeWindowFunc,viz.size.func,viz.sizeNumberFormatting,viz.marker)}if(viz.label){label1ValuePrefix=VizUtil.getValuePrefix(viz.label1NumberFormatting,viz.label1CurrencySymbol,viz.marker);label1ValueSuffix=VizUtil.getValueSuffix(viz.label1WindowFunc,viz.label.func,viz.label1NumberFormatting,viz.marker)}if(viz.label2){label2ValuePrefix=VizUtil.getValuePrefix(viz.label2NumberFormatting,viz.label2CurrencySymbol,viz.marker);label2ValueSuffix=VizUtil.getValueSuffix(viz.label2WindowFunc,viz.label2.func,viz.label2NumberFormatting,viz.marker)}var labelNameMap={};if(viz.x){labelNameMap[viz.x.label]=viz.x.name}if(viz.y){labelNameMap[viz.y.label]=viz.y.name}if(viz.size){labelNameMap[viz.size.label]=viz.size.name}if(viz.color){labelNameMap[viz.color.label]=viz.color.name}if(viz.label){labelNameMap[viz.label.label]=viz.label.name}if(viz.label2){labelNameMap[viz.label2.label]=viz.label2.name}var showLegend=viz.showLegend||"on";var disableDecimalFormatting=!!viz.disableDecimalFormatting;var numDecimalDigits=viz.numDecimalDigits;var useThousandSeparator=viz.useThousandSeparator!=="off";formatValue=VizUtil.valueFormatterGenerator(disableDecimalFormatting?null:numDecimalDigits||2,useThousandSeparator,!numDecimalDigits);var divElem=document.createElement("div");divElem.style.width="100%";divElem.style.height="100%";elTarget.appendChild(divElem);var map=L.map(divElem,{zoomControl:true,preferCanvas:true});if(onLoadCallback&&typeof onLoadCallback==="function"){map.on("load",onLoadCallback)}if(onZoomEndCallback&&typeof onZoomEndCallback==="function"){map.on("zoomend",onZoomEndCallback)}if(onMoveEndCallback&&typeof onMoveEndCallback==="function"){map.on("moveend",onMoveEndCallback)}var geoJSONLayer=null;L.tileLayer("https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}",{maxZoom:18,id:viz.mapType||mapBoxConfig.id,accessToken:mapBoxConfig.accessToken,attribution:'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, '+'<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, '+'Imagery &copy; <a href="http://mapbox.com">Mapbox</a>'}).addTo(map);var colorOpacity=viz.colorOpacity||.65;var quantColorScale=MapGenerator.createQuantColorScale(viz);var catColorScale=MapGenerator.createCatColorScale(viz);var legend=null,colorData=null,colorHash=null,infobox=null;var zoomLevel=null,bounds=null,center=null;if(viz.mapZoomStatus){var arr=viz.mapZoomStatus.split(",");zoomLevel=parseInt(arr[0]);if(arr.length===5){
bounds=L.latLngBounds(L.latLng(parseFloat(arr[2]),parseFloat(arr[1])),L.latLng(parseFloat(arr[4]),parseFloat(arr[3])));if(!bounds.isValid()){bounds=null;zoomLevel=null}}else if(arr.length===3){center=L.latLng(parseFloat(arr[1]),parseFloat(arr[2]))}}switch(viz.marker){case"geojson":infobox=MapGenerator.createInfoBox();infobox.addTo(map);if(!geoJSON){map.setView([0,0],1);return}var nameHash=null;if(data){nameHash={};data.forEach(function(d){nameHash[d[viz.x.label]]=d})}var keyprop=viz.geojsonKeyProp;var featureFilter=function(feature){return true};var options={};options.filter=featureFilter;var highlightFeature=function(e){var layer=e.target;layer.setStyle({weight:/^(LineString|MultiLineString)$/.test(layer.feature.geometry.type)?mapConfig.selectedLineWidth:layer.feature.geometry.type==="Point"?mapConfig.selectedPointBorderWidth:mapConfig.selectedBorderWidth});if(!L.Browser.ie&&!L.Browser.opera&&!L.Browser.edge){layer.bringToFront()}var infoboxValues=[];var labelAsTitle=viz.labelAsCardTitle==="on";if(nameHash&&nameHash[layer.feature.properties[keyprop]]){if(viz.x&&!labelAsTitle){infoboxValues.push({type:labelAsTitle?"label":"title",column:viz.x,value:layer.feature.properties[keyprop]})}if(viz.label){infoboxValues.push({type:labelAsTitle?"title":"label",column:viz.label,value:label1ValuePrefix+formatValue(nameHash[layer.feature.properties[keyprop]][viz.label.label])+label1ValueSuffix})}if(viz.label2){infoboxValues.push({type:"label",column:viz.label2,value:label2ValuePrefix+formatValue(nameHash[layer.feature.properties[keyprop]][viz.label2.label])+label2ValueSuffix})}if(viz.color){infoboxValues.push({type:"label",column:viz.color,value:colorValuePrefix+formatValue(nameHash[layer.feature.properties[keyprop]][viz.color.label])+colorValueSuffix})}}if(infoboxValues.length===0){if(viz.geojsonKeyProp){infoboxValues.push({type:"label",column:{name:viz.geojsonKeyProp,func:""},value:formatValue(e.target.feature.properties[viz.geojsonKeyProp])})}else{var key=Object.keys(e.target.feature.properties);if(key.length>0){key=key[0];infoboxValues.push({type:"label",column:{name:"",func:""},value:formatValue(e.target.feature.properties[key])})}}}infobox.update(infoboxValues)};var resetHighlight=function(e){var layer=e.target;e.target.setStyle({weight:/^(LineString|MultiLineString)$/.test(layer.feature.geometry.type)?mapConfig.lineWidth:layer.feature.geometry.type==="Point"?mapConfig.pointBorderWidth:mapConfig.borderWidth});infobox.update()};var onEachFeature=function(feature,layer){layer.on({mouseover:highlightFeature,mouseout:resetHighlight,click:highlightFeature})};options.onEachFeature=onEachFeature;var pointStyles={radius:mapConfig.pointRadius,weight:0,opacity:1,fillOpacity:colorOpacity};options.pointToLayer=function(feature,latlng){return L.circleMarker(latlng,pointStyles)};geoJSONLayer=L.geoJSON(geoJSON,options);var hasZoomLevel=zoomLevel!==undefined&&zoomLevel!==null&&zoomLevel!=="";if(hasZoomLevel&&bounds){try{map.setZoom(zoomLevel)}catch(e){console.log(e)}map.fitBounds(bounds)}else if(hasZoomLevel&&center){try{map.setView(center,zoomLevel)}catch(e){console.log(e)}}else{var geoLayerBounds=geoJSONLayer.getBounds();if(L.latLngBounds(geoLayerBounds).isValid()){map.fitBounds(geoLayerBounds)}else{map.setView([0,0],1)}}if(data){var styleFunc;if(viz.colorbucket){colorData=VizUtil.distinct(data.map(function(datum){return datum[viz.colorbucket.label]}));colorData.forEach(function(x){quantColorScale(x)});styleFunc=function(feature){var styles={weight:/^(LineString|MultiLineString)$/.test(feature.geometry.type)?mapConfig.lineWidth:feature.geometry.type==="Point"?mapConfig.pointBorderWidth:mapConfig.borderWidth};var v=nameHash[feature.properties[keyprop]];if(v){if(/^(LineString|MultiLineString)$/.test(feature.geometry.type)){styles.color=quantColorScale(v[viz.colorbucket.label])}else{styles.color=viz.polygonBorderColor||"#FFFFFF";styles.fillColor=quantColorScale(v[viz.colorbucket.label]);styles.fillOpacity=colorOpacity}}else{styles.color="transparent"}return styles};legend=MapGenerator.createLegend(colorData,quantColorScale,colorOpacity,"square")}else{styleFunc=function(feature){var styles={weight:/^(LineString|MultiLineString)$/.test(feature.geometry.type)?mapConfig.lineWidth:feature.geometry.type==="Point"?mapConfig.pointBorderWidth:mapConfig.borderWidth};var v=nameHash[feature.properties[keyprop]];if(v){if(/^(LineString|MultiLineString)$/.test(feature.geometry.type)){styles.color=catColorScale(v[viz.color.label])}else{styles.color=viz.polygonBorderColor||"#FFFFFF";styles.fillColor=catColorScale(v[viz.color.label]);styles.fillOpacity=colorOpacity}}else{styles.color="transparent"}return styles};colorHash={};colorData=data.map(function(datum){colorHash[datum[viz.color.label]]=1;return datum[viz.color.label]});catColorScale=MapGenerator.createCatColorScale(viz,Object.keys(colorHash).length);catColorScale.domain(colorData);legend=MapGenerator.createLegend(colorData,catColorScale,colorOpacity,"square")}geoJSONLayer.setStyle(styleFunc);if(legend&&showLegend==="on"){legend.addTo(map)}}else{geoJSONLayer.setStyle(function(feature){return{weight:/^(LineString|MultiLineString)$/.test(feature.geometry.type)?mapConfig.lineWidth:feature.geometry.type==="Point"?mapConfig.pointBorderWidth:mapConfig.borderWidth}})}geoJSONLayer.addTo(map);break;case"map":if(viz.x&&viz.y){var showLines=viz.mapMarkerType?/line$/.test(viz.mapMarkerType):viz.mapShowLines==="on";var showDashedLines=viz.mapMarkerType?viz.mapMarkerType==="circle+dashedline":viz.mapDashedLines==="on";var normalizeSize=viz.size&&viz.mapNormalizeSizeByGroup==="on"&&showLines;var DEFAULT_GROUP_NAME="default";var CALCULATED_LONG="..lng";var CALCULATED_SIZE="..sz";infobox=MapGenerator.createInfoBox();infobox.addTo(map);if(viz.color){if(viz.colorbucket){colorData=VizUtil.distinct(data.map(function(datum){return datum[viz.colorbucket.label]}));colorData.forEach(function(x){quantColorScale(x)});legend=MapGenerator.createLegend(colorData,quantColorScale,colorOpacity,"circle")}else{colorHash={};colorData=data.map(function(datum){colorHash[datum[viz.color.label]]=1;return datum[viz.color.label]});catColorScale=MapGenerator.createCatColorScale(viz,Object.keys(colorHash).length);catColorScale.domain(colorData);legend=MapGenerator.createLegend(colorData,catColorScale,colorOpacity,"circle")}if(legend&&showLegend==="on"){legend.addTo(map)}}var minSize=parseFloat(viz.circleMinSize)||mapConfig.minCircleSize;var maxSize=parseFloat(viz.circleMaxSize)||mapConfig.maxCircleSize;var sizeScale=d3.scale.linear().domain([0,0]).rangeRound([minSize,maxSize]);if(viz.size){if(normalizeSize){sizeScale.domain([0,1])}else{var sizeData=data.map(function(datum){return datum[viz.size.label]});sizeScale.domain([d3.min(sizeData),d3.max(sizeData)])}}var polylines=[];if(showLines){var lineData=data.filter(function(d){return!VizUtil.isEmpty(d[viz.y.label])&&!VizUtil.isEmpty(d[viz.x.label])});var groupbyCol=!!viz.color?viz.color.label:null;var colorCol=!!viz.color?viz.color.label:null;lineData=groupbyCol?d3.nest().key(function(d){return d[groupbyCol]}).entries(lineData):[{key:DEFAULT_GROUP_NAME,values:data}];lineData.forEach(function(datum,idx){if(datum.values&&datum.values.length>1){if(!VizUtil.isEmpty(datum.values[0][VizUtil.ORIGINAL_ORDER_COL_NAME])){datum.values.sort(function(a,b){return b[VizUtil.ORIGINAL_ORDER_COL_NAME]-a[VizUtil.ORIGINAL_ORDER_COL_NAME]})}var colorValue=groupbyCol===colorCol?catColorScale(datum.key):colorCol&&datum.values[0][colorCol]?catColorScale(datum.values[0][colorCol]):catColorScale(DEFAULT_GROUP_NAME);if(viz.colorbucket){colorValue=quantColorScale(datum.values[0][viz.colorbucket.label])}var msg="";for(var key in datum.values[0]){if(labelNameMap[key]){var value=datum.values[0][key];msg+='<div class="popup-content-row"><div class="popup-content-cell">'+labelNameMap[key]+':</div><div class="popup-content-cell">'+formatValue(value)+"</div></div>"}}if(normalizeSize){var sizes=datum.values.map(function(v){return v[viz.size.label]});var sscale=d3.scale.linear().domain(d3.extent(sizes)).range([0,1]);datum.values.forEach(function(v){v[CALCULATED_SIZE]=sscale(v[viz.size.label])})}var lng=null,lat=null,prevlng=null;var latlngs=datum.values.map(function(v){lng=v[viz.x.label];lat=v[viz.y.label];if(prevlng!==null&&Math.abs(lng-prevlng)>180&&lng*prevlng<0){if(prevlng<0){lng=lng-360}else{lng=lng+360}}prevlng=lng;v[CALCULATED_LONG]=lng;return L.latLng(lat,lng)});var polyline=L.polyline(latlngs,{color:colorValue,opacity:colorOpacity,dashArray:showDashedLines?"5, 5":null,"data-line-id":idx});polyline.on("mouseover",function(evt){var dataidx=evt.target.options["data-line-id"];var dt=lineData[dataidx].values[0];var infoboxValues=[];if(viz.label){infoboxValues.push({type:"title",column:viz.label,value:label1ValuePrefix+formatValue(dt[viz.label.label])+label1ValueSuffix});if(viz.color){infoboxValues.push({type:"label",column:viz.color,value:colorValuePrefix+formatValue(dt[viz.color.label])+colorValueSuffix})}}else if(viz.color){infoboxValues.push({type:"title",column:viz.color,value:formatValue(dt[viz.color.label])})}infobox.update(infoboxValues);polyline.setStyle({weight:5})});polyline.on("mouseout",function(){infobox.update();polyline.setStyle({weight:3})});polylines.push(polyline)}})}var circles=[];data.forEach(function(datum,idx){if(VizUtil.isEmpty(datum[viz.y.label])||VizUtil.isEmpty(datum[viz.x.label])){return}var colorValue=catColorScale(viz.color?datum[viz.color.label]:DEFAULT_GROUP_NAME);if(viz.colorbucket){colorValue=quantColorScale(datum[viz.colorbucket.label])}var sizeValue=sizeScale(viz.size?normalizeSize?datum[CALCULATED_SIZE]||0:datum[viz.size.label]:null);var msg="";for(var key in datum){if(labelNameMap[key]){var value=datum[key];msg+='<div class="popup-content-row"><div class="popup-content-cell">'+labelNameMap[key]+':</div><div class="popup-content-cell">'+formatValue(value)+"</div></div>"}}var circleMarker=L.circleMarker(L.latLng(datum[viz.y.label],datum[CALCULATED_LONG]||datum[viz.x.label]),{stroke:false,color:"#ffffff",fillColor:colorValue,fillOpacity:colorOpacity,radius:sizeValue,"data-id":idx});circleMarker.on("mouseover",function(evt){var dataidx=evt.target.options["data-id"];var dt=data[dataidx];var infoboxValues=[];infoboxValues.push({type:"long",column:viz.x,value:formatValue(dt[viz.x.label])});infoboxValues.push({type:"lat",column:viz.y,value:formatValue(dt[viz.y.label])});if(viz.groupby){infoboxValues.push({type:"title",column:viz.x,value:formatValue(dt[viz.groupby.label])})}if(viz.label){infoboxValues.push({type:"title",column:viz.label,value:label1ValuePrefix+formatValue(dt[viz.label.label])+label1ValueSuffix})}if(viz.label2){infoboxValues.push({type:"label",column:viz.label2,value:label2ValuePrefix+formatValue(dt[viz.label2.label])+label2ValueSuffix})}if(viz.size){infoboxValues.push({type:"label",column:viz.size,value:sizeValuePrefix+formatValue(dt[viz.size.label])+sizeValueSuffix})}if(viz.color){infoboxValues.push({type:"label",column:viz.color,value:colorValuePrefix+formatValue(dt[viz.color.label])+colorValueSuffix})}infobox.update(infoboxValues);circleMarker.setStyle({stroke:true})});circleMarker.on("mouseout",function(){infobox.update();circleMarker.setStyle({stroke:false})});circles.push(circleMarker)});if(viz.color&&!viz.colorbucket&&catColorScale.isHighlightColorScale){MapGenerator._moveHighlightedCirclesToBottom(circles,catColorScale)}var circleGroup=L.featureGroup(polylines.concat(circles));circleGroup.addTo(map);if(zoomLevel&&bounds){try{map.setZoom(zoomLevel)}catch(e){console.log(e)}map.fitBounds(bounds)}else if(zoomLevel&&center){try{map.setView(center,zoomLevel)}catch(e){console.log(e)}}else{var _bounds=circleGroup.getBounds();if(L.latLngBounds(_bounds).isValid()){map.fitBounds(_bounds)}else{map.setView([0,0],1)}}}else{map.setView([0,0],1)}break;case"maphmap":if(viz.x&&viz.y){var heatData=[],circleData=[];var mag=viz.maphmapMagnification?parseFloat(viz.maphmapMagnification):1;var rad=viz.maphmapRadius?parseInt(viz.maphmapRadius):25;if(data.length>1&&Array.isArray(data[0])&&Array.isArray(data[1])){data=data[1]}data.forEach(function(datum){if(VizUtil.isEmpty(datum[viz.y.label])||VizUtil.isEmpty(datum[viz.x.label])){return}heatData.push([datum[viz.y.label],datum[viz.x.label],viz.color?datum[viz.color.label]*mag:mag]);circleData.push(L.circleMarker(L.latLng(datum[viz.y.label],datum[viz.x.label])))});var heatLayer=L.heatLayer(heatData,{radius:rad});heatLayer.addTo(map);if(zoomLevel&&bounds){try{map.setZoom(zoomLevel)}catch(e){console.log(e)}map.fitBounds(bounds)}else if(zoomLevel&&center){try{map.setView(center,zoomLevel)}catch(e){console.log(e)}}else{var _feat=L.featureGroup(circleData);var _bounds=_feat.getBounds();if(L.latLngBounds(_bounds).isValid()){map.fitBounds(_bounds)}else{map.setView([0,0],1)}}}else{map.setView([0,0],1)}break;default:break}if(typeof module==="object"&&module.exports&&map&&!noThumbnail){global._leaflet_map_obj=map}if(elTarget.classList.contains("markdown-viz-container")){if(!window._leaflet_map_objs)window._leaflet_map_objs={};window._leaflet_map_objs[elTarget.getAttribute("data-id").replace(/^div-/,"")]=map}};MapGenerator.getRenderFunction=function(viz,data,geojson,onLoadCallback,onErrorCallback,noThumbnail){var func=function(props){viz.width=props.width;viz.height=props.height;var elTarget=props.elem;MapGenerator.render(viz,data,elTarget,geojson,onLoadCallback,onErrorCallback,noThumbnail)};return func};if(typeof module==="object"&&module.exports)module.exports=MapGenerator;